<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vita â€” Simple Tracker</title>

  <!-- Tailwind (Play CDN for quick demo) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (UMD) + Babel for in-browser JSX transform (quick demo) -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { margin: 0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
  </style>
</head>
<body class="bg-slate-900 text-gray-200">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function getTodayLocal() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${y}-${m}-${day}`;
    }

    function VitaApp() {
      const [view, setView] = useState('today');
      const today = getTodayLocal();

      const [data, setData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [journal, setJournal] = useState('');
      const [water, setWater] = useState(0);
      const [saas, setSaas] = useState('');
      const [deepWork, setDeepWork] = useState('');
      const [talks, setTalks] = useState('');
      const [miles, setMiles] = useState('');
      const [weights, setWeights] = useState({});
      const [workout, setWorkout] = useState(null);
      const [history, setHistory] = useState([]);
      const [viewingDay, setViewingDay] = useState(null);
      const [saveStatus, setSaveStatus] = useState('');
      const [isExisting, setIsExisting] = useState(false);

      const rotation = ['back-biceps', 'legs', 'chest-triceps', 'running'];

      const exercises = {
        'back-biceps': [
          ['Deadlifts 4x6', 'Bent Rows 4x8', 'Pull-ups 3x10', 'Barbell Curls 3x12', 'Hammer Curls 3x10'],
          ['T-Bar Rows 4x8', 'Lat Pulldowns 4x10', 'Cable Rows 3x12', 'Preacher Curls 3x12', 'Concentration Curls 3x10']
        ],
        'legs': [
          ['Squats 4x8', 'Romanian Deadlifts 4x10', 'Leg Press 3x12', 'Lunges 3x10', 'Calf Raises 4x15'],
          ['Front Squats 4x8', 'Bulgarian Splits 3x10', 'Leg Curls 4x12', 'Leg Extensions 3x12', 'Seated Calf 4x15']
        ],
        'chest-triceps': [
          ['Bench Press 4x8', 'Incline DB Press 4x10', 'Dips 3x12', 'Tricep Pushdowns 3x12', 'Overhead Ext 3x10'],
          ['Incline Bench 4x8', 'Flat DB Press 4x10', 'Cable Flyes 3x12', 'Close Grip Bench 3x10', 'Skull Crushers 3x12']
        ]
      };

      const tasks = {
        core: [
          { id: 'cold', t: 'Cold shower/exposure' },
          { id: 'workout', t: 'Lifted/Ran (workout completed)' },
          { id: 'sun', t: 'Morning sunlight 10+ min' },
          { id: 'sleep', t: '7-8hr sleep scheduled' },
          { id: 'priorities', t: 'Wrote down 3 priorities for today' },
          { id: 'deep', t: '2-3hr deep work (phone locked away)' },
          { id: 'progress', t: 'Moved the product forward (tangible progress)' },
          { id: 'read', t: 'Read for 30 minutes' },
          { id: 'connect', t: 'Had real conversation with someone important (non-work)' }
        ],
        lead: [
          { id: 'no', t: 'Said no to distraction' },
          { id: 'talk', t: 'Had hard conversation' },
          { id: 'own', t: 'Owned mistake no excuses' },
          { id: 'help', t: 'Helped someone' },
          { id: 'hard', t: 'Did hardest thing first' }
        ],
        comm: [
          { id: 'rec', t: 'Recorded 60s pitch' },
          { id: 'pause', t: 'Paused before responding' },
          { id: 'short', t: 'Rewrote 50% shorter' },
          { id: 'clear', t: 'Explained product clearly' }
        ]
      };

      const labels = { 'back-biceps': 'Back & Biceps', 'legs': 'Legs', 'chest-triceps': 'Chest & Triceps', 'running': 'Running' };

      function makeStorage() {
        if (window.storage && window.storage.get && window.storage.set && window.storage.list) {
          return window.storage;
        }
        return {
          get: async (key) => {
            const val = localStorage.getItem(key);
            return val ? { value: val } : null;
          },
          set: async (key, value) => {
            localStorage.setItem(key, value);
            return { key, value };
          },
          list: async (prefix) => {
            const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix));
            return { keys };
          }
        };
      }

      useEffect(() => { loadData(); }, []);

      async function loadData() {
        setLoading(true);
        const storage = makeStorage();
        const initialData = { date: today, done: [], journal: '', water: 0, saas: '', deepWork: '', talks: '', miles: '', weights: {}, mood: null, workoutDone: false };
        try {
          const td = await storage.get(`day:${today}`);
          if (td && td.value) {
            const raw = (typeof td.value === 'string') ? td.value : '';
            const d = JSON.parse(raw || '{}');
            const merged = { ...initialData, ...d };
            setData(JSON.parse(JSON.stringify(merged)));
            setJournal(merged.journal || '');
            setWater(merged.water || 0);
            setSaas(merged.saas || '');
            setDeepWork(merged.deepWork || '');
            setTalks(merged.talks || '');
            setMiles(merged.miles || '');
            setWeights(merged.weights || {});
            setIsExisting(true);
          } else {
            setData(initialData);
            setJournal('');
            setWater(0);
            setSaas('');
            setDeepWork('');
            setTalks('');
            setMiles('');
            setWeights({});
            setIsExisting(false);
          }

          const wr = await storage.get('workout-rotation');
          if (wr && wr.value) {
            try {
              setWorkout(JSON.parse(wr.value));
            } catch {
              setWorkout({ type: 'back-biceps', var: 0 });
            }
          } else {
            setWorkout({ type: 'back-biceps', var: 0 });
          }

          const res = await storage.list('day:');
          if (res?.keys) {
            const hist = await Promise.all(res.keys.map(async k => {
              try {
                const r = await storage.get(k);
                if (!r) return null;
                const raw = (typeof r.value === 'string') ? r.value : '';
                return JSON.parse(raw || '{}');
              } catch {
                return null;
              }
            }));
            setHistory(hist.filter(Boolean).map(h => JSON.parse(JSON.stringify(h))).sort((a, b) => new Date(b.date) - new Date(a.date)));
          } else {
            setHistory([]);
          }
        } catch (e) {
          console.error(e);
          setData(initialData);
          setWorkout({ type: 'back-biceps', var: 0 });
          setHistory([]);
        } finally {
          setLoading(false);
        }
      }

      async function refreshHistory() {
        const storage = makeStorage();
        const res = await storage.list('day:');
        if (res?.keys) {
          const hist = await Promise.all(res.keys.map(async k => {
            try {
              const r = await storage.get(k);
              if (!r) return null;
              const raw = (typeof r.value === 'string') ? r.value : '';
              return JSON.parse(raw || '{}');
            } catch { return null; }
          }));
          setHistory(hist.filter(Boolean).map(h => JSON.parse(JSON.stringify(h))).sort((a,b) => new Date(b.date) - new Date(a.date)));
        }
      }

      async function save(d) {
        try {
          setSaveStatus('Savingâ€¦');
          const storage = makeStorage();
          await storage.set(`day:${today}`, JSON.stringify(d));
          setSaveStatus('Saved âœ“');
          setTimeout(() => setSaveStatus(''), 2000);
          await refreshHistory();
          setIsExisting(true);
        } catch (e) {
          console.error('Save error', e);
        }
      }

      async function startNewDay() {
        if (!window.confirm('Start a new day? This will snapshot and save the current entry, then reset Today to a fresh entry.')) return;
        const storage = makeStorage();
        try {
          // save current data under its date (if any)
          if (data && data.date) {
            await storage.set(`day:${data.date}`, JSON.stringify(data));
          }
          // create fresh day object for today
          const newData = { date: today, done: [], journal: '', water: 0, saas: '', deepWork: '', talks: '', miles: '', weights: {}, mood: null, workoutDone: false };
          setData(JSON.parse(JSON.stringify(newData)));
          setJournal(''); setWater(0); setSaas(''); setDeepWork(''); setTalks(''); setMiles(''); setWeights({});
          await storage.set(`day:${today}`, JSON.stringify(newData));
          await refreshHistory();
          setIsExisting(false);
          setSaveStatus('New day started');
          setTimeout(() => setSaveStatus(''), 2000);
        } catch (e) {
          console.error('New day error', e);
        }
        async function completeWorkout() {
  const storage = makeStorage();
  const nd = { 
    ...data, 
    workoutType: workout.type, 
    workoutDone: true, 
    miles: (workout.type === 'running' ? miles : undefined), 
    weights: (workout.type !== 'running' ? weights : undefined) 
  };
  setData(JSON.parse(JSON.stringify(nd)));
  await save(nd);
  const idx = rotation.indexOf(workout.type);
  const next = { type: rotation[(idx + 1) % rotation.length], var: 0 };
  setWorkout(next);
  setWeights({});
  setMiles('');
  await storage.set('workout-rotation', JSON.stringify(next));
}

      }

      function toggle(id) {
        if (!data) return;
        const done = data.done.includes(id) ? data.done.filter(x => x !== id) : [...data.done, id];
        const nd = { ...data, done };
        setData(JSON.parse(JSON.stringify(nd)));
        save(nd);
      }

      function updateWater(n) {
        const nw = Math.max(0, (water || 0) + n);
        setWater(nw);
        const nd = { ...data, water: nw };
        setData(JSON.parse(JSON.stringify(nd)));
        save(nd);
      }

      async function completeWorkout() {
        const storage = makeStorage();
        const nd = { ...data, workoutType: workout.type, workoutDone: true, miles: (workout.type === 'running' ? miles : undefined), weights: (workout.type !== 'running' ? weights : undefined) };
        setData(JSON.parse(JSON.stringify(nd)));
        await save(nd);
        const idx = rotation.indexOf(workout.type);
        const next = { type: rotation[(idx + 1) % rotation.length], var: 0 };
        setWorkout(next);
        setWeights({});
        await storage.set('workout-rotation', JSON.stringify(next));
      }

      function genNew() {
        if (!workout || workout.type === 'running') return;
        const vars = exercises[workout.type] || [];
        setWorkout({ ...workout, var: (workout.var + 1) % Math.max(1, vars.length) });
      }

      if (loading || !data || !workout) {
        return (
          <div className="flex items-center justify-center h-screen">
            <div className="text-xl text-gray-300">Loadingâ€¦</div>
          </div>
        );
      }
// WORKOUTS VIEW
if (view === 'workouts') {
  const ex = workout.type === 'running' ? null : exercises[workout.type][workout.var];
  return (
    <div className="min-h-screen p-4">
      <div className="max-w-4xl mx-auto">
        <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
        <div className="flex gap-2 justify-center mb-6">
          <button onClick={() => setView('today')} className="px-6 py-2 bg-slate-700 rounded-lg">Today</button>
          <button onClick={() => setView('progress')} className="px-6 py-2 bg-slate-700 rounded-lg">Progress</button>
          <button onClick={() => setView('workouts')} className="px-6 py-2 bg-amber-600 text-white rounded-lg">Workouts</button>
        </div>
        <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-6">
          <div className="flex justify-between items-center mb-4">
            <div>
              <h2 className="text-2xl font-bold">Today: {labels[workout.type]}</h2>
              <p className="text-sm text-gray-400">Next: {labels[rotation[(rotation.indexOf(workout.type) + 1) % 4]]}</p>
            </div>
            {workout.type !== 'running' && <button onClick={genNew} className="px-4 py-2 bg-slate-700 rounded">New Exercises</button>}
          </div>
          {workout.type === 'running' ? (
            <div className="space-y-4">
              <input type="number" step="0.1" value={miles} onChange={(e) => setMiles(e.target.value)} placeholder="Miles run" className="w-full p-3 bg-slate-700 rounded" />
              <button onClick={completeWorkout} disabled={!miles || data.workoutDone} className="w-full py-3 bg-green-600 rounded font-semibold disabled:bg-slate-600">{data.workoutDone ? 'âœ“ Done' : 'Complete'}</button>
            </div>
          ) : (
            <div className="space-y-3">
              {ex.map((e, i) => (
                <div key={i} className="bg-slate-700 rounded-lg p-4">
                  <div className="font-medium mb-2">{e}</div>
                  <input type="number" placeholder="Weight (lbs)" value={weights[e] || ''} onChange={(ev) => setWeights({...weights, [e]: ev.target.value})} className="w-full p-2 bg-slate-600 rounded text-sm" />
                </div>
              ))}
              <button onClick={completeWorkout} disabled={data.workoutDone} className="w-full py-3 bg-green-600 rounded font-semibold disabled:bg-slate-600">{data.workoutDone ? 'âœ“ Done' : 'Complete'}</button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

// PROGRESS VIEW
if (view === 'progress') {
  const rate = history.length > 0 ? Math.round((history.reduce((s, d) => s + d.done.length, 0) / (history.length * 18)) * 100) : 0;
  return (
    <div className="min-h-screen p-4">
      <div className="max-w-4xl mx-auto">
        <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
        <div className="flex gap-2 justify-center mb-6">
          <button onClick={() => setView('today')} className="px-6 py-2 bg-slate-700 rounded-lg">Today</button>
          <button onClick={() => setView('progress')} className="px-6 py-2 bg-amber-600 text-white rounded-lg">Progress</button>
          <button onClick={() => setView('workouts')} className="px-6 py-2 bg-slate-700 rounded-lg">Workouts</button>
        </div>
        <div className="grid grid-cols-2 gap-4 mb-6">
          <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
            <p className="text-sm mb-2">Completion</p>
            <p className="text-4xl font-bold">{rate}%</p>
          </div>
          <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
            <p className="text-sm mb-2">Days</p>
            <p className="text-4xl font-bold">{history.length}</p>
          </div>
        </div>
        <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
          <h2 className="text-xl font-bold mb-4">Last 7 Days</h2>
          {history.slice(0, 7).map(d => {
            const pct = Math.round((d.done.length / 18) * 100);
            return (
              <div key={d.date} className="bg-slate-700 rounded-lg p-4 mb-3 cursor-pointer" onClick={() => setViewingDay(d)}>
                <div className="flex justify-between mb-2">
                  <span>{new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                  <span className="text-amber-400">{pct}%</span>
                </div>
                <div className="w-full bg-slate-600 rounded-full h-2">
                  <div className="bg-amber-500 h-2 rounded-full" style={{ width: `${pct}%` }} />
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}

      const total = 18;
      const done = data.done ? data.done.length : 0;

      return (
        <div className="min-h-screen p-4">
          <div className="max-w-4xl mx-auto">
            <div className="flex items-center justify-between mb-2">
              <div>
                <h1 className="text-4xl font-bold mb-1 text-center">Vita</h1>
                <p className="text-sm text-gray-400 text-center">{new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
              </div>
              <div className="flex items-center gap-2">
                <div className={`px-3 py-1 rounded-full text-sm ${isExisting ? 'bg-green-700 text-white' : 'bg-slate-700 text-gray-200'}`}>
                  {isExisting ? 'Existing entry' : 'Fresh day'}
                </div>
                <button onClick={startNewDay} className="px-3 py-2 bg-slate-700 rounded text-sm">Start New Day</button>
              </div>
            </div>

            <div className="flex gap-2 justify-center mb-6">
              <button onClick={() => setView('today')} className="px-6 py-2 bg-amber-600 text-white rounded-lg">Today</button>
              <button onClick={() => setView('progress')} className="px-6 py-2 bg-slate-700 text-gray-300 rounded-lg">Progress</button>
              <button onClick={() => setView('workouts')} className="px-6 py-2 bg-slate-700 text-gray-300 rounded-lg">Workouts</button>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <div className="flex justify-between mb-3">
                <span>Progress</span>
                <span className="text-2xl font-bold text-amber-400">{done}/{total}</span>
              </div>
              <div className="w-full bg-slate-700 rounded-full h-3">
                <div className="bg-amber-500 h-3 rounded-full" style={{ width: `${(done/total)*100}%` }} />
              </div>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="mb-3">Mood</h3>
              <div className="flex gap-2 flex-wrap">
                {['ðŸ˜Š Sharp', 'ðŸ™‚ Good', 'ðŸ˜ Okay', 'ðŸ˜” Off', 'ðŸ˜° Hard'].map(m => (
                  <button key={m} onClick={() => { const nd = { ...data, mood: m }; setData(JSON.parse(JSON.stringify(nd))); save(nd); }} className={`px-4 py-2 rounded-lg ${data.mood === m ? 'bg-amber-500 text-white' : 'bg-slate-700 text-gray-300'}`}>
                    {m}
                  </button>
                ))}
              </div>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <div className="flex justify-between items-center mb-3">
                <div className="flex items-center gap-2">ðŸ’§<span className="ml-1">Water Intake</span></div>
                <span className="text-xl font-bold text-blue-400">{water} glasses</span>
              </div>
              <div className="flex gap-2">
                <button onClick={() => updateWater(-1)} className="px-6 py-2 bg-slate-700 text-white rounded-lg font-bold">-</button>
                <button onClick={() => updateWater(1)} className="flex-1 py-2 bg-blue-600 text-white rounded-lg font-bold">+ Glass</button>
              </div>
              <p className="text-xs text-gray-400 mt-2">Target: 8 glasses per day (64oz)</p>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <div className="flex items-center gap-2 mb-3">ðŸ’»<span>SaaS Work</span></div>
              <textarea value={saas} onChange={e => setSaas(e.target.value)} onBlur={() => { const nd = { ...data, saas }; setData(JSON.parse(JSON.stringify(nd))); save(nd); }} placeholder="What did you work on today?" className="w-full p-3 bg-slate-700 rounded text-white mb-3" rows="3" />
              <div className="grid grid-cols-2 gap-3">
                <input type="number" step="0.5" value={deepWork} onChange={e => setDeepWork(e.target.value)} onBlur={() => { const nd = { ...data, deepWork }; setData(JSON.parse(JSON.stringify(nd))); save(nd); }} placeholder="Deep work (hrs)" className="p-3 bg-slate-700 rounded" />
                <input type="number" value={talks} onChange={e => setTalks(e.target.value)} onBlur={() => { const nd = { ...data, talks }; setData(JSON.parse(JSON.stringify(nd))); save(nd); }} placeholder="User talks" className="p-3 bg-slate-700 rounded" />
              </div>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="mb-3">Non-Negotiables</h3>
              {tasks.core.map(t => (
                <div key={t.id} onClick={() => toggle(t.id)} className={`p-3 rounded-lg mb-2 cursor-pointer ${data.done.includes(t.id) ? 'bg-green-900 border-2 border-green-500' : 'bg-slate-700'}`}>
                  <div className="flex items-center justify-between">
                    <span className="text-sm">{t.t}</span>
                    {data.done.includes(t.id) && <span>âœ…</span>}
                  </div>
                </div>
              ))}
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="mb-3">Leadership (Do 1+)</h3>
              {tasks.lead.map(t => (
                <div key={t.id} onClick={() => toggle(t.id)} className={`p-3 rounded-lg mb-2 cursor-pointer ${data.done.includes(t.id) ? 'bg-amber-900 border-2 border-amber-500' : 'bg-slate-700'}`}>
                  <div className="flex items-center justify-between">
                    <span className="text-sm">{t.t}</span>
                    {data.done.includes(t.id) && <span>âœ…</span>}
                  </div>
                </div>
              ))}
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="mb-3">Communication</h3>
              {tasks.comm.map(t => (
                <div key={t.id} onClick={() => toggle(t.id)} className={`p-3 rounded-lg mb-2 cursor-pointer ${data.done.includes(t.id) ? 'bg-purple-900 border-2 border-purple-500' : 'bg-slate-700'}`}>
                  <div className="flex items-center justify-between">
                    <span className="text-sm">{t.t}</span>
                    {data.done.includes(t.id) && <span>âœ…</span>}
                  </div>
                </div>
              ))}
            </div>

            <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
              <div className="flex items-center gap-2 mb-3">ðŸ“š<span>Reflection</span></div>
              <textarea value={journal} onChange={e => setJournal(e.target.value)} onBlur={() => { const nd = { ...data, journal }; setData(JSON.parse(JSON.stringify(nd))); save(nd); }} placeholder="What did I lead? What did I ship? How did I grow?" className="w-full p-3 bg-slate-700 rounded text-white" rows="4" />
              <div className="mt-3 flex items-center justify-between">
                <div className="text-sm text-gray-400">{saveStatus}</div>
                <div className="flex gap-2">
                  <button onClick={() => { const nd = { ...data, journal }; setData(JSON.parse(JSON.stringify(nd))); save(nd); }} className="px-4 py-2 bg-slate-700 rounded">Save</button>
                </div>
              </div>
            </div>

          </div>
        </div>
      );
    }

    ReactDOM.render(<VitaApp />, document.getElementById('root'));
  </script>
</body>
</html>
