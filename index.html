<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vita ‚Äî Simple Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { margin: 0; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
  </style>
</head>
<body class="bg-slate-900 text-gray-200">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function getTodayLocal() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${y}-${m}-${day}`;
    }

    function VitaApp() {
      console.log('VitaApp component starting...');
      const [view, setView] = useState('today');
      console.log('View state initialized:', view);

      const today = getTodayLocal();
      console.log('Today date:', today);

      const [data, setData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [journal, setJournal] = useState('');
      const [water, setWater] = useState(0);
      const [saas, setSaas] = useState('');
      const [deepWork, setDeepWork] = useState('');
      const [talks, setTalks] = useState('');
      const [miles, setMiles] = useState('');
      const [weights, setWeights] = useState({});
      const [workout, setWorkout] = useState(null);
      const [history, setHistory] = useState([]);
      const [viewingDay, setViewingDay] = useState(null);
      const [showAllHistory, setShowAllHistory] = useState(false);
      const [nutritionData, setNutritionData] = useState({});
      const [showAddFood, setShowAddFood] = useState(false);
      const [selectedMeal, setSelectedMeal] = useState('breakfast');
      const [saveStatus, setSaveStatus] = useState('');
      const [isExisting, setIsExisting] = useState(false);
      const [energyLevel, setEnergyLevel] = useState(null);
      const [knowledgeBase, setKnowledgeBase] = useState([]); // Personal notes and insights
      const [spacedRepetition, setSpacedRepetition] = useState([]); // Ideas to remember
      const [currentBookApplication, setCurrentBookApplication] = useState(null); // Today's application prompt
      const [challenges, setChallenges] = useState([]); // Active challenges
      const [completedChallenges, setCompletedChallenges] = useState([]); // Completed challenges
      const [badges, setBadges] = useState([]); // Earned badges
      const [showCreateChallenge, setShowCreateChallenge] = useState(false);
      const [aiCoachInsights, setAiCoachInsights] = useState({}); // AI coach analysis and insights
      const [coachMode, setCoachMode] = useState('daily'); // daily, weekly, monthly
      const [showAddNote, setShowAddNote] = useState(false);
      const [showAddRepetition, setShowAddRepetition] = useState(false);
      const [newNote, setNewNote] = useState({ content: '', source: '', category: '', tags: '' });
      const [newRepetitionItem, setNewRepetitionItem] = useState({ content: '', source: '' });
      const [readingProgress, setReadingProgress] = useState({
        booksRead: 0,
        pagesRead: 0,
        insightsGained: 0,
        currentStreak: 0,
        longestStreak: 0,
        lastReadingDate: null
      });
      const [showReadingModal, setShowReadingModal] = useState(false);
      const [readingEntry, setReadingEntry] = useState({
        bookTitle: '',
        pagesRead: '',
        insights: '',
        notes: ''
      });
      const [readingHistory, setReadingHistory] = useState([]);
      const [manualWorkoutType, setManualWorkoutType] = useState(null); // Manual override for today's workout

      console.log('All state initialized successfully');

      const rotation = ['back-biceps', 'legs', 'chest-triceps', 'shoulders', 'full-body', 'core-abs', 'cardio-conditioning', 'running'];

      const exercises = {
        'back-biceps': [
          ['Deadlifts 4x6', 'Bent Rows 4x8', 'Pull-ups 3x10', 'Barbell Curls 3x12', 'Hammer Curls 3x10'],
          ['T-Bar Rows 4x8', 'Lat Pulldowns 4x10', 'Cable Rows 3x12', 'Preacher Curls 3x12', 'Concentration Curls 3x10'],
          ['Romanian Deadlifts 4x8', 'Seated Rows 4x10', 'Face Pulls 3x12', 'EZ Bar Curls 3x12', 'Cable Curls 3x10'],
          ['Rack Pulls 4x6', 'Pendlay Rows 4x8', 'Assisted Pull-ups 3x8', 'Dumbbell Curls 3x12', 'Reverse Curls 3x10']
        ],
        'legs': [
          ['Squats 4x8', 'Romanian Deadlifts 4x10', 'Leg Press 3x12', 'Lunges 3x10', 'Calf Raises 4x15'],
          ['Front Squats 4x8', 'Bulgarian Splits 3x10', 'Leg Curls 4x12', 'Leg Extensions 3x12', 'Seated Calf 4x15'],
          ['Box Squats 4x8', 'Trap Bar Deadlifts 4x8', 'Hack Squat 3x10', 'Walking Lunges 3x12', 'Standing Calf 4x15'],
          ['Pause Squats 4x6', 'Deficit Deadlifts 4x8', 'Belt Squat 3x12', 'Step-ups 3x10', 'Leg Press Calf 4x20']
        ],
        'chest-triceps': [
          ['Bench Press 4x8', 'Incline DB Press 4x10', 'Dips 3x12', 'Tricep Pushdowns 3x12', 'Overhead Ext 3x10'],
          ['Incline Bench 4x8', 'Flat DB Press 4x10', 'Cable Flyes 3x12', 'Close Grip Bench 3x10', 'Skull Crushers 3x12'],
          ['Floor Press 4x8', 'Incline Flyes 4x10', 'Diamond Push-ups 3x12', 'Rope Pushdowns 3x12', 'Tricep Kickbacks 3x15'],
          ['Board Press 4x6', 'Hammer Press 4x8', 'Ring Dips 3x10', 'V-Bar Pushdowns 3x12', 'Overhead Rope Ext 3x12']
        ],
        'shoulders': [
          ['Military Press 4x8', 'Lateral Raises 4x12', 'Rear Delt Flyes 4x15', 'Face Pulls 3x12', 'Shrugs 4x10'],
          ['Arnold Press 4x8', 'Front Raises 4x12', 'Bent-over Raises 4x15', 'Upright Rows 3x10', 'Farmer Walks 3x30s'],
          ['Push Press 4x6', 'Cable Laterals 4x12', 'Machine Raises 4x15', 'Band Pull-aparts 3x15', 'Dumbbell Shrugs 4x12'],
          ['Z Press 4x6', 'Single-arm Laterals 4x12', 'Reverse Flyes 4x15', 'Y Raises 3x12', 'Trap Raises 4x10']
        ],
        'full-body': [
          ['Deadlifts 4x6', 'Bench Press 4x8', 'Pull-ups 3x8', 'Squats 4x8', 'Overhead Press 4x8'],
          ['Romanian DL 4x8', 'Incline Press 4x8', 'Rows 4x10', 'Front Squats 4x8', 'Dips 3x10'],
          ['Trap Bar DL 4x8', 'Floor Press 4x8', 'Lat Pulldowns 4x10', 'Bulgarian Split 3x10', 'Push-ups 3x15'],
          ['Deficit DL 4x6', 'Close Grip Bench 4x8', 'Face Pulls 3x12', 'Pause Squats 4x6', 'Diamond Push-ups 3x12']
        ],
        'core-abs': [
          ['Planks 3x45s', 'Russian Twists 4x20', 'Leg Raises 4x15', 'Bicycle Crunches 4x20', 'Mountain Climbers 4x30s'],
          ['Dead Bugs 4x12', 'Pallof Press 3x12', 'Flutter Kicks 4x30s', 'V-ups 4x15', 'Woodchoppers 3x15'],
          ['Ab Wheel 4x10', 'Dragon Flags 4x8', 'Hollow Body Hold 3x30s', 'Side Planks 3x30s', 'Reverse Crunches 4x15'],
          ['Weighted Sit-ups 4x12', 'Cable Crunches 4x15', 'Farmers Carry 3x40s', 'Stir the Pot 3x20s', 'Toes to Bar 4x10']
        ],
        'cardio-conditioning': [
          ['Burpees 4x10', 'Mountain Climbers 4x30s', 'Jump Squats 4x15', 'High Knees 4x30s', 'Box Jumps 4x10'],
          ['Battle Ropes 4x30s', 'Rowing Sprints 8x30s', 'Kettlebell Swings 4x20', 'Slam Balls 4x15', 'Wall Balls 4x15'],
          ['Bike Sprints 8x20s', 'Assault Bike 4x30s', 'Ski Erg 4x30s', 'Fan Bike 4x30s', 'Echo Bike 4x30s'],
          ['Bear Crawls 4x30s', 'Crab Walks 4x30s', 'Broad Jumps 4x10', 'Sprint Intervals 8x20s', 'Hill Sprints 6x30s']
        ]
      };

      const tasks = {
        core: [
          { id: 'cold', t: 'Cold shower/exposure' },
          { id: 'workout', t: 'Lifted/Ran (workout completed)' },
          { id: 'sun', t: 'Morning sunlight 10+ min' },
          { id: 'sleep', t: '7-8hr sleep scheduled' },
          { id: 'priorities', t: 'Wrote down 3 priorities for today' },
          { id: 'deep', t: '2-3hr deep work (phone locked away)' },
          { id: 'progress', t: 'Moved the product forward (tangible progress)' },
          { id: 'read', t: 'Read for 30 minutes' },
          { id: 'connect', t: 'Had real conversation with someone important (non-work)' }
        ],
        lead: [
          { id: 'no', t: 'Said no to distraction' },
          { id: 'talk', t: 'Had hard conversation' },
          { id: 'own', t: 'Owned mistake no excuses' },
          { id: 'help', t: 'Helped someone' },
          { id: 'hard', t: 'Did hardest thing first' }
        ],
        comm: [
          { id: 'rec', t: 'Recorded 60s pitch' },
          { id: 'pause', t: 'Paused before responding' },
          { id: 'short', t: 'Rewrote 50% shorter' },
          { id: 'clear', t: 'Explained product clearly' }
        ]
      };

      const labels = {
        'back-biceps': 'Back & Biceps',
        'legs': 'Legs',
        'chest-triceps': 'Chest & Triceps',
        'shoulders': 'Shoulders',
        'full-body': 'Full Body',
        'core-abs': 'Core & Abs',
        'cardio-conditioning': 'Cardio Conditioning',
        'running': 'Running'
      };

      function makeStorage() {
        if (window.storage && window.storage.get && window.storage.set && window.storage.list) {
          return window.storage;
        }
        return {
          get: async (key) => {
            const val = localStorage.getItem(key);
            return val ? { value: val } : null;
          },
          set: async (key, value) => {
            localStorage.setItem(key, value);
            return { key, value };
          },
          list: async (prefix) => {
            const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix));
            return { keys };
          }
        };
      }

      useEffect(() => { loadData(); }, []);

      // Load nutrition data on component mount
      useEffect(() => {
        const saved = localStorage.getItem('vita-nutrition');
        if (saved) {
          try {
            setNutritionData(JSON.parse(saved));
          } catch (e) {
            console.error('Error loading nutrition data:', e);
          }
        }
      }, []);

      // Load knowledge data on component mount
      useEffect(() => {
        // Load knowledge base
        const savedKnowledge = localStorage.getItem('vita-knowledge-base');
        if (savedKnowledge) {
          try {
            setKnowledgeBase(JSON.parse(savedKnowledge));
          } catch (e) {
            console.error('Error loading knowledge base:', e);
          }
        }

        // Load spaced repetition items
        const savedRepetition = localStorage.getItem('vita-spaced-repetition');
        if (savedRepetition) {
          try {
            const repetitionData = JSON.parse(savedRepetition);
            // Filter out completed items and update due dates
            const now = new Date();
            const activeItems = repetitionData.filter(item => {
              const dueDate = new Date(item.nextReview);
              return dueDate <= now;
            });
            setSpacedRepetition(activeItems);
          } catch (e) {
            console.error('Error loading spaced repetition:', e);
          }
        }

        // Load challenges and badges
        const savedChallenges = localStorage.getItem('vita-challenges');
        if (savedChallenges) {
          try {
            const challengeData = JSON.parse(savedChallenges);
            setChallenges(challengeData.filter(c => !c.completed));
            setCompletedChallenges(challengeData.filter(c => c.completed));
          } catch (e) {
            console.error('Error loading challenges:', e);
          }
        }

        const savedBadges = localStorage.getItem('vita-badges');
        if (savedBadges) {
          try {
            setBadges(JSON.parse(savedBadges));
          } catch (e) {
            console.error('Error loading badges:', e);
          }
        }

        // Load AI coach insights
        const savedCoachInsights = localStorage.getItem('vita-ai-coach');
        if (savedCoachInsights) {
          try {
            setAiCoachInsights(JSON.parse(savedCoachInsights));
          } catch (e) {
            console.error('Error loading AI coach insights:', e);
          }
        }

        // Load reading progress
        const savedReadingProgress = localStorage.getItem('vita-reading-progress');
        if (savedReadingProgress) {
          try {
            setReadingProgress(JSON.parse(savedReadingProgress));
          } catch (e) {
            console.error('Error loading reading progress:', e);
          }
        }

        // Load reading history
        const savedReadingHistory = localStorage.getItem('vita-reading-history');
        if (savedReadingHistory) {
          try {
            setReadingHistory(JSON.parse(savedReadingHistory));
          } catch (e) {
            console.error('Error loading reading history:', e);
          }
        }

        // Generate today's book application
        generateTodaysApplication();
      }, []);

      // Auto-save workout progress when navigating away from workouts tab
      useEffect(() => {
        if (view !== 'workouts' && workout && workout.type) {
          // Save current workout progress to localStorage
          const workoutProgress = {
            type: workout.type,
            var: workout.var,
            weights: weights,
            miles: miles,
            savedAt: new Date().toISOString()
          };
          try {
            localStorage.setItem('vita-workout-progress', JSON.stringify(workoutProgress));
            console.log('Auto-saved workout progress');
          } catch (e) {
            console.error('Error saving workout progress:', e);
          }
        }
      }, [view, workout, weights, miles]); // Include all dependencies

      // Load saved workout progress when component mounts
      useEffect(() => {
        const saved = localStorage.getItem('vita-workout-progress');
        if (saved) {
          try {
            const workoutProgress = JSON.parse(saved);
            // Only restore if it's recent (within last 24 hours) and not completed today
            const savedTime = new Date(workoutProgress.savedAt);
            const now = new Date();
            const hoursDiff = (now - savedTime) / (1000 * 60 * 60);

            if (hoursDiff < 24 && data && !data.workoutDone) {
              setWorkout({ type: workoutProgress.type, var: workoutProgress.var });
              setWeights(workoutProgress.weights || {});
              setMiles(workoutProgress.miles || '');
            }
          } catch (e) {
            console.error('Error loading workout progress:', e);
          }
        }
      }, []);

      async function loadData() {
        setLoading(true);
        const storage = makeStorage();
        const initialData = { date: today, done: [], journal: '', water: 0, saas: '', deepWork: '', talks: '', miles: '', weights: {}, mood: null, workoutDone: false, energyLevel: null };
        try {
          // Load today's data
        try {
          const td = await storage.get(`day:${today}`);
          if (td && td.value) {
            const raw = (typeof td.value === 'string') ? td.value : '';
            const d = JSON.parse(raw || '{}');
            const merged = { ...initialData, ...d };
              const cleanData = JSON.parse(JSON.stringify(merged));
              setData(cleanData);
              setJournal(cleanData.journal || '');
              setWater(cleanData.water || 0);
              setSaas(cleanData.saas || '');
              setDeepWork(cleanData.deepWork || '');
              setTalks(cleanData.talks || '');
              setMiles(cleanData.miles || '');
              setWeights(cleanData.weights || {});
            setIsExisting(true);
          } else {
              setData(JSON.parse(JSON.stringify(initialData)));
              setJournal('');
              setWater(0);
              setSaas('');
              setDeepWork('');
              setTalks('');
              setMiles('');
              setWeights({});
              setIsExisting(false);
            }
          } catch (e) {
            console.error('Error loading today\'s data:', e);
            setData(JSON.parse(JSON.stringify(initialData)));
            setJournal('');
            setWater(0);
            setSaas('');
            setDeepWork('');
            setTalks('');
            setMiles('');
            setWeights({});
            setIsExisting(false);
          }

          // Load workout rotation
          try {
          const wr = await storage.get('workout-rotation');
          if (wr && wr.value) {
              const workoutData = JSON.parse(wr.value);
              setWorkout(workoutData);
            } else {
              setWorkout({ type: 'back-biceps', var: 0 });
            }
          } catch (e) {
            console.error('Error loading workout rotation:', e);
            setWorkout({ type: 'back-biceps', var: 0 });
          }

          // Load history
          await refreshHistory();
        } catch (e) {
          console.error('Critical error in loadData:', e);
          setData(JSON.parse(JSON.stringify(initialData)));
          setWorkout({ type: 'back-biceps', var: 0 });
          setHistory([]);
        } finally {
          setLoading(false);
        }
      }

      async function refreshHistory() {
        const storage = makeStorage();
        try {
        const res = await storage.list('day:');
        if (res?.keys) {
          const hist = await Promise.all(res.keys.map(async k => {
            try {
              const r = await storage.get(k);
                if (!r || !r.value) return null;
              const raw = (typeof r.value === 'string') ? r.value : '';
                const parsed = JSON.parse(raw || '{}');
                // Ensure we have all fields for proper display
                return {
                  date: parsed.date || k.replace('day:', ''),
                  done: parsed.done || [],
                  journal: parsed.journal || '',
                  water: parsed.water || 0,
                  saas: parsed.saas || '',
                  deepWork: parsed.deepWork || '',
                  talks: parsed.talks || '',
                  miles: parsed.miles || '',
                  weights: parsed.weights || {},
                  workoutDone: parsed.workoutDone || false,
                  workoutType: parsed.workoutType || null,
                  workoutExercises: parsed.workoutExercises || null,
                  mood: parsed.mood || null,
                  energyLevel: parsed.energyLevel || null,
                  // Add nutrition data for this day
                  nutritionData: (() => {
                    try {
                      const nutritionKey = parsed.date || k.replace('day:', '');
                      const savedNutrition = localStorage.getItem('vita-nutrition');
                      if (savedNutrition) {
                        const nutritionData = JSON.parse(savedNutrition);
                        return nutritionData[nutritionKey] || null;
                      }
                      return null;
                    } catch (e) {
                      console.error('Error loading nutrition data for history:', e);
                      return null;
                    }
                  })()
                };
              } catch (e) {
                console.error('Error loading history item:', k, e);
                return null;
              }
            }));
            const validHistory = hist.filter(Boolean);
            setHistory(validHistory.sort((a, b) => new Date(b.date) - new Date(a.date)));
          } else {
            setHistory([]);
          }
        } catch (e) {
          console.error('Error refreshing history:', e);
          setHistory([]);
        }
      }

      async function save(d) {
        try {
          setSaveStatus('Saving‚Ä¶');
          const storage = makeStorage();
          // Ensure we have a clean copy of the data
          const cleanData = JSON.parse(JSON.stringify(d));
          await storage.set(`day:${today}`, JSON.stringify(cleanData));
          setSaveStatus('Saved ‚úì');
          setTimeout(() => setSaveStatus(''), 2000);
          await refreshHistory();
          setIsExisting(true);
        } catch (e) {
          console.error('Save error', e);
          setSaveStatus('Save failed ‚ùå');
          setTimeout(() => setSaveStatus(''), 3000);
        }
      }

      async function startNewDay() {
        if (!window.confirm('Start a new day? This will snapshot and save the current entry, then reset Today to a fresh entry.')) return;
        const storage = makeStorage();
        try {
          if (data && data.date) {
            await storage.set(`day:${data.date}`, JSON.stringify(data));
          }
          const newData = { date: today, done: [], journal: '', water: 0, saas: '', deepWork: '', talks: '', miles: '', weights: {}, mood: null, workoutDone: false, energyLevel: null };
          setData(JSON.parse(JSON.stringify(newData)));
          setJournal(''); setWater(0); setSaas(''); setDeepWork(''); setTalks(''); setMiles(''); setWeights({});
          await storage.set(`day:${today}`, JSON.stringify(newData));
          await refreshHistory();
          setIsExisting(false);
          setSaveStatus('New day started');
          setTimeout(() => setSaveStatus(''), 2000);
        } catch (e) {
          console.error('New day error', e);
        }
      }

      async function completeWorkout() {
        const storage = makeStorage();
        const selectedWorkoutType = manualWorkoutType || workout.type;

        // Validate that weights are entered for non-running workouts
        if (selectedWorkoutType !== 'running') {
          const workoutExercises = exercises[selectedWorkoutType][workout.var];
          const missingWeights = workoutExercises.filter(ex => !weights[ex]);
          if (missingWeights.length > 0) {
            alert(`Please enter weights for: ${missingWeights.join(', ')}`);
            return;
          }
        }
        const nd = {
          ...data,
          workoutType: selectedWorkoutType,
          workoutDone: true,
          miles: (selectedWorkoutType === 'running' ? miles : undefined),
          weights: (selectedWorkoutType !== 'running' ? { ...weights } : undefined),
          workoutExercises: (selectedWorkoutType !== 'running' ? exercises[selectedWorkoutType][workout.var] : undefined),
          workoutDate: new Date().toISOString()
        };
        const cleanData = JSON.parse(JSON.stringify(nd));
        setData(cleanData);
        await save(cleanData);

        // Show success message
        setSaveStatus('Workout completed! üí™');
        setTimeout(() => setSaveStatus(''), 2000);

        // Update workout rotation
        const idx = rotation.indexOf(workout.type);
        const nextWorkout = { type: rotation[(idx + 1) % rotation.length], var: 0 };
        setWorkout(nextWorkout);
        setWeights({});
        setMiles('');

        // Save the workout rotation
        try {
          await storage.set('workout-rotation', JSON.stringify(nextWorkout));
        } catch (e) {
          console.error('Failed to save workout rotation', e);
        }
      }

      async function toggle(id) {
        if (!data) return;
        const done = data.done.includes(id) ? data.done.filter(x => x !== id) : [...data.done, id];
        const nd = { ...data, done };
        const cleanData = JSON.parse(JSON.stringify(nd));
        setData(cleanData);
        await save(cleanData);
      }

      async function updateWater(n) {
        const nw = Math.max(0, (water || 0) + n);
        setWater(nw);
        const nd = { ...data, water: nw };
        const cleanData = JSON.parse(JSON.stringify(nd));
        setData(cleanData);
        await save(cleanData);
      }

      function genNew() {
        const currentWorkoutType = manualWorkoutType || workout.type;
        if (!workout || currentWorkoutType === 'running') return;
        const vars = exercises[currentWorkoutType] || [];
        setWorkout({ ...workout, var: (workout.var + 1) % Math.max(1, vars.length) });
      }

      // Knowledge Integration Functions
      function generateTodaysApplication() {
        const books = [
          {
            title: "Atomic Habits",
            author: "James Clear",
            application: "Today, identify one habit you want to build and start with a 2-minute version. For example, if you want to read more, commit to reading just one page after breakfast."
          },
          {
            title: "The Power of Habit",
            author: "Charles Duhigg",
            application: "Today, identify your habit loop: pick a cue, routine, and reward for one habit you want to change. Replace the routine while keeping the same cue and reward."
          },
          {
            title: "How to Win Friends",
            author: "Dale Carnegie",
            application: "Today, practice the principle of appreciation: find three people to genuinely compliment or thank before noon. Notice how it affects your interactions."
          },
          {
            title: "Thinking, Fast and Slow",
            author: "Daniel Kahneman",
            application: "Today, catch yourself in 'fast thinking' mode when making a decision. Pause and consciously switch to 'slow thinking' by asking: What information am I missing?"
          },
          {
            title: "The 7 Habits",
            author: "Stephen Covey",
            application: "Today, practice 'begin with the end in mind': Before starting your first task, visualize what success looks like and work backwards from there."
          },
          {
            title: "Deep Work",
            author: "Cal Newport",
            application: "Today, schedule your most important deep work session during your peak energy time. Protect this time fiercely - no email, no notifications."
          },
          {
            title: "The Life-Changing Magic",
            author: "Marie Kondo",
            application: "Today, apply the 'spark joy' test to your digital life: delete 10 apps, unsubscribe from 5 newsletters, and organize one digital folder that sparks confusion."
          },
          {
            title: "Sapiens",
            author: "Yuval Noah Harari",
            application: "Today, question a cultural norm: Pick one societal 'truth' you follow automatically and ask yourself why you believe it. Is it serving you?"
          },
          {
            title: "The Body Keeps Score",
            author: "Bessel van der Kolk",
            application: "Today, practice body awareness: Throughout the day, notice physical sensations in your body. When you feel tension, take 3 deep breaths and relax that area."
          },
          {
            title: "Meditations",
            author: "Marcus Aurelius",
            application: "Today, practice Stoic acceptance: When something doesn't go your way, remind yourself 'This was not in my control' and focus on your response instead."
          }
        ];

        const today = new Date();
        const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
        const bookIndex = dayOfYear % books.length;
        setCurrentBookApplication(books[bookIndex]);
      }

      function addToKnowledgeBase(note) {
        const newEntry = {
          id: Date.now(),
          content: note.content,
          source: note.source,
          category: note.category,
          dateAdded: new Date().toISOString(),
          tags: note.tags || []
        };

        const updatedKnowledge = [newEntry, ...knowledgeBase];
        setKnowledgeBase(updatedKnowledge);
        localStorage.setItem('vita-knowledge-base', JSON.stringify(updatedKnowledge));
      }

      function addToSpacedRepetition(item) {
        const newItem = {
          id: Date.now(),
          content: item.content,
          source: item.source,
          interval: 1, // days
          nextReview: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(), // tomorrow
          easeFactor: 2.5, // SuperMemo default
          repetitions: 0,
          lastReviewed: new Date().toISOString()
        };

        const updatedRepetition = [...spacedRepetition, newItem];
        setSpacedRepetition(updatedRepetition);
        localStorage.setItem('vita-spaced-repetition', JSON.stringify(updatedRepetition));
      }

      function saveReadingProgress(entry) {
        const today = new Date().toDateString();
        const now = new Date();
        const isNewReadingDay = readingProgress.lastReadingDate !== today;

        // Create new reading entry
        const newEntry = {
          id: Date.now(),
          date: now.toISOString(),
          bookTitle: entry.bookTitle || 'Untitled',
          pagesRead: parseInt(entry.pagesRead || 0),
          insights: entry.insights || '',
          notes: entry.notes || ''
        };

        // Update reading history
        const updatedHistory = [newEntry, ...readingHistory];
        setReadingHistory(updatedHistory);
        localStorage.setItem('vita-reading-history', JSON.stringify(updatedHistory));

        // Update reading progress stats
        const updatedProgress = {
          ...readingProgress,
          pagesRead: readingProgress.pagesRead + parseInt(entry.pagesRead || 0),
          insightsGained: readingProgress.insightsGained + (entry.insights ? 1 : 0),
          currentStreak: isNewReadingDay ? readingProgress.currentStreak + 1 : readingProgress.currentStreak,
          longestStreak: Math.max(readingProgress.longestStreak, readingProgress.currentStreak + (isNewReadingDay ? 1 : 0)),
          lastReadingDate: today
        };

        setReadingProgress(updatedProgress);
        localStorage.setItem('vita-reading-progress', JSON.stringify(updatedProgress));
        setReadingEntry({ bookTitle: '', pagesRead: '', insights: '', notes: '' });
        setShowReadingModal(false);
        setSaveStatus('üìö Reading progress saved!');
        setTimeout(() => setSaveStatus(''), 3000);
      }

      function reviewSpacedItem(itemId, quality) {
        // SuperMemo-2 algorithm for spaced repetition
        const item = spacedRepetition.find(i => i.id === itemId);
        if (!item) return;

        let newInterval, newEaseFactor;

        if (quality >= 3) { // Correct response
          if (item.repetitions === 0) {
            newInterval = 1;
          } else if (item.repetitions === 1) {
            newInterval = 6;
          } else {
            newInterval = Math.round(item.interval * item.easeFactor);
          }

          newEaseFactor = item.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));
        } else { // Incorrect response
          newInterval = 1;
          newEaseFactor = item.easeFactor;
        }

        newEaseFactor = Math.max(1.3, newEaseFactor);

        const updatedItem = {
          ...item,
          interval: newInterval,
          easeFactor: newEaseFactor,
          repetitions: quality >= 3 ? item.repetitions + 1 : 0,
          nextReview: new Date(Date.now() + newInterval * 24 * 60 * 60 * 1000).toISOString(),
          lastReviewed: new Date().toISOString()
        };

        const updatedRepetition = spacedRepetition.map(i =>
          i.id === itemId ? updatedItem : i
        ).filter(i => new Date(i.nextReview) > new Date()); // Remove completed items

        setSpacedRepetition(updatedRepetition);
        localStorage.setItem('vita-spaced-repetition', JSON.stringify(updatedRepetition));
      }

      // Challenge Management Functions
      function createChallenge(challengeData) {
        const newChallenge = {
          id: Date.now(),
          title: challengeData.title,
          description: challengeData.description,
          duration: challengeData.duration,
          category: challengeData.category,
          type: challengeData.type, // 'habit', 'avoid', 'track'
          target: challengeData.target,
          unit: challengeData.unit,
          reward: challengeData.reward,
          createdAt: new Date().toISOString(),
          startDate: new Date().toISOString(),
          completed: false,
          progress: [],
          currentStreak: 0,
          bestStreak: 0
        };

        const updatedChallenges = [...challenges, newChallenge];
        setChallenges(updatedChallenges);
        localStorage.setItem('vita-challenges', JSON.stringify([...updatedChallenges, ...completedChallenges]));
      }

      function updateChallengeProgress(challengeId, completed) {
        const challenge = challenges.find(c => c.id === challengeId);
        if (!challenge) return;

        const today = new Date().toISOString().split('T')[0];
        const existingProgress = challenge.progress.find(p => p.date === today);

        let newProgress;
        if (existingProgress) {
          newProgress = challenge.progress.map(p =>
            p.date === today ? { ...p, completed } : p
          );
        } else {
          newProgress = [...challenge.progress, { date: today, completed }];
        }

        // Calculate streaks
        const sortedProgress = newProgress.sort((a, b) => new Date(b.date) - new Date(a.date));
        let currentStreak = 0;
        let bestStreak = challenge.bestStreak;

        for (const day of sortedProgress) {
          if (day.completed) {
            currentStreak++;
          } else {
            break;
          }
        }

        bestStreak = Math.max(bestStreak, currentStreak);

        const updatedChallenge = {
          ...challenge,
          progress: newProgress,
          currentStreak,
          bestStreak
        };

        // Check if challenge is completed
        const challengeEndDate = new Date(challenge.startDate);
        challengeEndDate.setDate(challengeEndDate.getDate() + challenge.duration);

        if (new Date() >= challengeEndDate && currentStreak >= Math.ceil(challenge.duration * 0.8)) {
          // Challenge completed successfully
          updatedChallenge.completed = true;
          updatedChallenge.completedAt = new Date().toISOString();

          // Award badge
          awardBadge({
            name: `${challenge.title} Champion`,
            description: `Completed ${challenge.duration}-day ${challenge.category} challenge`,
            icon: getBadgeIcon(challenge.category),
            earnedAt: new Date().toISOString(),
            challengeId: challenge.id
          });

          setCompletedChallenges(prev => [...prev, updatedChallenge]);
          setChallenges(prev => prev.filter(c => c.id !== challengeId));
        } else {
          setChallenges(prev => prev.map(c => c.id === challengeId ? updatedChallenge : c));
        }

        localStorage.setItem('vita-challenges', JSON.stringify([...challenges.filter(c => c.id !== challengeId).map(c => c.id === challengeId ? updatedChallenge : c), ...completedChallenges]));
      }

      function awardBadge(badge) {
        const newBadges = [...badges, badge];
        setBadges(newBadges);
        localStorage.setItem('vita-badges', JSON.stringify(newBadges));
      }

      function getBadgeIcon(category) {
        const icons = {
          fitness: 'üí™',
          discipline: 'üéØ',
          nutrition: 'ü•ó',
          reading: 'üìö',
          mindfulness: 'üßò',
          sleep: 'üò¥',
          productivity: 'üöÄ',
          social: 'ü§ù'
        };
        return icons[category] || 'üèÜ';
      }

      function getSuggestedChallenges() {
        return [
          {
            title: "7-Day Discipline Challenge",
            description: "Complete all daily tasks for 7 consecutive days",
            duration: 7,
            category: 'discipline',
            type: 'habit',
            target: 1,
            unit: 'days',
            reward: 'Consistency Badge'
          },
          {
            title: "30-Day Fitness Challenge",
            description: "Complete a workout every day for 30 days",
            duration: 30,
            category: 'fitness',
            type: 'habit',
            target: 1,
            unit: 'workouts',
            reward: 'Fitness Champion Badge'
          },
          {
            title: "No Sugar for 10 Days",
            description: "Avoid all added sugars for 10 consecutive days",
            duration: 10,
            category: 'nutrition',
            type: 'avoid',
            target: 0,
            unit: 'sugar items',
            reward: 'Sugar-Free Badge'
          },
          {
            title: "Read 10 Minutes Daily for 14 Days",
            description: "Read for at least 10 minutes every day",
            duration: 14,
            category: 'reading',
            type: 'habit',
            target: 10,
            unit: 'minutes',
            reward: 'Reading Habit Badge'
          },
          {
            title: "Mindful Morning Routine",
            description: "Practice 10 minutes of mindfulness or meditation daily",
            duration: 21,
            category: 'mindfulness',
            type: 'habit',
            target: 10,
            unit: 'minutes',
            reward: 'Mindfulness Master Badge'
          },
          {
            title: "Sleep Champion",
            description: "Get 7+ hours of sleep every night",
            duration: 14,
            category: 'sleep',
            type: 'habit',
            target: 7,
            unit: 'hours',
            reward: 'Sleep Champion Badge'
          }
        ];
      }

      // AI Life Coach Functions
      function generateAICoachInsights() {
        if (history.length < 3) {
          return {
            dailyFocus: "Keep tracking your activities to receive personalized coaching insights.",
            weeklyReview: "Not enough data yet for weekly analysis.",
            monthlyReflection: "Continue building your data for monthly reflections.",
            personalizedSuggestions: [],
            patternInsights: [],
            priorityActions: []
          };
        }

        // Analyze daily focus based on current patterns
        const today = new Date();
        const dayOfWeek = today.toLocaleDateString('en-US', { weekday: 'long' });
        const recentWeek = history.slice(-7);

        // Daily focus analysis
        let dailyFocus = "";

        // Check for concerning patterns
        const avgTasks = recentWeek.reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / recentWeek.length;
        const avgMood = recentWeek.filter(d => d.mood).length / recentWeek.length;
        const workoutStreak = recentWeek.filter(d => d.workoutDone).length;

        if (avgTasks < 10) {
          dailyFocus = "Focus on building momentum with small, consistent actions. Start with your most important 3 tasks today.";
        } else if (workoutStreak < 3) {
          dailyFocus = "Your body thrives on movement. Schedule a workout today - even 20 minutes makes a difference.";
        } else if (avgMood < 0.7) {
          dailyFocus = "Prioritize emotional wellbeing today. Consider a walk in nature or connecting with someone meaningful.";
        } else {
          dailyFocus = "You're on a strong trajectory! Today, focus on deepening one key habit or relationship.";
        }

        // Weekly review analysis
        const weeklyStats = {
          totalTasks: recentWeek.reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0),
          workoutsCompleted: recentWeek.filter(d => d.workoutDone).length,
          avgMoodScore: recentWeek.filter(d => d.mood).map(d => {
            const scores = { 'üòä Sharp': 5, 'üôÇ Good': 4, 'üòê Okay': 3, 'üòî Off': 2, 'üò∞ Hard': 1 };
            return scores[d.mood] || 3;
          }).reduce((a, b) => a + b, 0) / Math.max(1, recentWeek.filter(d => d.mood).length),
          readingDays: recentWeek.filter(d => d.done && d.done.some(task => task.includes('read'))).length,
          socialDays: recentWeek.filter(d => d.done && d.done.some(task => task.includes('connect') || task.includes('social'))).length
        };

        let weeklyReview = `This week you completed ${weeklyStats.totalTasks} tasks and ${weeklyStats.workoutsCompleted} workouts. `;

        if (weeklyStats.avgMoodScore >= 4) {
          weeklyReview += "Your emotional wellbeing has been strong. ";
        } else if (weeklyStats.avgMoodScore >= 3) {
          weeklyReview += "Your mood has been stable but could use some attention. ";
        } else {
          weeklyReview += "Your emotional state needs nurturing. ";
        }

        if (weeklyStats.readingDays >= 4) {
          weeklyReview += "Excellent reading consistency! ";
        } else if (weeklyStats.readingDays >= 2) {
          weeklyReview += "Good reading habits developing. ";
        } else {
          weeklyReview += "Consider building a daily reading ritual. ";
        }

        weeklyReview += "Next week, focus on sustaining your strongest habits while gently improving areas of opportunity.";

        // Monthly reflection (based on last 30 days)
        const monthlyData = history.slice(-30);
        let monthlyReflection = "";

        if (monthlyData.length >= 30) {
          const monthlyStats = {
            avgDailyTasks: monthlyData.reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 30,
            workoutConsistency: monthlyData.filter(d => d.workoutDone).length / 30,
            moodConsistency: monthlyData.filter(d => d.mood).length / 30,
            bestStreak: (() => {
              let currentStreak = 0;
              let maxStreak = 0;
              for (const day of monthlyData) {
                if (day.done && day.done.length > 0) {
                  currentStreak++;
                  maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                  currentStreak = 0;
                }
              }
              return maxStreak;
            })()
          };

          monthlyReflection = `This month, you've shown remarkable ${monthlyStats.workoutConsistency > 0.7 ? 'physical' : monthlyStats.avgDailyTasks > 15 ? 'productive' : 'personal'} consistency. `;

          if (monthlyStats.bestStreak > 10) {
            monthlyReflection += `Your ${monthlyStats.bestStreak}-day streak demonstrates incredible discipline. `;
          }

          monthlyReflection += "Reflect on what systems and mindsets made this possible, and consider how to apply these insights to new areas of growth.";
        } else {
          monthlyReflection = "Continue building your data foundation. Monthly reflections become most valuable after consistent tracking for several weeks.";
        }

        // Personalized suggestions based on patterns
        const personalizedSuggestions = [];

        // Analyze productivity patterns
        const productivityByDay = {};
        recentWeek.forEach(day => {
          const dayName = new Date(day.date).toLocaleDateString('en-US', { weekday: 'short' });
          productivityByDay[dayName] = (productivityByDay[dayName] || 0) + (day.done ? day.done.length : 0);
        });

        const mostProductiveDay = Object.entries(productivityByDay).sort(([,a], [,b]) => b - a)[0]?.[0];
        if (mostProductiveDay) {
          personalizedSuggestions.push({
            type: 'productivity',
            title: 'Optimize Your Schedule',
            suggestion: `Schedule important work for ${mostProductiveDay}s when you're naturally most productive.`,
            icon: 'üìÖ'
          });
        }

        // Energy pattern analysis
        const energyPatterns = recentWeek.filter(d => d.energyLevel);
        if (energyPatterns.length >= 3) {
          const highEnergyDays = energyPatterns.filter(d => d.energyLevel === 'high').length;
          const lowEnergyDays = energyPatterns.filter(d => d.energyLevel === 'low' || d.energyLevel === 'exhausted').length;

          if (highEnergyDays > lowEnergyDays) {
            personalizedSuggestions.push({
              type: 'energy',
              title: 'Leverage Peak Energy',
              suggestion: 'Use your high-energy periods for challenging tasks and creative work.',
              icon: '‚ö°'
            });
          } else {
            personalizedSuggestions.push({
              type: 'energy',
              title: 'Energy Management',
              suggestion: 'Focus on sleep, nutrition, and recovery to improve baseline energy levels.',
              icon: 'üîã'
            });
          }
        }

        // Social connection analysis
        const socialPatterns = recentWeek.filter(d => d.done && d.done.some(task =>
          task.includes('connect') || task.includes('social') || task.includes('friend')
        ));

        if (socialPatterns.length < 2) {
          personalizedSuggestions.push({
            type: 'social',
            title: 'Build Social Connections',
            suggestion: 'Schedule regular social interactions - they\'re crucial for emotional wellbeing.',
            icon: 'ü§ù'
          });
        }

        // Reading habit analysis
        const readingPatterns = recentWeek.filter(d => d.done && d.done.some(task => task.includes('read')));

        if (readingPatterns.length >= 5) {
          personalizedSuggestions.push({
            type: 'growth',
            title: 'Deepen Reading Practice',
            suggestion: 'Consider joining a book club or starting a reading journal to enhance comprehension.',
            icon: 'üìö'
          });
        } else if (readingPatterns.length < 2) {
          personalizedSuggestions.push({
            type: 'growth',
            title: 'Cultivate Reading Habit',
            suggestion: 'Start with 10 minutes daily. Reading compounds knowledge exponentially.',
            icon: 'üìñ'
          });
        }

        // Pattern insights
        const patternInsights = [];

        // Workout-mood correlation
        const workoutMoodData = recentWeek.filter(d => d.mood && d.workoutDone !== undefined);
        if (workoutMoodData.length >= 4) {
          const workoutDaysMood = workoutMoodData.filter(d => d.workoutDone).map(d => {
            const scores = { 'üòä Sharp': 5, 'üôÇ Good': 4, 'üòê Okay': 3, 'üòî Off': 2, 'üò∞ Hard': 1 };
            return scores[d.mood] || 3;
          }).reduce((a, b) => a + b, 0) / workoutMoodData.filter(d => d.workoutDone).length;

          const nonWorkoutDaysMood = workoutMoodData.filter(d => !d.workoutDone).map(d => {
            const scores = { 'üòä Sharp': 5, 'üôÇ Good': 4, 'üòê Okay': 3, 'üòî Off': 2, 'üò∞ Hard': 1 };
            return scores[d.mood] || 3;
          }).reduce((a, b) => a + b, 0) / Math.max(1, workoutMoodData.filter(d => !d.workoutDone).length);

          if (workoutDaysMood > nonWorkoutDaysMood + 0.5) {
            patternInsights.push({
              title: 'Movement Boosts Mood',
              insight: 'Your workouts correlate with improved emotional state. Exercise could be your natural mood enhancer.',
              impact: 'High'
            });
          }
        }

        // Priority actions based on current state
        const priorityActions = [];

        // Check for immediate needs
        const todayData = history[history.length - 1];
        if (todayData) {
          if (!todayData.mood) {
            priorityActions.push({
              action: 'Set your mood for today',
              reason: 'Mood tracking helps identify patterns and improve emotional awareness',
              urgency: 'medium'
            });
          }

          if (!todayData.workoutDone && workoutStreak >= 3) {
            priorityActions.push({
              action: 'Complete today\'s workout',
              reason: 'You\'re on a workout streak - don\'t break the momentum!',
              urgency: 'high'
            });
          }

          if ((todayData.done ? todayData.done.length : 0) < 5) {
            priorityActions.push({
              action: 'Focus on high-impact tasks',
              reason: 'Starting your day with key accomplishments builds momentum',
              urgency: 'medium'
            });
          }
        }

        return {
          dailyFocus,
          weeklyReview,
          monthlyReflection,
          personalizedSuggestions,
          patternInsights,
          priorityActions
        };
      }

      console.log('Checking loading state:', { loading, data, workout });

      if (loading || !data || !workout) {
        console.log('Still loading, showing loading screen');
        return (
          <div className="flex items-center justify-center h-screen">
            <div className="text-xl text-gray-300">Loading‚Ä¶</div>
          </div>
        );
      }

      console.log('Loading complete, rendering main app');

      if (view === 'workouts') {
        const currentWorkoutType = manualWorkoutType || workout.type;
        const ex = currentWorkoutType === 'running' ? null : exercises[currentWorkoutType][workout.var];
        return (
          <div className="min-h-screen p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-2 justify-center mb-6">
                <button onClick={() => setView('today')} className="px-6 py-2 bg-slate-700 rounded-lg">Today</button>
                <button onClick={() => setView('progress')} className="px-6 py-2 bg-slate-700 rounded-lg">Progress</button>
                <button onClick={() => setView('workouts')} className="px-6 py-2 bg-amber-600 text-white rounded-lg">Workouts</button>
              </div>
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-6">
                <div className="flex justify-between items-center mb-4">
                  <div className="flex-1">
                    <h2 className="text-2xl font-bold">Today: {labels[manualWorkoutType || workout.type]}</h2>
                    <p className="text-sm text-gray-400 mb-2">
                      {manualWorkoutType ? `üéØ Manual selection ‚Ä¢ Suggested: ${labels[workout.type]}` : `üìÖ Suggested ‚Ä¢ Next: ${labels[rotation[(rotation.indexOf(workout.type) + 1) % rotation.length]]}`}
                    </p>
                    <div className="flex items-center gap-2">
                      <select
                        value={manualWorkoutType || workout.type}
                        onChange={(e) => setManualWorkoutType(e.target.value === workout.type ? null : e.target.value)}
                        className="px-3 py-1 bg-slate-700 border border-slate-600 rounded text-white text-sm"
                      >
                        <option value={workout.type}>üìÖ {labels[workout.type]} (Suggested)</option>
                        {rotation.filter(type => type !== workout.type).map(type => (
                          <option key={type} value={type}>üéØ {labels[type]}</option>
                        ))}
                      </select>
                      {manualWorkoutType && (
                        <button
                          onClick={() => setManualWorkoutType(null)}
                          className="px-2 py-1 bg-slate-600 text-white rounded text-xs hover:bg-slate-500"
                          title="Reset to suggested workout"
                        >
                          Reset
                        </button>
                      )}
                    </div>
                  </div>
                  <div>
                    {(manualWorkoutType || workout.type) !== 'running' && (
                      <button onClick={genNew} className="px-4 py-2 bg-slate-700 rounded">New Exercises</button>
                    )}
                  </div>
                </div>
                {currentWorkoutType === 'running' ? (
                  <div className="space-y-4">
                    <input type="number" step="0.1" value={miles} onChange={(e) => setMiles(e.target.value)} placeholder="Miles run" className="w-full p-3 bg-slate-700 rounded text-white" />
                    <div className="flex gap-2">
                      <button
                        onClick={async () => {
                          const workoutProgress = {
                            type: workout.type,
                            var: workout.var,
                            weights: weights,
                            miles: miles,
                            savedAt: new Date().toISOString()
                          };
                          localStorage.setItem('vita-workout-progress', JSON.stringify(workoutProgress));
                          setSaveStatus('Progress saved! üíæ');
                          setTimeout(() => setSaveStatus(''), 2000);
                        }}
                        className="flex-1 py-2 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700 transition-colors"
                      >
                        üíæ Save Progress
                      </button>
                      <button onClick={completeWorkout} disabled={!miles || data.workoutDone} className="flex-1 py-2 bg-green-600 rounded font-semibold disabled:bg-slate-600">{data.workoutDone ? '‚úì Done' : 'Complete'}</button>
                    </div>
                  </div>
                ) : (
                  <div className="space-y-3">
                    {ex.map((e, i) => (
                      <div key={i} className={`bg-slate-700 rounded-lg p-4 ${data.workoutDone ? 'opacity-75' : ''}`}>
                        <div className="font-medium mb-2 flex items-center justify-between">
                          <span>{e}</span>
                          {data.workoutDone && weights[e] && <span className="text-green-400 text-sm">‚úì Saved</span>}
                        </div>
                        <input
                          type="number"
                          placeholder="Weight (lbs)"
                          value={weights[e] || ''}
                          onChange={(ev) => setWeights({...weights, [e]: ev.target.value})}
                          className={`w-full p-2 bg-slate-600 rounded text-sm text-white ${data.workoutDone ? 'cursor-not-allowed' : ''}`}
                          disabled={data.workoutDone}
                        />
                        {data.workoutDone && weights[e] && (
                          <p className="text-xs text-gray-400 mt-1">Previous: {weights[e]} lbs</p>
                        )}
                      </div>
                    ))}
                    <div className="flex gap-2">
                      <button
                        onClick={async () => {
                          const workoutProgress = {
                            type: workout.type,
                            var: workout.var,
                            weights: weights,
                            miles: miles,
                            savedAt: new Date().toISOString()
                          };
                          localStorage.setItem('vita-workout-progress', JSON.stringify(workoutProgress));
                          setSaveStatus('Progress saved! üíæ');
                          setTimeout(() => setSaveStatus(''), 2000);
                        }}
                        className="flex-1 py-2 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700 transition-colors"
                      >
                        üíæ Save Progress
                      </button>
                      <button onClick={completeWorkout} disabled={data.workoutDone} className="flex-1 py-2 bg-green-600 rounded font-semibold disabled:bg-slate-600">
                        {data.workoutDone ? '‚úì Workout Completed' : 'Complete Workout'}
                      </button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      if (view === 'affirmations') {
        // Personalized affirmations based on user's goals and progress
        const affirmations = {
          general: [
            "I am becoming the best version of myself every day",
            "I have the power to create the life I desire",
            "Every challenge I face is an opportunity to grow stronger",
            "I am worthy of success and happiness",
            "My potential is limitless and I unlock it daily",
            "I choose progress over perfection",
            "I am grateful for my journey and excited for what comes next",
            "I radiate confidence and positive energy",
            "I am capable of achieving extraordinary things",
            "Today, I choose to be unstoppable"
          ],
          productivity: [
            "I am focused, disciplined, and productive in all my endeavors",
            "Deep work is my superpower and I master it daily",
            "I complete important tasks with ease and efficiency",
            "My time is valuable and I use it wisely",
            "I set clear goals and achieve them consistently",
            "I am a master of my schedule and priorities",
            "Procrastination has no power over me",
            "I work with purpose and passion every day",
            "My productivity creates lasting impact",
            "I accomplish more than I thought possible"
          ],
          health: [
            "My body is strong, healthy, and full of energy",
            "I nourish my body with healthy choices",
            "Every workout brings me closer to my ideal self",
            "I am committed to my physical and mental wellbeing",
            "Rest and recovery are essential parts of my strength",
            "I treat my body with love and respect",
            "My health is my foundation for success",
            "I move my body with joy and purpose",
            "I am grateful for my body's incredible capabilities",
            "Healthy habits are my daily celebration of self-love"
          ],
          mindset: [
            "I think positively and attract positive outcomes",
            "Challenges are opportunities in disguise",
            "I learn and grow from every experience",
            "My mindset determines my reality",
            "I choose faith over fear in every situation",
            "I am resilient and bounce back stronger",
            "My thoughts create my reality",
            "I embrace change and adapt with grace",
            "I am the author of my own story",
            "Every day brings new possibilities and growth"
          ],
          leadership: [
            "I lead with integrity and inspire others",
            "My hard conversations create meaningful change",
            "I own my mistakes and learn from them",
            "I help others grow and succeed",
            "I lead by example in all I do",
            "My leadership creates positive impact",
            "I communicate clearly and effectively",
            "I build strong relationships and trust",
            "I take initiative and responsibility",
            "I am a force for positive change"
          ]
        };

        // Get today's affirmation based on user's recent focus
        const getTodaysAffirmation = () => {
          const today = new Date();
          const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();

          // Check recent activity to personalize
          const recentTasks = history.slice(0, 3).flatMap(d => d.done || []);
          const hasProductivity = recentTasks.some(t => ['deep', 'progress', 'priorities'].includes(t));
          const hasLeadership = recentTasks.some(t => ['hard', 'own', 'help'].includes(t));
          const hasWorkout = history.slice(0, 3).some(d => d.workoutDone);

          let category = 'general';
          if (hasProductivity && hasLeadership) category = 'leadership';
          else if (hasProductivity) category = 'productivity';
          else if (hasWorkout) category = 'health';
          else if (Math.random() > 0.7) category = 'mindset';

          const categoryAffirmations = affirmations[category];
          return categoryAffirmations[seed % categoryAffirmations.length];
        };

        const todaysAffirmation = getTodaysAffirmation();
        const affirmationCategory = todaysAffirmation.includes('productivity') || todaysAffirmation.includes('work') ? 'productivity' :
                                   todaysAffirmation.includes('health') || todaysAffirmation.includes('body') ? 'health' :
                                   todaysAffirmation.includes('leadership') || todaysAffirmation.includes('lead') ? 'leadership' :
                                   todaysAffirmation.includes('mindset') || todaysAffirmation.includes('think') ? 'mindset' : 'general';

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-2 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-4 py-2 bg-slate-700 text-gray-300 rounded-lg text-sm">Today</button>
                <button onClick={() => setView('progress')} className="px-4 py-2 bg-slate-700 text-gray-300 rounded-lg text-sm">Progress</button>
                <button onClick={() => setView('workouts')} className="px-4 py-2 bg-slate-700 text-gray-300 rounded-lg text-sm">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-4 py-2 bg-amber-600 text-white rounded-lg text-sm">Affirmations</button>
              </div>

              {/* Today's Main Affirmation */}
              <div className="bg-slate-800 rounded-xl p-8 mb-6 border border-slate-700 text-center">
                <div className="mb-4">
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    affirmationCategory === 'productivity' ? 'bg-blue-600' :
                    affirmationCategory === 'health' ? 'bg-green-600' :
                    affirmationCategory === 'leadership' ? 'bg-purple-600' :
                    affirmationCategory === 'mindset' ? 'bg-yellow-600' :
                    'bg-amber-600'
                  } text-white`}>
                    {affirmationCategory.charAt(0).toUpperCase() + affirmationCategory.slice(1)}
                  </span>
                </div>
                <h2 className="text-2xl md:text-3xl font-bold text-white mb-4 leading-relaxed">
                  "{todaysAffirmation}"
                </h2>
                <p className="text-gray-400 text-sm">Your affirmation for {new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
              </div>

              {/* Quick Affirmation Categories */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-3 text-blue-400">üíº Productivity</h3>
                  <p className="text-sm text-gray-300 mb-3">{affirmations.productivity[Math.floor(Math.random() * affirmations.productivity.length)]}</p>
                  <button className="w-full py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors">
                    Get New One
                  </button>
                </div>

                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-3 text-green-400">üí™ Health & Fitness</h3>
                  <p className="text-sm text-gray-300 mb-3">{affirmations.health[Math.floor(Math.random() * affirmations.health.length)]}</p>
                  <button className="w-full py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 transition-colors">
                    Get New One
                  </button>
                </div>

                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-3 text-purple-400">üëë Leadership</h3>
                  <p className="text-sm text-gray-300 mb-3">{affirmations.leadership[Math.floor(Math.random() * affirmations.leadership.length)]}</p>
                  <button className="w-full py-2 bg-purple-600 text-white rounded-lg text-sm hover:bg-purple-700 transition-colors">
                    Get New One
                  </button>
                </div>

                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-3 text-yellow-400">üß† Mindset</h3>
                  <p className="text-sm text-gray-300 mb-3">{affirmations.mindset[Math.floor(Math.random() * affirmations.mindset.length)]}</p>
                  <button className="w-full py-2 bg-yellow-600 text-white rounded-lg text-sm hover:bg-yellow-700 transition-colors">
                    Get New One
                  </button>
                </div>
              </div>

              {/* Inspiration Section */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-3">üí° Daily Inspiration</h3>
                <div className="space-y-3 text-sm text-gray-300">
                  <p><strong>Remember:</strong> Every expert was once a beginner. Every champion was once afraid to start.</p>
                  <p><strong>Action:</strong> The bridge between your goals and accomplishment is your daily actions.</p>
                  <p><strong>Growth:</strong> You're not competing with anyone else. You're competing with who you were yesterday.</p>
                  <p><strong>Resilience:</strong> The only way to fail is to stop trying. Every setback is a setup for a comeback.</p>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'coach') {
        // Calculate streaks and insights
        const calculateStreaks = () => {
          const streaks = {
            current: 0,
            longest: 0,
            workoutStreak: 0,
            longestWorkout: 0
          };

          // Task completion streak
          for (let i = 0; i < history.length; i++) {
            if (history[i].done && history[i].done.length > 0) {
              streaks.current++;
            } else {
              streaks.longest = Math.max(streaks.longest, streaks.current);
              streaks.current = 0;
            }
          }
          streaks.longest = Math.max(streaks.longest, streaks.current);

          // Workout streak
          for (let i = 0; i < history.length; i++) {
            if (history[i].workoutDone) {
              streaks.workoutStreak++;
            } else {
              streaks.longestWorkout = Math.max(streaks.longestWorkout, streaks.workoutStreak);
              streaks.workoutStreak = 0;
            }
          }
          streaks.longestWorkout = Math.max(streaks.longestWorkout, streaks.workoutStreak);

          return streaks;
        };

        const streaks = calculateStreaks();
        const todayTasks = data.done ? data.done.length : 0;
        const avgTasks = history.length > 0 ? Math.round((history.reduce((s, d) => s + (d.done ? d.done.length : 0), 0) / history.length) * 10) / 10 : 0;

        // Generate personalized coaching message
        const getCoachingMessage = () => {
          const messages = {
            excellent: [
              "üöÄ INCREDIBLE! You're crushing it! Keep this momentum going!",
              "üí™ You're in BEAST MODE! This level of consistency is rare and valuable.",
              "üåü You're not just participating, you're DOMINATING your growth journey!",
              "üèÜ LEGENDARY performance! You're setting the standard for excellence."
            ],
            great: [
              "üî• Great work! You're building habits that will change your life.",
              "üí™ Solid progress! Consistency like yours creates extraordinary results.",
              "üéØ You're on fire! Keep channeling this energy into your goals.",
              "‚≠ê Excellent momentum! You're becoming the person you want to be."
            ],
            good: [
              "üëç Good job! Every step forward counts. Keep building these habits.",
              "üí™ Steady progress! Small, consistent actions create big changes.",
              "üéØ You're moving in the right direction. Stay focused on your goals.",
              "‚≠ê Keep it up! You're developing habits that will serve you for life."
            ],
            needsImprovement: [
              "üí™ Let's get back on track! Remember why you started this journey.",
              "üéØ Every champion has off days. Today is your chance to get back to winning.",
              "üî• Your future self is counting on you. Let's make today count!",
              "üí™ You've got this! One strong day can restart your momentum."
            ]
          };

          if (streaks.current >= 7) return messages.excellent[Math.floor(Math.random() * messages.excellent.length)];
          if (streaks.current >= 3) return messages.great[Math.floor(Math.random() * messages.great.length)];
          if (todayTasks > 0) return messages.good[Math.floor(Math.random() * messages.good.length)];
          return messages.needsImprovement[Math.floor(Math.random() * messages.needsImprovement.length)];
        };

        const coachingMessage = getCoachingMessage();

        // Extended habit tracking beyond core tasks
        const extendedHabits = [
          { id: 'reading', name: 'Read for 30+ minutes', category: 'learning', streak: 0 },
          { id: 'meditation', name: 'Meditate or mindfulness', category: 'mindfulness', streak: 0 },
          { id: 'networking', name: 'Connect with someone meaningful', category: 'social', streak: 0 },
          { id: 'learning', name: 'Learn something new (skill/course)', category: 'growth', streak: 0 },
          { id: 'gratitude', name: 'Write 3 things grateful for', category: 'mindfulness', streak: 0 },
          { id: 'planning', name: 'Review and plan tomorrow', category: 'productivity', streak: 0 }
        ];

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-2 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Today</button>
                <button onClick={() => setView('progress')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Progress</button>
                <button onClick={() => setView('workouts')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Affirmations</button>
                <button onClick={() => setView('coach')} className="px-3 py-2 bg-amber-600 text-white rounded-lg text-xs">Coach</button>
              </div>

              {/* Personalized Coaching Message */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <h2 className="text-xl font-bold mb-4 text-center text-amber-400">üèÜ Your Accountability Coach</h2>
                <div className="text-center">
                  <p className="text-lg text-white mb-4 leading-relaxed">{coachingMessage}</p>
                  <div className="flex justify-center gap-4 text-sm">
                    <div className="bg-slate-700 px-3 py-2 rounded">
                      <span className="text-gray-400">Current Streak:</span>
                      <span className="text-amber-400 font-bold ml-1">{streaks.current} days</span>
                    </div>
                    <div className="bg-slate-700 px-3 py-2 rounded">
                      <span className="text-gray-400">Best Streak:</span>
                      <span className="text-green-400 font-bold ml-1">{streaks.longest} days</span>
                    </div>
                  </div>
                </div>
              </div>

              {/* Today's Performance */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 text-center">
                  <h3 className="text-sm font-bold text-gray-400 mb-2">Today's Tasks</h3>
                  <p className="text-3xl font-bold text-amber-400">{todayTasks}/18</p>
                  <p className="text-xs text-gray-500">completed</p>
                </div>
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 text-center">
                  <h3 className="text-sm font-bold text-gray-400 mb-2">Average Tasks</h3>
                  <p className="text-3xl font-bold text-blue-400">{avgTasks}/18</p>
                  <p className="text-xs text-gray-500">per day</p>
                </div>
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 text-center">
                  <h3 className="text-sm font-bold text-gray-400 mb-2">Workout Streak</h3>
                  <p className="text-3xl font-bold text-green-400">{streaks.workoutStreak}</p>
                  <p className="text-xs text-gray-500">days</p>
                </div>
              </div>

              {/* Extended Habit Tracking */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-4">üéØ Extended Habit Tracking</h3>
                <p className="text-sm text-gray-400 mb-4">Track additional habits beyond your core tasks for comprehensive personal development.</p>
                <div className="space-y-3">
                  {extendedHabits.map(habit => (
                    <div key={habit.id} className="bg-slate-700 rounded-lg p-4">
                      <div className="flex items-center justify-between mb-2">
                        <span className="font-medium">{habit.name}</span>
                        <span className={`px-2 py-1 rounded text-xs ${
                          habit.category === 'learning' ? 'bg-blue-600' :
                          habit.category === 'mindfulness' ? 'bg-purple-600' :
                          habit.category === 'social' ? 'bg-green-600' :
                          habit.category === 'growth' ? 'bg-yellow-600' :
                          'bg-gray-600'
                        } text-white`}>
                          {habit.category}
                        </span>
                      </div>
                      <div className="flex gap-2">
                        <button className="flex-1 py-2 bg-slate-600 text-white rounded text-sm hover:bg-slate-500">
                          Track Today
                        </button>
                        <div className="px-3 py-2 bg-slate-600 rounded text-sm text-gray-300">
                          Streak: 0 days
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Progress Insights */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-4">üìä Progress Insights</h3>
                <div className="space-y-4">
                  <div className="flex items-center justify-between p-3 bg-slate-700 rounded">
                    <span>Weekly Goal Progress</span>
                    <span className="text-amber-400 font-bold">
                      {history.slice(0, 7).filter(d => d.done && d.done.length > 0).length}/7 days
                    </span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-700 rounded">
                    <span>Consistency Rating</span>
                    <span className={`font-bold ${
                      streaks.current >= 7 ? 'text-green-400' :
                      streaks.current >= 3 ? 'text-yellow-400' :
                      'text-red-400'
                    }`}>
                      {streaks.current >= 7 ? 'Excellent' : streaks.current >= 3 ? 'Good' : 'Needs Focus'}
                    </span>
                  </div>
                  <div className="flex items-center justify-between p-3 bg-slate-700 rounded">
                    <span>Next Milestone</span>
                    <span className="text-blue-400">
                      {streaks.longest + 1} day streak
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'books') {

        // Curated book database for self-improvement and entrepreneurship
        const bookDatabase = {
          productivity: [
            {
              title: "Deep Work",
              author: "Cal Newport",
              summary: "In an age of constant distraction, Cal Newport argues that the ability to perform deep work‚Äîfocused, cognitively demanding tasks‚Äîis becoming increasingly rare and valuable. Newport explores the concept of deep work versus shallow work, showing how deep work leads to higher quality output and greater satisfaction. He provides practical strategies for cultivating deep work habits, including scheduling rituals, creating the right environment, and embracing boredom. The book challenges the notion that connectivity and multitasking are virtues, instead advocating for deliberate disconnection to achieve meaningful results.",
              keyInsights: [
                "Deep work is the ability to focus without distraction on cognitively demanding tasks",
                "Schedule deep work sessions and protect them fiercely",
                "Minimize shallow work that doesn't create value",
                "Train your concentration through deliberate practice",
                "Embrace boredom to build mental resilience",
                "Quit social media if it hinders your deep work"
              ],
              whyRead: "Master the skill of focused, distraction-free work in our hyper-connected world"
            },
            {
              title: "Atomic Habits",
              author: "James Clear",
              summary: "James Clear reveals how small changes can create remarkable results through the power of habit compounding. Drawing on scientific research, Clear explains the psychology behind habit formation and provides a practical framework for building good habits and breaking bad ones. He introduces the Four Laws of Behavior Change: make it obvious, attractive, easy, and satisfying. The book emphasizes the importance of identity-based habits, environmental design, and the 'never miss twice' rule for maintaining consistency. Clear shows how understanding the science of small habits can transform your life in profound ways.",
              keyInsights: [
                "Small habits compound into remarkable results over time",
                "Focus on systems rather than goals for sustainable change",
                "Make habits attractive, easy, and satisfying",
                "Track your habits and never miss twice in a row",
                "Design your environment to support good habits",
                "Focus on identity change rather than outcome goals"
              ],
              whyRead: "Learn the science of habit formation and transformation"
            },
            {
              title: "Getting Things Done",
              author: "David Allen",
              summary: "David Allen's groundbreaking productivity methodology provides a complete system for organizing your life and work. The GTD method is built around the principle that your mind is for having ideas, not storing them. Allen teaches a five-step process: Capture, Clarify, Organize, Reflect, and Engage. He emphasizes the importance of collecting all your commitments into a trusted external system, processing them into actionable items, and maintaining regular reviews to keep everything current. The book addresses the psychology of productivity, showing how proper organization eliminates mental clutter and frees your mind for creative thinking.",
              keyInsights: [
                "Capture everything that requires attention into a trusted system",
                "Clarify what each item means and what action is required",
                "Organize reminders and information in the right categories",
                "Reflect regularly and keep your system current",
                "Your mind is for having ideas, not storing them",
                "Use the two-minute rule for quick tasks"
              ],
              whyRead: "Build a productivity system that eliminates overwhelm and maximizes focus"
            }
          ],
          mindset: [
            {
              title: "Mindset",
              author: "Carol Dweck",
              summary: "Carol Dweck's groundbreaking research reveals that our beliefs about intelligence and ability profoundly impact our success. She identifies two mindsets: fixed mindset (believing abilities are innate and unchangeable) and growth mindset (believing abilities can be developed through effort and learning). Dweck shows how these mindsets affect motivation, resilience, and achievement in school, work, and relationships. The book provides practical strategies for cultivating a growth mindset, including praising effort rather than intelligence, embracing challenges, and learning from criticism. Dweck demonstrates that changing your mindset can transform your life and help you reach your full potential.",
              keyInsights: [
                "Growth mindset believes abilities can be developed through dedication",
                "Fixed mindset avoids challenges and gives up easily",
                "Embrace challenges as opportunities to grow",
                "Learn from criticism and find lessons in setbacks",
                "Praise effort and process, not just outcomes",
                "View failures as learning opportunities"
              ],
              whyRead: "Discover how your mindset shapes your success and happiness"
            },
            {
              title: "The Power of Now",
              author: "Eckhart Tolle",
              summary: "Eckhart Tolle presents a revolutionary approach to spirituality and self-awareness that transcends traditional religious boundaries. He argues that true enlightenment comes from living in the present moment rather than being trapped in thoughts about the past or future. Tolle explains how the ego creates suffering through attachment, resistance, and identification with the mind. He provides practical exercises for becoming present, observing thoughts without judgment, and finding peace in everyday activities. The book challenges readers to question their relationship with time and discover the eternal nature of consciousness that exists beyond the thinking mind.",
              keyInsights: [
                "The present moment is all we ever have",
                "Your mind creates suffering through attachment to past/future",
                "Accept what is without resistance",
                "Find peace through presence and awareness",
                "Observe your thoughts without judgment",
                "The ego thrives on drama and identification"
              ],
              whyRead: "Learn to live in the present and find inner peace"
            }
          ],
          leadership: [
            {
              title: "The 7 Habits of Highly Effective People",
              author: "Stephen Covey",
              summary: "Stephen Covey's timeless classic presents seven habits that form the foundation of personal and professional effectiveness. Moving beyond quick-fix solutions, Covey provides a principle-centered approach to solving personal and professional problems. The habits are organized into three categories: private victory (habits 1-3), public victory (habits 4-6), and renewal (habit 7). Covey emphasizes that true change comes from within, starting with character development and moving outward to influence others. He illustrates how these habits create a framework for long-term success in all areas of life, from career to relationships to personal growth.",
              keyInsights: [
                "Be proactive - take responsibility for your life",
                "Begin with the end in mind - define your mission",
                "Put first things first - prioritize important over urgent",
                "Seek win-win solutions in relationships",
                "Seek first to understand, then to be understood",
                "Synergize - create better solutions through teamwork",
                "Sharpen the saw - renew yourself regularly"
              ],
              whyRead: "Master the fundamental principles of personal and professional effectiveness"
            },
            {
              title: "Dare to Lead",
              author: "Bren√© Brown",
              summary: "Bren√© Brown explores what it takes to be a courageous leader in an increasingly complex world. Drawing on extensive research, Brown identifies four skill sets that define daring leadership: rumbling with vulnerability, living into our values, braving trust, and learning to rise. She challenges the myth that vulnerability is weakness, instead showing how it builds connection and innovation. Brown provides practical tools for having difficult conversations, embracing discomfort, and creating cultures of belonging and innovation. The book combines research insights with real-world examples, showing how courageous leadership can transform organizations and communities.",
              keyInsights: [
                "Vulnerability is the birthplace of innovation and change",
                "Courage is contagious - model the behavior you seek",
                "Lean into discomfort and have tough conversations",
                "Build trust through reliability, accountability, and compassion",
                "Rumple with vulnerability instead of avoiding it",
                "Practice values-based leadership"
              ],
              whyRead: "Learn to lead with courage, compassion, and connection"
            }
          ],
          entrepreneurship: [
            {
              title: "The Lean Startup",
              author: "Eric Ries",
              summary: "Eric Ries revolutionizes entrepreneurship with the Lean Startup methodology, showing how to build successful businesses in an uncertain world. Drawing from his own experiences, Ries introduces the Build-Measure-Learn feedback loop as the foundation for innovation. He explains how to validate business hypotheses through minimum viable products, split testing, and actionable metrics. The book emphasizes the importance of learning over planning, showing how successful entrepreneurs use scientific methods to reduce risk and increase success rates. Ries provides practical tools for innovation accounting, pivot strategies, and sustainable growth in any business context.",
              keyInsights: [
                "Build-Measure-Learn feedback loop drives innovation",
                "Validated learning comes from running experiments",
                "Pivot when assumptions prove wrong",
                "Minimum Viable Product tests fundamental business hypotheses",
                "Use actionable metrics over vanity metrics",
                "Innovation requires discipline and focus"
              ],
              whyRead: "Master the methodology for building successful businesses"
            },
            {
              title: "Zero to One",
              author: "Peter Thiel",
              summary: "Peter Thiel challenges conventional wisdom about innovation and entrepreneurship, arguing that true progress comes from creating something fundamentally new rather than improving existing products. Thiel examines the patterns of successful companies like PayPal, LinkedIn, and SpaceX, identifying key principles for building enduring businesses. He explores the importance of monopoly creation, the power of secrets, and the role of timing in innovation. The book provides contrarian insights about competition, globalization, and the future of technology. Thiel combines philosophical depth with practical business advice, showing entrepreneurs how to create transformative companies that change the world.",
              keyInsights: [
                "Create monopoly by doing something others cannot",
                "Focus on technology and timing for competitive advantage",
                "Sales and distribution are often more important than product",
                "Build enduring companies, not just successful ones",
                "Competition is for losers - seek monopoly",
                "The future belongs to those who create it"
              ],
              whyRead: "Learn how to build the future and create lasting value"
            }
          ],
          health: [
            {
              title: "Why We Sleep",
              author: "Matthew Walker",
              summary: "Neuroscientist Matthew Walker presents a comprehensive exploration of sleep's transformative power for health, performance, and longevity. Drawing on decades of research, Walker explains how sleep affects every aspect of human functioning, from learning and memory to immune function and emotional regulation. He reveals the devastating consequences of sleep deprivation, showing how even small sleep deficits accumulate into serious health risks. The book provides practical strategies for optimizing sleep, including maintaining consistent sleep schedules, creating ideal sleep environments, and understanding the different stages of sleep. Walker makes a compelling case that sleep is not a luxury but an essential pillar of health and success.",
              keyInsights: [
                "Sleep is essential for learning, memory, and emotional regulation",
                "Most adults need 7-9 hours of quality sleep",
                "Poor sleep increases risk of disease and early death",
                "Consistent sleep schedule is more important than sleep duration",
                "Sleep deprivation impairs decision-making and creativity",
                "Dreaming plays crucial role in emotional processing"
              ],
              whyRead: "Understand the transformative power of sleep for health and performance"
            },
            {
              title: "How Not to Die",
              author: "Michael Greger",
              summary: "Dr. Michael Greger presents a comprehensive guide to preventing and reversing chronic diseases through evidence-based nutrition. Drawing on thousands of scientific studies, Greger identifies the most effective dietary interventions for preventing heart disease, cancer, diabetes, and other common illnesses. He introduces the 'Daily Dozen' - twelve categories of healthy foods that provide optimal nutrition. The book challenges conventional dietary wisdom, showing how plant-based eating can prevent and even reverse chronic diseases. Greger provides practical, actionable advice backed by rigorous scientific evidence, making complex nutritional science accessible to everyone.",
              keyInsights: [
                "Plant-based diets prevent and reverse chronic diseases",
                "Daily dozen: beans, berries, greens, and other protective foods",
                "Processed meats and added sugars are the biggest dietary risks",
                "Nutrition can prevent 80% of heart disease and cancers",
                "Whole foods provide synergistic health benefits",
                "Small dietary changes can have major health impacts"
              ],
              whyRead: "Discover evidence-based nutrition for longevity and disease prevention"
            }
          ]
        };

        // Get today's book recommendation
        const getTodaysBook = () => {
          const today = new Date();
          const categories = Object.keys(bookDatabase);
          const categoryIndex = today.getDay() % categories.length; // Rotate by day of week
          const category = categories[categoryIndex];
          const books = bookDatabase[category];
          const bookIndex = Math.floor(today.getDate() / 7) % books.length; // Rotate weekly
          return { ...books[bookIndex], category };
        };

        const todaysBook = getTodaysBook();

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-1 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Today</button>
                <button onClick={() => setView('progress')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Progress</button>
                <button onClick={() => setView('workouts')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Affirmations</button>
                <button onClick={() => setView('coach')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Coach</button>
                <button onClick={() => setView('books')} className="px-2 py-2 bg-amber-600 text-white rounded text-xs">Books</button>
              </div>

              {/* Knowledge Integration Header */}
              <div className="bg-gradient-to-r from-purple-900 to-blue-900 rounded-xl p-6 mb-6 border border-purple-700">
                <div className="flex items-center gap-3 mb-4">
                  <span className="text-4xl">üß†</span>
                  <div>
                    <h2 className="text-2xl font-bold text-white">Knowledge Integration</h2>
                    <p className="text-purple-200">Transform reading into lifelong wisdom</p>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="bg-purple-800 rounded-lg p-4">
                    <h3 className="font-medium mb-2 text-purple-200">üìù Personal Knowledge</h3>
                    <p className="text-2xl font-bold text-white">{knowledgeBase.length}</p>
                    <p className="text-sm text-purple-300">Saved insights</p>
                  </div>
                  <div className="bg-blue-800 rounded-lg p-4">
                    <h3 className="font-medium mb-2 text-blue-200">üîÑ Spaced Repetition</h3>
                    <p className="text-2xl font-bold text-white">{spacedRepetition.length}</p>
                    <p className="text-sm text-blue-300">Ideas to review</p>
                  </div>
                  <div className="bg-green-800 rounded-lg p-4">
                    <h3 className="font-medium mb-2 text-green-200">üí° Daily Application</h3>
                    <p className="text-lg font-bold text-white">Ready</p>
                    <p className="text-sm text-green-300">Apply ideas today</p>
                  </div>
                </div>
              </div>

              {/* Today's Application Challenge */}
              {currentBookApplication && (
                <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-amber-700">
                  <div className="flex items-center gap-3 mb-4">
                    <span className="text-3xl">üéØ</span>
                    <div>
                      <h3 className="text-lg font-bold text-amber-400">Apply This Idea Today</h3>
                      <p className="text-sm text-gray-400">From "{currentBookApplication.title}" by {currentBookApplication.author}</p>
                    </div>
                  </div>

                  <div className="bg-amber-900 rounded-lg p-4 mb-4">
                    <p className="text-white leading-relaxed">{currentBookApplication.application}</p>
                  </div>

                  <div className="flex gap-2">
                    <button
                      onClick={() => {
                        addToKnowledgeBase({
                          content: currentBookApplication.application,
                          source: `${currentBookApplication.title} - Daily Application`,
                          category: 'application',
                          tags: ['daily-practice', 'implementation']
                        });
                        setSaveStatus('‚úÖ Application saved to knowledge base!');
                        setTimeout(() => setSaveStatus(''), 3000);
                      }}
                      className="flex-1 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors"
                    >
                      üíæ Save to Knowledge Base
                    </button>
                    <button
                      onClick={() => {
                        addToSpacedRepetition({
                          content: currentBookApplication.application,
                          source: `${currentBookApplication.title} - Application`
                        });
                        setSaveStatus('üîÑ Added to spaced repetition!');
                        setTimeout(() => setSaveStatus(''), 3000);
                      }}
                      className="flex-1 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                    >
                      üîÑ Add to Spaced Repetition
                    </button>
                  </div>
                </div>
              )}

              {/* Today's Book Recommendation */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <div className="flex items-start justify-between mb-4">
                  <div>
                    <span className={`px-3 py-1 rounded-full text-xs font-medium mb-2 inline-block ${
                      todaysBook.category === 'productivity' ? 'bg-blue-600' :
                      todaysBook.category === 'mindset' ? 'bg-purple-600' :
                      todaysBook.category === 'leadership' ? 'bg-green-600' :
                      todaysBook.category === 'entrepreneurship' ? 'bg-yellow-600' :
                      'bg-red-600'
                    } text-white`}>
                      {todaysBook.category.charAt(0).toUpperCase() + todaysBook.category.slice(1)}
                    </span>
                    <h2 className="text-2xl font-bold text-white">{todaysBook.title}</h2>
                    <p className="text-gray-400">by {todaysBook.author}</p>
                  </div>
                  <div className="text-right">
                    <p className="text-sm text-gray-500">Today's Pick</p>
                    <p className="text-xs text-gray-600">{new Date().toLocaleDateString()}</p>
                  </div>
                </div>

                <div className="mb-4">
                  <h3 className="font-bold text-amber-400 mb-2">Why You Should Read This:</h3>
                  <p className="text-gray-300 text-sm">{todaysBook.whyRead}</p>
                </div>

                <div>
                  <h3 className="font-bold text-amber-400 mb-3">Book Summary:</h3>
                  <p className="text-sm text-gray-300 mb-4 leading-relaxed">{todaysBook.summary}</p>

                  <h3 className="font-bold text-amber-400 mb-3">Key Takeaways:</h3>
                  <ul className="space-y-2">
                    {todaysBook.keyInsights.map((insight, index) => (
                      <li key={index} className="flex items-start text-sm text-gray-300">
                        <span className="text-amber-400 mr-2 mt-1">‚Ä¢</span>
                        <span>{insight}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>

              {/* Book Categories */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                {Object.entries(bookDatabase).map(([category, books]) => (
                  <div key={category} className="bg-slate-800 rounded-xl p-4 border border-slate-700">
                    <h3 className="font-bold text-lg mb-3 capitalize text-amber-400">{category}</h3>
                    <div className="space-y-3">
                      {books.map((book, index) => (
                        <div key={index} className="border-l-2 border-amber-500 pl-3">
                          <p className="font-medium text-white text-sm">{book.title}</p>
                          <p className="text-gray-400 text-xs mb-1">by {book.author}</p>
                          <p className="text-gray-500 text-xs leading-relaxed">{book.whyRead}</p>
                        </div>
                      ))}
                    </div>
                    <p className="text-xs text-gray-500 mt-3">{books.length} books in this category</p>
                  </div>
                ))}
              </div>

              {/* Knowledge Base Management */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-bold text-purple-400">üìù Personal Knowledge Base</h3>
                  <button
                    onClick={() => setShowAddNote(true)}
                    className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                  >
                    ‚ûï Add Note
                  </button>
                </div>

                {/* Add Note Modal */}
                {showAddNote && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-slate-800 rounded-xl p-6 max-w-md w-full mx-4">
                      <h3 className="text-lg font-bold mb-4 text-purple-400">Add to Knowledge Base</h3>
                      <div className="space-y-4">
                        <textarea
                          placeholder="Your insight, quote, or key learning..."
                          value={newNote.content}
                          onChange={(e) => setNewNote({...newNote, content: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                          rows="4"
                        />
                        <input
                          type="text"
                          placeholder="Source (book, article, experience...)"
                          value={newNote.source}
                          onChange={(e) => setNewNote({...newNote, source: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                        />
                        <select
                          value={newNote.category}
                          onChange={(e) => setNewNote({...newNote, category: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white"
                        >
                          <option value="">Select category</option>
                          <option value="mindset">Mindset</option>
                          <option value="productivity">Productivity</option>
                          <option value="leadership">Leadership</option>
                          <option value="health">Health</option>
                          <option value="finance">Finance</option>
                          <option value="relationships">Relationships</option>
                          <option value="personal">Personal</option>
                        </select>
                        <input
                          type="text"
                          placeholder="Tags (comma separated)"
                          value={newNote.tags}
                          onChange={(e) => setNewNote({...newNote, tags: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                        />
                      </div>
                      <div className="flex gap-2 mt-6">
                        <button
                          onClick={() => {
                            if (newNote.content.trim()) {
                              addToKnowledgeBase({
                                ...newNote,
                                tags: newNote.tags.split(',').map(tag => tag.trim()).filter(tag => tag)
                              });
                              setNewNote({ content: '', source: '', category: '', tags: '' });
                              setShowAddNote(false);
                              setSaveStatus('‚úÖ Note added to knowledge base!');
                              setTimeout(() => setSaveStatus(''), 3000);
                            }
                          }}
                          className="flex-1 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700"
                        >
                          Save
                        </button>
                        <button
                          onClick={() => {
                            setNewNote({ content: '', source: '', category: '', tags: '' });
                            setShowAddNote(false);
                          }}
                          className="flex-1 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Reading Progress Modal */}
                {showReadingModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-slate-800 rounded-xl p-6 max-w-md w-full mx-4">
                      <h3 className="text-lg font-bold mb-4 text-amber-400">üìö Log Reading Progress</h3>
                      <div className="space-y-4">
                        <input
                          type="text"
                          placeholder="Book title (optional)"
                          value={readingEntry.bookTitle}
                          onChange={(e) => setReadingEntry({...readingEntry, bookTitle: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                        />
                        <input
                          type="number"
                          placeholder="Pages read today"
                          value={readingEntry.pagesRead}
                          onChange={(e) => setReadingEntry({...readingEntry, pagesRead: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                        />
                        <textarea
                          placeholder="Key insights or takeaways..."
                          value={readingEntry.insights}
                          onChange={(e) => setReadingEntry({...readingEntry, insights: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                          rows="3"
                        />
                        <textarea
                          placeholder="Reading notes (optional)"
                          value={readingEntry.notes}
                          onChange={(e) => setReadingEntry({...readingEntry, notes: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                          rows="2"
                        />
                      </div>
                      <div className="flex gap-2 mt-6">
                        <button
                          onClick={() => saveReadingProgress(readingEntry)}
                          className="flex-1 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700"
                        >
                          Save Progress
                        </button>
                        <button
                          onClick={() => {
                            setReadingEntry({ bookTitle: '', pagesRead: '', insights: '', notes: '' });
                            setShowReadingModal(false);
                          }}
                          className="flex-1 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Knowledge Base Display */}
                {knowledgeBase.length > 0 ? (
                  <div className="space-y-3 max-h-96 overflow-y-auto">
                    {knowledgeBase.slice(0, 10).map((note) => (
                      <div key={note.id} className="bg-slate-700 rounded-lg p-4">
                        <p className="text-white mb-2">{note.content}</p>
                        <div className="flex items-center justify-between text-sm">
                          <div className="text-gray-400">
                            {note.source && <span>üìö {note.source}</span>}
                            {note.category && <span className="ml-2">üè∑Ô∏è {note.category}</span>}
                          </div>
                          <span className="text-gray-500">
                            {new Date(note.dateAdded).toLocaleDateString()}
                          </span>
                        </div>
                        {note.tags && note.tags.length > 0 && (
                          <div className="flex flex-wrap gap-1 mt-2">
                            {note.tags.map((tag, index) => (
                              <span key={index} className="px-2 py-1 bg-purple-600 text-xs rounded">
                                {tag}
                              </span>
                            ))}
                          </div>
                        )}
                      </div>
                    ))}
                    {knowledgeBase.length > 10 && (
                      <p className="text-center text-gray-400 py-2">
                        +{knowledgeBase.length - 10} more notes in your knowledge base
                      </p>
                    )}
                  </div>
                ) : (
                  <div className="text-center py-8">
                    <span className="text-4xl mb-4 block">üìù</span>
                    <p className="text-gray-400">Your knowledge base is empty</p>
                    <p className="text-sm text-gray-500">Start capturing insights from books, articles, and experiences</p>
                  </div>
                )}
              </div>

              {/* Spaced Repetition Review */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-bold text-blue-400">üîÑ Spaced Repetition</h3>
                  <button
                    onClick={() => setShowAddRepetition(true)}
                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                  >
                    ‚ûï Add Item
                  </button>
                </div>

                {/* Add Repetition Modal */}
                {showAddRepetition && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-slate-800 rounded-xl p-6 max-w-md w-full mx-4">
                      <h3 className="text-lg font-bold mb-4 text-blue-400">Add to Spaced Repetition</h3>
                      <div className="space-y-4">
                        <textarea
                          placeholder="The idea or concept you want to remember..."
                          value={newRepetitionItem.content}
                          onChange={(e) => setNewRepetitionItem({...newRepetitionItem, content: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                          rows="4"
                        />
                        <input
                          type="text"
                          placeholder="Source (book, video, experience...)"
                          value={newRepetitionItem.source}
                          onChange={(e) => setNewRepetitionItem({...newRepetitionItem, source: e.target.value})}
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                        />
                      </div>
                      <div className="flex gap-2 mt-6">
                        <button
                          onClick={() => {
                            if (newRepetitionItem.content.trim()) {
                              addToSpacedRepetition(newRepetitionItem);
                              setNewRepetitionItem({ content: '', source: '' });
                              setShowAddRepetition(false);
                              setSaveStatus('üîÑ Added to spaced repetition!');
                              setTimeout(() => setSaveStatus(''), 3000);
                            }
                          }}
                          className="flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                        >
                          Add
                        </button>
                        <button
                          onClick={() => {
                            setNewRepetitionItem({ content: '', source: '' });
                            setShowAddRepetition(false);
                          }}
                          className="flex-1 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Review Items */}
                {spacedRepetition.length > 0 ? (
                  <div className="space-y-3">
                    {spacedRepetition.slice(0, 5).map((item) => (
                      <div key={item.id} className="bg-slate-700 rounded-lg p-4">
                        <div className="flex items-start gap-3">
                          <span className="text-blue-400 mt-1">üß†</span>
                          <div className="flex-1">
                            <p className="text-white mb-2">{item.content}</p>
                            <div className="flex items-center justify-between">
                              <span className="text-sm text-gray-400">
                                {item.source && `üìö ${item.source}`}
                              </span>
                              <div className="flex gap-2">
                                <button
                                  onClick={() => reviewSpacedItem(item.id, 5)}
                                  className="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700"
                                >
                                  Easy
                                </button>
                                <button
                                  onClick={() => reviewSpacedItem(item.id, 4)}
                                  className="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700"
                                >
                                  Good
                                </button>
                                <button
                                  onClick={() => reviewSpacedItem(item.id, 3)}
                                  className="px-3 py-1 bg-yellow-600 text-white rounded text-sm hover:bg-yellow-700"
                                >
                                  Hard
                                </button>
                                <button
                                  onClick={() => reviewSpacedItem(item.id, 1)}
                                  className="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700"
                                >
                                  Again
                                </button>
                              </div>
                            </div>
                            <div className="flex items-center gap-4 mt-2 text-xs text-gray-500">
                              <span>Repetition: {item.repetitions}</span>
                              <span>Next: {new Date(item.nextReview).toLocaleDateString()}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    ))}
                    {spacedRepetition.length > 5 && (
                      <p className="text-center text-gray-400 py-2">
                        +{spacedRepetition.length - 5} more items to review
                      </p>
                    )}
                  </div>
                ) : (
                  <div className="text-center py-8">
                    <span className="text-4xl mb-4 block">üîÑ</span>
                    <p className="text-gray-400">No items in spaced repetition</p>
                    <p className="text-sm text-gray-500">Add important ideas you want to remember long-term</p>
                  </div>
                )}
              </div>

              {/* Reading Challenge */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-3">üìö Reading Challenge</h3>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div className="text-center">
                    <p className="text-2xl font-bold text-blue-400">{readingProgress.booksRead}</p>
                    <p className="text-xs text-gray-400">Books Read</p>
                  </div>
                  <div className="text-center">
                    <p className="text-2xl font-bold text-green-400">{readingProgress.pagesRead}</p>
                    <p className="text-xs text-gray-400">Pages Read</p>
                  </div>
                  <div className="text-center">
                    <p className="text-2xl font-bold text-purple-400">{readingProgress.insightsGained}</p>
                    <p className="text-xs text-gray-400">Key Insights</p>
                  </div>
                  <div className="text-center">
                    <p className="text-2xl font-bold text-yellow-400">{readingProgress.currentStreak}</p>
                    <p className="text-xs text-gray-400">Current Streak</p>
                  </div>
                </div>
                <button
                  onClick={() => setShowReadingModal(true)}
                  className="w-full mt-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors"
                >
                  Log Reading Progress
                </button>
              </div>

              {/* Reading History */}
              {readingHistory.length > 0 && (
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-green-400">üìñ Reading History</h3>
                  <div className="space-y-3 max-h-96 overflow-y-auto">
                    {readingHistory.map((entry) => {
                      const entryDate = new Date(entry.date);
                      const today = new Date();
                      const yesterday = new Date(today);
                      yesterday.setDate(today.getDate() - 1);

                      let dateDisplay;
                      if (entryDate.toDateString() === today.toDateString()) {
                        dateDisplay = 'Today';
                      } else if (entryDate.toDateString() === yesterday.toDateString()) {
                        dateDisplay = 'Yesterday';
                      } else {
                        dateDisplay = entryDate.toLocaleDateString('en-US', {
                          month: 'short',
                          day: 'numeric',
                          year: entryDate.getFullYear() !== today.getFullYear() ? 'numeric' : undefined
                        });
                      }

                      return (
                        <div key={entry.id} className="bg-slate-700 rounded-lg p-4">
                          <div className="flex items-start justify-between mb-2">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-1">
                                <span className="text-amber-400 font-medium">üìö {entry.bookTitle}</span>
                                <span className="text-xs text-gray-500">‚Ä¢ {dateDisplay}</span>
                              </div>
                              <div className="flex items-center gap-4 text-sm text-gray-400">
                                <span>üìÑ {entry.pagesRead} pages</span>
                                {entry.insights && <span>üí° Insight logged</span>}
                              </div>
                            </div>
                          </div>

                          {entry.insights && (
                            <div className="mt-3 p-3 bg-amber-900 bg-opacity-30 rounded border-l-2 border-amber-500">
                              <p className="text-amber-200 text-sm leading-relaxed">{entry.insights}</p>
                            </div>
                          )}

                          {entry.notes && (
                            <div className="mt-2 p-2 bg-slate-600 rounded text-sm text-gray-300">
                              <span className="text-gray-500">Notes:</span> {entry.notes}
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>

                  {readingHistory.length === 0 && (
                    <div className="text-center py-8 text-gray-500">
                      <p className="text-lg mb-2">No reading history yet</p>
                      <p className="text-sm">Log your first reading session above!</p>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        );
      }

      if (view === 'nutrition') {
        console.log('Nutrition view loaded');

        // Expanded food database with 80+ foods
        const foodDatabase = {
          proteins: [
            { name: "Chicken Breast (4oz)", calories: 165, protein: 31, carbs: 0, fat: 3.6 },
            { name: "Chicken Thigh (4oz)", calories: 203, protein: 25, carbs: 0, fat: 11 },
            { name: "Salmon (4oz)", calories: 206, protein: 22, carbs: 0, fat: 12 },
            { name: "Tilapia (4oz)", calories: 128, protein: 26, carbs: 0, fat: 3 },
            { name: "Shrimp (4oz)", calories: 120, protein: 24, carbs: 1, fat: 2 },
            { name: "Greek Yogurt (plain, 6oz)", calories: 100, protein: 18, carbs: 6, fat: 0 },
            { name: "Greek Yogurt (vanilla, 6oz)", calories: 120, protein: 18, carbs: 12, fat: 1 },
            { name: "Eggs (2 large)", calories: 143, protein: 13, carbs: 1, fat: 10 },
            { name: "Egg Whites (4 large)", calories: 68, protein: 14, carbs: 1, fat: 0 },
            { name: "Tuna (canned, 4oz)", calories: 100, protein: 22, carbs: 0, fat: 1 },
            { name: "Turkey Breast (4oz)", calories: 135, protein: 30, carbs: 0, fat: 1 },
            { name: "Turkey Ground (4oz)", calories: 170, protein: 22, carbs: 0, fat: 8 },
            { name: "Beef (lean, 4oz)", calories: 170, protein: 26, carbs: 0, fat: 7 },
            { name: "Beef (ground, 4oz)", calories: 217, protein: 20, carbs: 0, fat: 15 },
            { name: "Cottage Cheese (4oz)", calories: 110, protein: 13, carbs: 3, fat: 5 },
            { name: "Tofu (4oz)", calories: 94, protein: 10, carbs: 2, fat: 6 },
            { name: "Tempeh (4oz)", calories: 193, protein: 19, carbs: 9, fat: 11 },
            { name: "Lentils (1 cup cooked)", calories: 230, protein: 18, carbs: 40, fat: 1 },
            { name: "Black Beans (1 cup cooked)", calories: 227, protein: 15, carbs: 41, fat: 1 },
            { name: "Chickpeas (1 cup cooked)", calories: 269, protein: 15, carbs: 45, fat: 4 }
          ],
          carbs: [
            { name: "Brown Rice (1 cup cooked)", calories: 216, protein: 5, carbs: 44, fat: 2 },
            { name: "White Rice (1 cup cooked)", calories: 205, protein: 4, carbs: 44, fat: 0 },
            { name: "Quinoa (1 cup cooked)", calories: 222, protein: 8, carbs: 39, fat: 4 },
            { name: "Oatmeal (1 cup cooked)", calories: 147, protein: 5, carbs: 27, fat: 3 },
            { name: "Whole Wheat Pasta (1 cup cooked)", calories: 174, protein: 7, carbs: 37, fat: 1 },
            { name: "Sweet Potato (medium)", calories: 103, protein: 2, carbs: 24, fat: 0 },
            { name: "White Potato (medium)", calories: 161, protein: 4, carbs: 37, fat: 0 },
            { name: "Whole Wheat Bread (2 slices)", calories: 140, protein: 6, carbs: 24, fat: 2 },
            { name: "White Bread (2 slices)", calories: 133, protein: 4, carbs: 26, fat: 1 },
            { name: "Bagel (medium)", calories: 289, protein: 11, carbs: 56, fat: 2 },
            { name: "Banana", calories: 105, protein: 1, carbs: 27, fat: 0 },
            { name: "Apple", calories: 95, protein: 0, carbs: 25, fat: 0 },
            { name: "Orange", calories: 62, protein: 1, carbs: 15, fat: 0 },
            { name: "Strawberries (1 cup)", calories: 49, protein: 1, carbs: 12, fat: 0 },
            { name: "Blueberries (1 cup)", calories: 84, protein: 1, carbs: 21, fat: 0 },
            { name: "Grapes (1 cup)", calories: 104, protein: 1, carbs: 27, fat: 0 },
            { name: "Pineapple (1 cup)", calories: 82, protein: 1, carbs: 22, fat: 0 },
            { name: "Avocado (1/2 medium)", calories: 120, protein: 1, carbs: 6, fat: 11 },
            { name: "Corn (1 cup)", calories: 132, protein: 5, carbs: 29, fat: 2 },
            { name: "Peas (1 cup cooked)", calories: 134, protein: 9, carbs: 25, fat: 1 }
          ],
          vegetables: [
            { name: "Broccoli (1 cup)", calories: 31, protein: 3, carbs: 6, fat: 0 },
            { name: "Spinach (2 cups)", calories: 14, protein: 2, carbs: 2, fat: 0 },
            { name: "Kale (2 cups)", calories: 66, protein: 5, carbs: 11, fat: 1 },
            { name: "Mixed Greens Salad (2 cups)", calories: 20, protein: 2, carbs: 4, fat: 0 },
            { name: "Romaine Lettuce (2 cups)", calories: 16, protein: 1, carbs: 3, fat: 0 },
            { name: "Carrots (1 cup)", calories: 50, protein: 1, carbs: 12, fat: 0 },
            { name: "Bell Peppers (1 cup)", calories: 24, protein: 1, carbs: 6, fat: 0 },
            { name: "Zucchini (1 cup)", calories: 20, protein: 1, carbs: 4, fat: 1 },
            { name: "Tomatoes (1 medium)", calories: 22, protein: 1, carbs: 5, fat: 0 },
            { name: "Cherry Tomatoes (1 cup)", calories: 27, protein: 1, carbs: 6, fat: 0 },
            { name: "Cucumber (1 cup)", calories: 16, protein: 1, carbs: 4, fat: 0 },
            { name: "Cauliflower (1 cup)", calories: 25, protein: 2, carbs: 5, fat: 0 },
            { name: "Brussels Sprouts (1 cup)", calories: 65, protein: 4, carbs: 13, fat: 1 },
            { name: "Asparagus (1 cup)", calories: 27, protein: 3, carbs: 5, fat: 0 },
            { name: "Green Beans (1 cup)", calories: 34, protein: 2, carbs: 8, fat: 0 },
            { name: "Mushrooms (1 cup)", calories: 21, protein: 2, carbs: 3, fat: 0 },
            { name: "Onion (1 medium)", calories: 44, protein: 1, carbs: 10, fat: 0 },
            { name: "Garlic (1 clove)", calories: 4, protein: 0, carbs: 1, fat: 0 },
            { name: "Celery (1 cup)", calories: 16, protein: 1, carbs: 3, fat: 0 },
            { name: "Beets (1 cup cooked)", calories: 75, protein: 3, carbs: 17, fat: 0 }
          ],
          snacks: [
            { name: "Almonds (1oz)", calories: 164, protein: 6, carbs: 6, fat: 14 },
            { name: "Walnuts (1oz)", calories: 185, protein: 4, carbs: 4, fat: 18 },
            { name: "Peanuts (1oz)", calories: 161, protein: 7, carbs: 6, fat: 14 },
            { name: "Cashews (1oz)", calories: 157, protein: 5, carbs: 9, fat: 12 },
            { name: "Pistachios (1oz)", calories: 156, protein: 6, carbs: 8, fat: 12 },
            { name: "Greek Yogurt with Berries", calories: 150, protein: 20, carbs: 15, fat: 2 },
            { name: "Apple with Peanut Butter", calories: 200, protein: 5, carbs: 25, fat: 10 },
            { name: "Banana with Almond Butter", calories: 190, protein: 4, carbs: 27, fat: 8 },
            { name: "Protein Bar", calories: 200, protein: 20, carbs: 20, fat: 5 },
            { name: "Energy Bar", calories: 250, protein: 10, carbs: 30, fat: 8 },
            { name: "Mixed Nuts (1oz)", calories: 175, protein: 5, carbs: 6, fat: 16 },
            { name: "Trail Mix (1oz)", calories: 140, protein: 4, carbs: 12, fat: 9 },
            { name: "Dark Chocolate (1oz)", calories: 170, protein: 2, carbs: 13, fat: 12 },
            { name: "Milk Chocolate (1oz)", calories: 235, protein: 3, carbs: 26, fat: 13 },
            { name: "Jerky (beef, 1oz)", calories: 116, protein: 9, carbs: 3, fat: 7 },
            { name: "Turkey Jerky (1oz)", calories: 100, protein: 12, carbs: 4, fat: 3 },
            { name: "Rice Cakes (2 cakes)", calories: 70, protein: 1, carbs: 15, fat: 0 },
            { name: "Popcorn (3 cups air-popped)", calories: 93, protein: 3, carbs: 19, fat: 1 },
            { name: "Pretzels (1oz)", calories: 108, protein: 3, carbs: 22, fat: 1 },
            { name: "Cheese Crackers (20 pieces)", calories: 151, protein: 3, carbs: 16, fat: 8 }
          ],
          fruits: [
            { name: "Apple", calories: 95, protein: 0, carbs: 25, fat: 0 },
            { name: "Banana", calories: 105, protein: 1, carbs: 27, fat: 0 },
            { name: "Orange", calories: 62, protein: 1, carbs: 15, fat: 0 },
            { name: "Grapes (1 cup)", calories: 104, protein: 1, carbs: 27, fat: 0 },
            { name: "Strawberries (1 cup)", calories: 49, protein: 1, carbs: 12, fat: 0 },
            { name: "Blueberries (1 cup)", calories: 84, protein: 1, carbs: 21, fat: 0 },
            { name: "Raspberries (1 cup)", calories: 64, protein: 1, carbs: 15, fat: 0 },
            { name: "Blackberries (1 cup)", calories: 62, protein: 2, carbs: 14, fat: 1 },
            { name: "Pineapple (1 cup)", calories: 82, protein: 1, carbs: 22, fat: 0 },
            { name: "Mango (1 cup)", calories: 99, protein: 1, carbs: 25, fat: 1 },
            { name: "Kiwi", calories: 42, protein: 1, carbs: 10, fat: 0 },
            { name: "Pear", calories: 101, protein: 1, carbs: 27, fat: 0 },
            { name: "Peach", calories: 59, protein: 1, carbs: 14, fat: 0 },
            { name: "Plum", calories: 30, protein: 0, carbs: 8, fat: 0 },
            { name: "Cherries (1 cup)", calories: 87, protein: 1, carbs: 22, fat: 0 },
            { name: "Watermelon (1 cup)", calories: 46, protein: 1, carbs: 12, fat: 0 },
            { name: "Cantaloupe (1 cup)", calories: 54, protein: 1, carbs: 13, fat: 0 },
            { name: "Honeydew (1 cup)", calories: 64, protein: 1, carbs: 16, fat: 0 },
            { name: "Lemon", calories: 17, protein: 1, carbs: 5, fat: 0 },
            { name: "Lime", calories: 20, protein: 0, carbs: 7, fat: 0 }
          ],
          dairy: [
            { name: "Milk (2% fat, 8oz)", calories: 122, protein: 8, carbs: 12, fat: 5 },
            { name: "Milk (whole, 8oz)", calories: 146, protein: 8, carbs: 11, fat: 8 },
            { name: "Almond Milk (unsweetened, 8oz)", calories: 30, protein: 1, carbs: 2, fat: 3 },
            { name: "Soy Milk (unsweetened, 8oz)", calories: 80, protein: 7, carbs: 4, fat: 4 },
            { name: "Oat Milk (unsweetened, 8oz)", calories: 50, protein: 0, carbs: 9, fat: 2 },
            { name: "Cheddar Cheese (1oz)", calories: 113, protein: 7, carbs: 1, fat: 9 },
            { name: "Mozzarella Cheese (1oz)", calories: 85, protein: 6, carbs: 1, fat: 6 },
            { name: "Greek Yogurt (plain, 6oz)", calories: 100, protein: 18, carbs: 6, fat: 0 },
            { name: "Regular Yogurt (plain, 6oz)", calories: 100, protein: 4, carbs: 7, fat: 5 },
            { name: "Ice Cream (vanilla, 1/2 cup)", calories: 137, protein: 2, carbs: 16, fat: 7 }
          ]
        };

        // State management (already declared at component level)

        const todayKey = getTodayLocal();
        const todaysMeals = (nutritionData && nutritionData[todayKey]) ? nutritionData[todayKey] : {
          breakfast: [], lunch: [], dinner: [], snacks: []
        };

        // Calculate daily totals
        const calculateTotals = () => {
          const allFoods = Object.values(todaysMeals).flat();
          return allFoods.reduce((totals, food) => ({
            calories: totals.calories + (food.calories || 0),
            protein: totals.protein + (food.protein || 0),
            carbs: totals.carbs + (food.carbs || 0),
            fat: totals.fat + (food.fat || 0)
          }), { calories: 0, protein: 0, carbs: 0, fat: 0 });
        };

        const dailyTotals = calculateTotals();

        const addFood = (food) => {
          const updatedMeals = {
            ...todaysMeals,
            [selectedMeal]: [...todaysMeals[selectedMeal], food]
          };
          const updatedNutrition = {
            ...nutritionData,
            [todayKey]: updatedMeals
          };
          setNutritionData(updatedNutrition);
          localStorage.setItem('vita-nutrition', JSON.stringify(updatedNutrition));
          setShowAddFood(false);
        };

        const removeFood = (mealType, index) => {
          const updatedMeals = {
            ...todaysMeals,
            [mealType]: todaysMeals[mealType].filter((_, i) => i !== index)
          };
          const updatedNutrition = {
            ...nutritionData,
            [todayKey]: updatedMeals
          };
          setNutritionData(updatedNutrition);
          localStorage.setItem('vita-nutrition', JSON.stringify(updatedNutrition));
        };

        console.log('About to return nutrition JSX', todaysMeals, dailyTotals);

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>

              <div className="flex gap-2 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Today</button>
                <button onClick={() => setView('progress')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Progress</button>
                <button onClick={() => setView('workouts')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Affirmations</button>
                <button onClick={() => setView('coach')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Coach</button>
                <button onClick={() => setView('books')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Books</button>
                <button onClick={() => setView('nutrition')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Nutrition</button>
                <button onClick={() => setView('intelligence')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Intelligence</button>
                <button onClick={() => setView('wellness')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Wellness</button>
                <button onClick={() => setView('dashboard')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Dashboard</button>
                <button onClick={() => setView('challenges')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Challenges</button>
                <button onClick={() => setView('coach-ai')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">AI Coach</button>
              </div>

              {/* Daily Totals */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <h2 className="text-xl font-bold mb-4 text-center">Today's Nutrition</h2>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                  <div className="text-center">
                    <p className="text-2xl font-bold text-orange-400">{dailyTotals.calories}</p>
                    <p className="text-xs text-gray-400">Calories</p>
                  </div>
                  <div className="text-center">
                    <p className="text-2xl font-bold text-blue-400">{dailyTotals.protein}g</p>
                    <p className="text-xs text-gray-400">Protein</p>
                  </div>
                  <div className="text-center">
                    <p className="text-2xl font-bold text-green-400">{dailyTotals.carbs}g</p>
                    <p className="text-xs text-gray-400">Carbs</p>
                  </div>
                  <div className="text-center">
                    <p className="text-2xl font-bold text-purple-400">{dailyTotals.fat}g</p>
                    <p className="text-xs text-gray-400">Fat</p>
                  </div>
                </div>
                <div className="text-center">
                  <button
                    onClick={() => setShowAddFood(true)}
                    className="px-6 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors"
                  >
                    + Add Food
                  </button>
                </div>
              </div>

              {/* Meal Sections */}
              <div className="space-y-4 mb-6">
                {['breakfast', 'lunch', 'dinner', 'snacks'].map(mealType => (
                  <div key={mealType} className="bg-slate-800 rounded-xl p-4 border border-slate-700">
                    <div className="flex justify-between items-center mb-3">
                      <h3 className="font-bold capitalize text-amber-400">{mealType}</h3>
                      <span className="text-sm text-gray-400">
                        {todaysMeals[mealType].reduce((sum, food) => sum + (food.calories || 0), 0)} cal
                      </span>
                    </div>
                    {todaysMeals[mealType].length === 0 ? (
                      <p className="text-gray-500 text-sm italic">No foods logged yet</p>
                    ) : (
                      <div className="space-y-2">
                        {todaysMeals[mealType].map((food, index) => (
                          <div key={index} className="flex justify-between items-center bg-slate-700 rounded p-2">
                            <div>
                              <p className="font-medium text-sm">{food.name}</p>
                              <p className="text-xs text-gray-400">
                                {food.calories} cal ‚Ä¢ P:{food.protein}g ‚Ä¢ C:{food.carbs}g ‚Ä¢ F:{food.fat}g
                              </p>
                            </div>
                            <button
                              onClick={() => removeFood(mealType, index)}
                              className="text-red-400 hover:text-red-300 text-sm"
                            >
                              ‚úï
                            </button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                ))}
              </div>

              {/* Add Food Modal */}
              {showAddFood && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                  <div className="bg-slate-800 rounded-xl p-6 w-full max-w-md border border-slate-700 max-h-96 overflow-y-auto">
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-lg font-bold">Add Food</h3>
                      <button
                        onClick={() => setShowAddFood(false)}
                        className="text-gray-400 hover:text-white"
                      >
                        ‚úï
                      </button>
                    </div>

                    <div className="mb-4">
                      <label className="block text-sm font-medium mb-2">Meal Type</label>
                      <select
                        value={selectedMeal}
                        onChange={(e) => setSelectedMeal(e.target.value)}
                        className="w-full p-2 bg-slate-700 rounded text-white"
                      >
                        <option value="breakfast">Breakfast</option>
                        <option value="lunch">Lunch</option>
                        <option value="dinner">Dinner</option>
                        <option value="snacks">Snacks</option>
                      </select>
                    </div>

                    <div className="space-y-4 max-h-80 overflow-y-auto">
                      {Object.entries(foodDatabase).map(([category, foods]) => (
                        <div key={category}>
                          <h4 className="font-medium capitalize mb-2 text-amber-400">{category} ({foods.length})</h4>
                          <div className="space-y-1">
                            {foods.map((food, index) => (
                              <button
                                key={index}
                                onClick={() => addFood(food)}
                                className="w-full text-left p-2 bg-slate-700 rounded hover:bg-slate-600 transition-colors"
                              >
                                <div className="flex justify-between">
                                  <span className="text-sm font-medium">{food.name}</span>
                                  <span className="text-sm text-amber-400">{food.calories} cal</span>
                                </div>
                                <div className="text-xs text-gray-400 mt-1">
                                  P:{food.protein}g ‚Ä¢ C:{food.carbs}g ‚Ä¢ F:{food.fat}g
                                </div>
                              </button>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              )}

              {/* Nutrition Goals */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-4">üéØ Nutrition Goals</h3>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span>Calories</span>
                    <span className={dailyTotals.calories > 2000 ? 'text-red-400' : dailyTotals.calories > 1500 ? 'text-yellow-400' : 'text-green-400'}>
                      {dailyTotals.calories}/2000
                    </span>
                  </div>
                  <div className="w-full bg-slate-700 rounded-full h-2">
                    <div
                      className="bg-green-500 h-2 rounded-full"
                      style={{ width: `${Math.min((dailyTotals.calories / 2000) * 100, 100)}%` }}
                    ></div>
                  </div>

                  <div className="flex justify-between items-center">
                    <span>Protein</span>
                    <span className={dailyTotals.protein > 150 ? 'text-red-400' : dailyTotals.protein > 100 ? 'text-yellow-400' : 'text-green-400'}>
                      {dailyTotals.protein}g/150g
                    </span>
                  </div>
                  <div className="w-full bg-slate-700 rounded-full h-2">
                    <div
                      className="bg-blue-500 h-2 rounded-full"
                      style={{ width: `${Math.min((dailyTotals.protein / 150) * 100, 100)}%` }}
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'intelligence') {
        // Analyze patterns and provide personalized insights
        const analyzePatterns = () => {
          if (history.length < 7) {
            return {
              insights: [],
              message: "Need at least 7 days of data to generate insights. Keep tracking!"
            };
          }

          const insights = [];
          const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

          // Analyze workout patterns
          const workoutDays = history.filter(d => d.workoutDone);
          if (workoutDays.length > 0) {
            const workoutDayCounts = {};
            workoutDays.forEach(day => {
              const dayName = new Date(day.date).toLocaleDateString('en-US', { weekday: 'long' });
              workoutDayCounts[dayName] = (workoutDayCounts[dayName] || 0) + 1;
            });

            const bestWorkoutDay = Object.entries(workoutDayCounts)
              .sort(([,a], [,b]) => b - a)[0]?.[0];

            if (bestWorkoutDay) {
              insights.push({
                type: 'workout',
                icon: 'üí™',
                title: 'Workout Patterns',
                insight: `You workout most consistently on ${bestWorkoutDay}s. Consider scheduling important workouts on this day.`,
                impact: 'High'
              });
            }
          }

          // Analyze task completion vs mood
          const moodData = history.filter(d => d.mood);
          if (moodData.length > 3) {
            const moodTaskCorrelation = {};
            moodData.forEach(day => {
              const mood = day.mood;
              const taskRate = day.done ? (day.done.length / 18) * 100 : 0;
              if (!moodTaskCorrelation[mood]) moodTaskCorrelation[mood] = [];
              moodTaskCorrelation[mood].push(taskRate);
            });

            const bestMood = Object.entries(moodTaskCorrelation)
              .map(([mood, rates]) => ({
                mood,
                avgTasks: rates.reduce((a, b) => a + b, 0) / rates.length
              }))
              .sort((a, b) => b.avgTasks - a.avgTasks)[0];

            if (bestMood && bestMood.avgTasks > 50) {
              insights.push({
                type: 'mood',
                icon: 'üòä',
                title: 'Mood & Productivity',
                insight: `You're most productive when feeling ${bestMood.mood} (${Math.round(bestMood.avgTasks)}% task completion). Try to cultivate this emotional state.`,
                impact: 'High'
              });
            }
          }

          // Analyze reading patterns
          const readingDays = history.filter(d => d.done && d.done.some(task => task.includes('read')));
          if (readingDays.length > 0) {
            const avgTasksOnReadingDays = readingDays.reduce((sum, day) => sum + (day.done ? day.done.length : 0), 0) / readingDays.length;
            const avgTasksOverall = history.reduce((sum, day) => sum + (day.done ? day.done.length : 0), 0) / history.length;

            if (avgTasksOnReadingDays > avgTasksOverall + 2) {
              insights.push({
                type: 'reading',
                icon: 'üìö',
                title: 'Reading Impact',
                insight: `You complete ${Math.round(avgTasksOnReadingDays - avgTasksOverall)} more tasks on days you read. Reading boosts your productivity!`,
                impact: 'Medium'
              });
            }
          }

          // Analyze water intake patterns
          const waterData = history.filter(d => d.water && d.water > 0);
          if (waterData.length > 3) {
            const avgTasksWithWater = waterData.reduce((sum, day) => sum + (day.done ? day.done.length : 0), 0) / waterData.length;
            const avgTasksOverall = history.reduce((sum, day) => sum + (day.done ? day.done.length : 0), 0) / history.length;

            if (avgTasksWithWater > avgTasksOverall + 1) {
              insights.push({
                type: 'hydration',
                icon: 'üíß',
                title: 'Hydration Habits',
                insight: `You perform better when staying hydrated. Consider increasing water intake for optimal productivity.`,
                impact: 'Medium'
              });
            }
          }

          // Analyze sleep patterns (using morning routine as proxy)
          const morningRoutineDays = history.filter(d => d.done && d.done.some(task => task.includes('cold') || task.includes('sun')));
          if (morningRoutineDays.length > 0) {
            const avgTasksMorningDays = morningRoutineDays.reduce((sum, day) => sum + (day.done ? day.done.length : 0), 0) / morningRoutineDays.length;
            const avgTasksOverall = history.reduce((sum, day) => sum + (day.done ? day.done.length : 0), 0) / history.length;

            if (avgTasksMorningDays > avgTasksOverall + 1) {
              insights.push({
                type: 'routine',
                icon: 'üåÖ',
                title: 'Morning Routine',
                insight: `Your morning routine (cold exposure/sunlight) boosts productivity by ${Math.round(avgTasksMorningDays - avgTasksOverall)} tasks per day.`,
                impact: 'High'
              });
            }
          }

          // Analyze deep work patterns
          const deepWorkDays = history.filter(d => d.deepWork && parseFloat(d.deepWork) > 0);
          if (deepWorkDays.length > 3) {
            const deepWorkTaskCorr = deepWorkDays.map(day => ({
              deepWork: parseFloat(day.deepWork) || 0,
              tasks: day.done ? day.done.length : 0
            }));

            const correlation = deepWorkTaskCorr.reduce((sum, data) => sum + (data.deepWork * data.tasks), 0) /
                              deepWorkTaskCorr.length;

            if (correlation > 5) {
              insights.push({
                type: 'focus',
                icon: 'üéØ',
                title: 'Deep Work Benefits',
                insight: `Your deep work sessions strongly correlate with task completion. More focused time = better results.`,
                impact: 'High'
              });
            }
          }

          return {
            insights,
            message: insights.length === 0 ? "Keep tracking for more personalized insights!" : `Found ${insights.length} patterns in your data!`
          };
        };

        const { insights, message } = analyzePatterns();

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-1 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Today</button>
                <button onClick={() => setView('progress')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Progress</button>
                <button onClick={() => setView('workouts')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Affirmations</button>
                <button onClick={() => setView('coach')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Coach</button>
                <button onClick={() => setView('books')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Books</button>
                <button onClick={() => setView('nutrition')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Nutrition</button>
                <button onClick={() => setView('intelligence')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Intelligence</button>
                <button onClick={() => setView('wellness')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Wellness</button>
                <button onClick={() => setView('challenges')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Challenges</button>
                <button onClick={() => setView('coach-ai')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">AI Coach</button>
              </div>

              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <div className="flex items-center gap-3 mb-4">
                  <span className="text-3xl">üîÅ</span>
                  <div>
                    <h2 className="text-2xl font-bold text-amber-400">Habit Intelligence</h2>
                    <p className="text-gray-300">Adaptive insights based on your patterns</p>
                  </div>
                </div>

                <div className="bg-slate-700 rounded-lg p-4 mb-4">
                  <p className="text-lg text-white">{message}</p>
                  <p className="text-sm text-gray-400 mt-1">
                    Data from last {history.length} days analyzed
                  </p>
                </div>

                {history.length >= 7 && (
                  <div className="text-center">
                    <button
                      onClick={() => {
                        setSaveStatus('üîÑ Re-analyzing your patterns...');
                        setTimeout(() => setSaveStatus(''), 2000);
                      }}
                      className="px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors"
                    >
                      üîÑ Refresh Insights
                    </button>
                  </div>
                )}
              </div>

              {/* Insights List */}
              {insights.length > 0 && (
                <div className="space-y-4">
                  {insights.map((insight, index) => (
                    <div key={index} className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                      <div className="flex items-start gap-4">
                        <div className="text-3xl">{insight.icon}</div>
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-2">
                            <h3 className="text-lg font-bold text-amber-400">{insight.title}</h3>
                            <span className={`px-2 py-1 rounded text-xs font-medium ${
                              insight.impact === 'High' ? 'bg-red-600 text-white' :
                              insight.impact === 'Medium' ? 'bg-yellow-600 text-white' :
                              'bg-green-600 text-white'
                            }`}>
                              {insight.impact} Impact
                            </span>
                          </div>
                          <p className="text-gray-300 leading-relaxed">{insight.insight}</p>

                          <div className="mt-4 flex gap-2">
                            <button className="px-3 py-1 bg-slate-700 text-white rounded text-sm hover:bg-slate-600">
                              ‚úÖ Applied
                            </button>
                            <button className="px-3 py-1 bg-slate-600 text-white rounded text-sm hover:bg-slate-500">
                              ü§î Not Relevant
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {/* Pattern Visualization */}
              {history.length >= 7 && (
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 mt-6">
                  <h3 className="text-lg font-bold mb-4 text-amber-400">üìä Your Patterns</h3>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-slate-700 rounded-lg p-4">
                      <h4 className="font-medium mb-3 text-green-400">Most Productive Day</h4>
                      <p className="text-2xl font-bold text-white">
                        {(() => {
                          const dayAverages = {};
                          history.forEach(day => {
                            const dayName = new Date(day.date).toLocaleDateString('en-US', { weekday: 'short' });
                            if (!dayAverages[dayName]) dayAverages[dayName] = [];
                            dayAverages[dayName].push(day.done ? day.done.length : 0);
                          });

                          const averages = Object.entries(dayAverages).map(([day, tasks]) => ({
                            day,
                            avg: tasks.reduce((a, b) => a + b, 0) / tasks.length
                          }));

                          return averages.sort((a, b) => b.avg - a.avg)[0]?.day || 'N/A';
                        })()}
                      </p>
                      <p className="text-sm text-gray-400">Highest task completion</p>
                    </div>

                    <div className="bg-slate-700 rounded-lg p-4">
                      <h4 className="font-medium mb-3 text-blue-400">Consistency Score</h4>
                      <p className="text-2xl font-bold text-white">
                        {Math.round((history.filter(d => d.done && d.done.length > 0).length / history.length) * 100)}%
                      </p>
                      <p className="text-sm text-gray-400">Days with activity</p>
                    </div>

                    <div className="bg-slate-700 rounded-lg p-4">
                      <h4 className="font-medium mb-3 text-purple-400">Workout Frequency</h4>
                      <p className="text-2xl font-bold text-white">
                        {Math.round((history.filter(d => d.workoutDone).length / history.length) * 100)}%
                      </p>
                      <p className="text-sm text-gray-400">Days with workouts</p>
                    </div>

                    <div className="bg-slate-700 rounded-lg p-4">
                      <h4 className="font-medium mb-3 text-yellow-400">Reading Streak</h4>
                      <p className="text-2xl font-bold text-white">
                        {(() => {
                          let currentStreak = 0;
                          let maxStreak = 0;
                          for (let i = history.length - 1; i >= 0; i--) {
                            if (history[i].done && history[i].done.some(task => task.includes('read'))) {
                              currentStreak++;
                              maxStreak = Math.max(maxStreak, currentStreak);
                            } else {
                              currentStreak = 0;
                            }
                          }
                          return maxStreak;
                        })()} days
                      </p>
                      <p className="text-sm text-gray-400">Longest reading streak</p>
                    </div>
                  </div>
                </div>
              )}

              {/* Future Predictions */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 mt-6">
                <h3 className="text-lg font-bold mb-4 text-amber-400">üîÆ Tomorrow's Predictions</h3>
                <div className="space-y-3">
                  {(() => {
                    const predictions = [];

                    // Workout prediction
                    const recentWorkouts = history.slice(-7).filter(d => d.workoutDone).length;
                    if (recentWorkouts >= 4) {
                      predictions.push("High chance you'll complete tomorrow's workout based on your recent consistency!");
                    } else if (recentWorkouts <= 2) {
                      predictions.push("Consider scheduling tomorrow's workout - your pattern shows you might skip otherwise.");
                    }

                    // Productivity prediction
                    const avgTasks = history.slice(-7).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 7;
                    if (avgTasks >= 12) {
                      predictions.push("You're on a productivity high - tomorrow could be another strong day!");
                    } else if (avgTasks <= 6) {
                      predictions.push("Tomorrow might be challenging - consider starting with your easiest task first.");
                    }

                    // Mood prediction based on recent patterns
                    const recentMoods = history.slice(-3).filter(d => d.mood).map(d => d.mood);
                    if (recentMoods.length > 0) {
                      const mostCommonMood = recentMoods.sort((a,b) =>
                        recentMoods.filter(v => v===a).length - recentMoods.filter(v => v===b).length
                      ).pop();
                      predictions.push(`Based on recent days, you might feel ${mostCommonMood} tomorrow.`);
                    }

                    return predictions.length > 0 ? predictions : ["Keep tracking for personalized predictions!"];
                  })().map((prediction, index) => (
                    <div key={index} className="flex items-start gap-3 p-3 bg-slate-700 rounded-lg">
                      <span className="text-amber-400 mt-1">üí°</span>
                      <p className="text-gray-300 text-sm">{prediction}</p>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'wellness') {
        // Analyze mood and energy patterns with correlations
        const analyzeWellness = () => {
          if (history.length < 3) {
            return {
              moodEnergyData: [],
              correlations: [],
              insights: [],
              message: "Need at least 3 days of mood/energy data. Start tracking your feelings!"
            };
          }

          const moodEnergyData = history.filter(d => d.mood || d.energyLevel).map(day => ({
            date: day.date,
            mood: day.mood,
            energy: day.energyLevel,
            tasks: day.done ? day.done.length : 0,
            workoutDone: day.workoutDone,
            water: day.water || 0,
            sleepQuality: day.done && day.done.some(task => task.includes('sleep')) ? 'good' : 'unknown',
            socialTime: day.done && day.done.some(task => task.includes('connect')) ? 'yes' : 'no',
            deepWork: day.deepWork ? parseFloat(day.deepWork) : 0,
            nutritionLogged: false // We'll check nutrition data separately
          }));

          // Calculate correlations
          const correlations = [];

          // Mood vs Task Completion
          const moodTaskData = moodEnergyData.filter(d => d.mood);
          if (moodTaskData.length >= 3) {
            const moodScores = { 'üòä Sharp': 5, 'üôÇ Good': 4, 'üòê Okay': 3, 'üòî Off': 2, 'üò∞ Hard': 1 };
            const avgTasksByMood = {};
            moodTaskData.forEach(d => {
              if (!avgTasksByMood[d.mood]) avgTasksByMood[d.mood] = [];
              avgTasksByMood[d.mood].push(d.tasks);
            });

            const moodCorrelations = Object.entries(avgTasksByMood).map(([mood, tasks]) => ({
              factor: mood,
              avgTasks: tasks.reduce((a, b) => a + b, 0) / tasks.length,
              moodScore: moodScores[mood] || 3
            })).sort((a, b) => b.avgTasks - a.avgTasks);

            correlations.push({
              title: 'Mood vs Productivity',
              factor: 'Emotional State',
              data: moodCorrelations,
              insight: `${moodCorrelations[0].factor} days show ${Math.round(moodCorrelations[0].avgTasks)} avg tasks vs ${moodCorrelations[moodCorrelations.length-1].factor} days with ${Math.round(moodCorrelations[moodCorrelations.length-1].avgTasks)} avg tasks`,
              recommendation: `Prioritize activities that help you feel ${moodCorrelations[0].factor.split(' ')[1]}`
            });
          }

          // Energy vs Workouts
          const energyWorkoutData = moodEnergyData.filter(d => d.energy);
          if (energyWorkoutData.length >= 3) {
            const energyLevels = { 'high': 4, 'good': 3, 'low': 2, 'exhausted': 1 };
            const workoutRates = {};
            energyWorkoutData.forEach(d => {
              const energy = d.energy;
              if (!workoutRates[energy]) workoutRates[energy] = { total: 0, workouts: 0 };
              workoutRates[energy].total++;
              if (d.workoutDone) workoutRates[energy].workouts++;
            });

            const energyCorrelations = Object.entries(workoutRates).map(([energy, data]) => ({
              factor: energy,
              workoutRate: (data.workouts / data.total) * 100,
              energyScore: energyLevels[energy] || 2
            })).sort((a, b) => b.workoutRate - a.workoutRate);

            correlations.push({
              title: 'Energy vs Workouts',
              factor: 'Energy Level',
              data: energyCorrelations,
              insight: `${energyCorrelations[0].factor} energy days have ${Math.round(energyCorrelations[0].workoutRate)}% workout completion vs ${energyCorrelations[energyCorrelations.length-1].factor} days with ${Math.round(energyCorrelations[energyCorrelations.length-1].workoutRate)}%`,
              recommendation: `Schedule workouts on ${energyCorrelations[0].factor} energy days for better consistency`
            });
          }

          // Sleep vs Energy
          const sleepEnergyData = moodEnergyData.filter(d => d.energy && d.sleepQuality !== 'unknown');
          if (sleepEnergyData.length >= 3) {
            const sleepEnergyCorr = sleepEnergyData.reduce((acc, d) => {
              const key = d.sleepQuality;
              if (!acc[key]) acc[key] = { count: 0, totalEnergy: 0 };
              acc[key].count++;
              acc[key].totalEnergy += d.energy === 'high' ? 4 : d.energy === 'good' ? 3 : d.energy === 'low' ? 2 : 1;
              return acc;
            }, {});

            const sleepInsights = Object.entries(sleepEnergyCorr).map(([sleep, data]) => ({
              sleep,
              avgEnergy: data.totalEnergy / data.count,
              count: data.count
            })).sort((a, b) => b.avgEnergy - a.avgEnergy);

            correlations.push({
              title: 'Sleep vs Energy',
              factor: 'Sleep Quality',
              data: sleepInsights,
              insight: `${sleepInsights[0].sleep} sleep correlates with ${Math.round(sleepInsights[0].avgEnergy * 25)}% higher energy levels`,
              recommendation: `Prioritize ${sleepInsights[0].sleep} sleep to maintain high energy throughout the day`
            });
          }

          // Social Time vs Stress/Mood
          const socialMoodData = moodEnergyData.filter(d => d.mood);
          if (socialMoodData.length >= 3) {
            const socialMoodCorr = socialMoodData.reduce((acc, d) => {
              const social = d.socialTime;
              const moodScore = { 'üòä Sharp': 5, 'üôÇ Good': 4, 'üòê Okay': 3, 'üòî Off': 2, 'üò∞ Hard': 1 }[d.mood] || 3;
              if (!acc[social]) acc[social] = { count: 0, totalMood: 0 };
              acc[social].count++;
              acc[social].totalMood += moodScore;
              return acc;
            }, {});

            const socialInsights = Object.entries(socialMoodCorr).map(([social, data]) => ({
              social: social === 'yes' ? 'With Social Time' : 'Without Social Time',
              avgMood: data.totalMood / data.count,
              count: data.count
            })).sort((a, b) => b.avgMood - a.avgMood);

            correlations.push({
              title: 'Social Time vs Mood',
              factor: 'Social Connection',
              data: socialInsights,
              insight: `Days ${socialInsights[0].social.toLowerCase()} show ${Math.round((socialInsights[0].avgMood / 5) * 100)}% better mood scores`,
              recommendation: `Incorporate meaningful social connections to improve your emotional wellbeing`
            });
          }

          // Generate insights
          const insights = [];

          // Current day analysis
          const today = new Date().toLocaleDateString();
          const todayData = moodEnergyData.find(d => new Date(d.date).toLocaleDateString() === today);

          if (todayData) {
            if (todayData.energy === 'low' || todayData.energy === 'exhausted') {
              insights.push({
                type: 'energy',
                priority: 'high',
                message: 'Low energy detected. Consider a short walk, hydration, or light stretching.',
                icon: 'üîã'
              });
            }

            if (todayData.mood === 'üò∞ Hard' || todayData.mood === 'üòî Off') {
              insights.push({
                type: 'mood',
                priority: 'high',
                message: 'Challenging mood detected. Try deep breathing, gratitude, or connecting with someone.',
                icon: 'üßò'
              });
            }
          }

          // Pattern-based insights
          if (correlations.length > 0) {
            const topCorrelation = correlations[0];
            insights.push({
              type: 'pattern',
              priority: 'medium',
              message: `Pattern discovered: ${topCorrelation.insight}`,
              icon: 'üìä'
            });
          }

          return {
            moodEnergyData,
            correlations,
            insights,
            message: insights.length > 0 ? `Found ${insights.length} wellness insights!` : "Keep tracking mood & energy for personalized insights."
          };
        };

        const { moodEnergyData, correlations, insights, message } = analyzeWellness();

        // Get current mood/energy stats
        const currentMood = data.mood;
        const currentEnergy = data.energyLevel;

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-1 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Today</button>
                <button onClick={() => setView('progress')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Progress</button>
                <button onClick={() => setView('workouts')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Affirmations</button>
                <button onClick={() => setView('coach')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Coach</button>
                <button onClick={() => setView('books')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Books</button>
                <button onClick={() => setView('nutrition')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Nutrition</button>
                <button onClick={() => setView('intelligence')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Intelligence</button>
                <button onClick={() => setView('wellness')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Wellness</button>
                <button onClick={() => setView('challenges')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">Challenges</button>
                <button onClick={() => setView('coach-ai')} className="px-2 py-2 bg-slate-700 text-gray-300 rounded text-xs">AI Coach</button>
              </div>

              {/* Current Status */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <h2 className="text-2xl font-bold mb-4 text-center text-amber-400">üè• Wellness Dashboard</h2>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                  <div className="bg-slate-700 rounded-lg p-4">
                    <h3 className="font-medium mb-3 text-blue-400">Current Mood</h3>
                    <div className="text-3xl mb-2">{currentMood || 'Not set'}</div>
                    <p className="text-sm text-gray-400">
                      {currentMood ? 'Feeling tracked' : 'Tap to set your mood'}
                    </p>
                  </div>

                  <div className="bg-slate-700 rounded-lg p-4">
                    <h3 className="font-medium mb-3 text-green-400">Current Energy</h3>
                    <div className="text-3xl mb-2">
                      {currentEnergy === 'high' && '‚ö° High'}
                      {currentEnergy === 'good' && 'üîã Good'}
                      {currentEnergy === 'low' && 'ü™´ Low'}
                      {currentEnergy === 'exhausted' && 'üò¥ Exhausted'}
                      {!currentEnergy && 'Not set'}
                    </div>
                    <p className="text-sm text-gray-400">
                      {currentEnergy ? 'Energy level tracked' : 'Tap to set your energy'}
                    </p>
                  </div>
                </div>

                <div className="text-center">
                  <p className="text-lg text-white mb-2">{message}</p>
                  <p className="text-sm text-gray-400">
                    Based on {moodEnergyData.length} days of wellness data
                  </p>
                </div>
              </div>

              {/* Wellness Insights */}
              {insights.length > 0 && (
                <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-amber-400">üí° Wellness Insights</h3>
                  <div className="space-y-3">
                    {insights.map((insight, index) => (
                      <div key={index} className={`flex items-start gap-4 p-4 rounded-lg ${
                        insight.priority === 'high' ? 'bg-red-900 border border-red-700' :
                        insight.priority === 'medium' ? 'bg-yellow-900 border border-yellow-700' :
                        'bg-slate-700'
                      }`}>
                        <span className="text-2xl">{insight.icon}</span>
                        <div className="flex-1">
                          <p className="text-white font-medium">{insight.message}</p>
                          <div className="mt-2 flex gap-2">
                            <button className="px-3 py-1 bg-slate-600 text-white rounded text-sm hover:bg-slate-500">
                              ‚úÖ Applied
                            </button>
                            <button className="px-3 py-1 bg-slate-600 text-white rounded text-sm hover:bg-slate-500">
                              ü§î Later
                            </button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Correlations Analysis */}
              {correlations.length > 0 && (
                <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-amber-400">üîó Wellness Correlations</h3>
                  <div className="space-y-4">
                    {correlations.map((correlation, index) => (
                      <div key={index} className="bg-slate-700 rounded-lg p-4">
                        <h4 className="font-medium mb-2 text-blue-400">{correlation.title}</h4>
                        <p className="text-gray-300 text-sm mb-3">{correlation.insight}</p>
                        <div className="bg-slate-600 rounded p-3">
                          <p className="text-sm text-amber-400">üí° {correlation.recommendation}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Wellness Trends */}
              {moodEnergyData.length >= 7 && (
                <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-amber-400">üìà Wellness Trends (Last 7 Days)</h3>

                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-slate-700 rounded-lg p-4 text-center">
                      <h4 className="font-medium mb-2 text-green-400">Avg Mood Score</h4>
                      <p className="text-2xl font-bold">
                        {(() => {
                          const recentData = moodEnergyData.slice(-7);
                          const moodScores = recentData
                            .filter(d => d.mood)
                            .map(d => ({ 'üòä Sharp': 5, 'üôÇ Good': 4, 'üòê Okay': 3, 'üòî Off': 2, 'üò∞ Hard': 1 }[d.mood] || 3));
                          return moodScores.length > 0 ? Math.round((moodScores.reduce((a, b) => a + b, 0) / moodScores.length) * 20) + '%' : 'N/A';
                        })()}
                      </p>
                    </div>

                    <div className="bg-slate-700 rounded-lg p-4 text-center">
                      <h4 className="font-medium mb-2 text-blue-400">Energy Days</h4>
                      <p className="text-2xl font-bold">
                        {moodEnergyData.slice(-7).filter(d => d.energy === 'high' || d.energy === 'good').length}/7
                      </p>
                      <p className="text-xs text-gray-400">high/good energy</p>
                    </div>

                    <div className="bg-slate-700 rounded-lg p-4 text-center">
                      <h4 className="font-medium mb-2 text-purple-400">Best Mood Day</h4>
                      <p className="text-lg font-bold">
                        {(() => {
                          const dayMoods = {};
                          moodEnergyData.slice(-7).forEach(d => {
                            const day = new Date(d.date).toLocaleDateString('en-US', { weekday: 'short' });
                            if (d.mood && !dayMoods[day]) dayMoods[day] = d.mood;
                          });
                          const bestDay = Object.entries(dayMoods)
                            .map(([day, mood]) => ({ day, score: { 'üòä Sharp': 5, 'üôÇ Good': 4, 'üòê Okay': 3, 'üòî Off': 2, 'üò∞ Hard': 1 }[mood] || 3 }))
                            .sort((a, b) => b.score - a.score)[0];
                          return bestDay ? bestDay.day : 'N/A';
                        })()}
                      </p>
                    </div>

                    <div className="bg-slate-700 rounded-lg p-4 text-center">
                      <h4 className="font-medium mb-2 text-yellow-400">Wellness Streak</h4>
                      <p className="text-2xl font-bold">
                        {(() => {
                          let streak = 0;
                          for (let i = moodEnergyData.length - 1; i >= 0; i--) {
                            if (moodEnergyData[i].mood || moodEnergyData[i].energy) {
                              streak++;
                            } else {
                              break;
                            }
                          }
                          return streak;
                        })()}
                      </p>
                      <p className="text-xs text-gray-400">days tracking</p>
                    </div>
                  </div>
                </div>
              )}

              {/* Wellness Tips */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-4 text-amber-400">üå± Wellness Tips</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-3">
                    <div className="flex items-start gap-3">
                      <span className="text-green-400 mt-1">üíß</span>
                      <div>
                        <p className="font-medium text-white">Hydration Boost</p>
                        <p className="text-sm text-gray-400">Drink water when feeling low energy</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <span className="text-blue-400 mt-1">üèÉ</span>
                      <div>
                        <p className="font-medium text-white">Movement Matters</p>
                        <p className="text-sm text-gray-400">Short walks improve mood instantly</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <span className="text-purple-400 mt-1">üò¥</span>
                      <div>
                        <p className="font-medium text-white">Sleep Priority</p>
                        <p className="text-sm text-gray-400">7-9 hours transforms energy levels</p>
                      </div>
                    </div>
                  </div>
                  <div className="space-y-3">
                    <div className="flex items-start gap-3">
                      <span className="text-yellow-400 mt-1">ü§ù</span>
                      <div>
                        <p className="font-medium text-white">Social Connection</p>
                        <p className="text-sm text-gray-400">Meaningful conversations lift mood</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <span className="text-red-400 mt-1">üìù</span>
                      <div>
                        <p className="font-medium text-white">Gratitude Practice</p>
                        <p className="text-sm text-gray-400">3 daily thanks shift perspective</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <span className="text-pink-400 mt-1">üßò</span>
                      <div>
                        <p className="font-medium text-white">Mindful Breathing</p>
                        <p className="text-sm text-gray-400">4-7-8 breathing reduces stress</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'dashboard') {
        // Calculate comprehensive life scores
        const calculateLifeScores = () => {
          if (history.length < 3) {
            return {
              healthScore: 0,
              productivityScore: 0,
              moodScore: 0,
              consistencyScore: 0,
              goalProgress: [],
              insights: [],
              message: "Need at least 3 days of data for dashboard. Keep tracking!"
            };
          }

          // Health Score (0-100) - based on workouts, nutrition, water, energy
          const healthScore = (() => {
            let score = 0;
            const recent = history.slice(-7);

            // Workout consistency (40% weight)
            const workoutRate = recent.filter(d => d.workoutDone).length / recent.length;
            score += workoutRate * 40;

            // Nutrition tracking (30% weight)
            const nutritionRate = recent.filter(d => d.done && d.done.some(task => task.includes('protein') || task.includes('meal'))).length / recent.length;
            score += nutritionRate * 30;

            // Water intake (15% weight)
            const avgWater = recent.reduce((sum, d) => sum + (d.water || 0), 0) / recent.length;
            const waterScore = Math.min(avgWater / 8, 1); // Target 8 glasses
            score += waterScore * 15;

            // Energy levels (15% weight)
            const goodEnergyRate = recent.filter(d => d.energyLevel === 'high' || d.energyLevel === 'good').length / recent.length;
            score += goodEnergyRate * 15;

            return Math.round(Math.min(score, 100));
          })();

          // Productivity Score (0-100) - based on tasks, deep work, reading
          const productivityScore = (() => {
            let score = 0;
            const recent = history.slice(-7);

            // Task completion rate (50% weight)
            const avgTasks = recent.reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / recent.length;
            const taskScore = Math.min(avgTasks / 18, 1); // Target 18 tasks per day
            score += taskScore * 50;

            // Deep work time (30% weight)
            const avgDeepWork = recent.reduce((sum, d) => sum + (parseFloat(d.deepWork) || 0), 0) / recent.length;
            const deepWorkScore = Math.min(avgDeepWork / 4, 1); // Target 4 hours
            score += deepWorkScore * 30;

            // Reading habit (20% weight)
            const readingDays = recent.filter(d => d.done && d.done.some(task => task.includes('read'))).length;
            const readingScore = readingDays / recent.length;
            score += readingScore * 20;

            return Math.round(Math.min(score, 100));
          })();

          // Mood Score (0-100) - based on mood tracking and consistency
          const moodScore = (() => {
            let score = 0;
            const recent = history.slice(-7);

            // Positive mood ratio (60% weight)
            const moodData = recent.filter(d => d.mood);
            if (moodData.length > 0) {
              const positiveMoods = moodData.filter(d =>
                ['üòä Sharp', 'üôÇ Good'].includes(d.mood)
              ).length;
              const moodRatio = positiveMoods / moodData.length;
              score += moodRatio * 60;
            }

            // Mood tracking consistency (40% weight)
            const trackingRate = moodData.length / recent.length;
            score += trackingRate * 40;

            return Math.round(Math.min(score, 100));
          })();

          // Consistency Score (0-100) - based on daily tracking habits
          const consistencyScore = (() => {
            let score = 0;
            const recent = history.slice(-7);

            // Daily task completion (25% weight)
            const daysWithTasks = recent.filter(d => d.done && d.done.length > 0).length;
            score += (daysWithTasks / recent.length) * 25;

            // Workout consistency (25% weight)
            const workoutDays = recent.filter(d => d.workoutDone).length;
            score += (workoutDays / recent.length) * 25;

            // Mood tracking (25% weight)
            const moodDays = recent.filter(d => d.mood).length;
            score += (moodDays / recent.length) * 25;

            // Journal entries (25% weight)
            const journalDays = recent.filter(d => d.journal && d.journal.trim()).length;
            score += (journalDays / recent.length) * 25;

            return Math.round(Math.min(score, 100));
          })();

          // Goal Progress - based on various metrics
          const goalProgress = [
            {
              name: "Weekly Workouts",
              current: history.slice(-7).filter(d => d.workoutDone).length,
              target: 5,
              unit: "workouts",
              color: "blue"
            },
            {
              name: "Daily Water Intake",
              current: Math.round(history.slice(-7).reduce((sum, d) => sum + (d.water || 0), 0) / 7),
              target: 8,
              unit: "glasses",
              color: "cyan"
            },
            {
              name: "Task Completion",
              current: Math.round(history.slice(-7).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 7),
              target: 15,
              unit: "tasks/day",
              color: "green"
            },
            {
              name: "Deep Work Hours",
              current: Math.round(history.slice(-7).reduce((sum, d) => sum + (parseFloat(d.deepWork) || 0), 0) / 7 * 10) / 10,
              target: 3,
              unit: "hours/day",
              color: "purple"
            }
          ];

          // Generate insights based on scores
          const insights = [];
          if (healthScore < 50) insights.push({ type: 'warning', message: 'Health score needs attention - focus on workouts and nutrition', icon: '‚ö†Ô∏è' });
          if (productivityScore < 50) insights.push({ type: 'warning', message: 'Productivity could improve - try the 2-minute rule for starting tasks', icon: '‚ö†Ô∏è' });
          if (moodScore < 50) insights.push({ type: 'warning', message: 'Mood tracking shows room for improvement - consider gratitude practices', icon: '‚ö†Ô∏è' });
          if (consistencyScore < 50) insights.push({ type: 'warning', message: 'Consistency is key to success - establish daily rituals', icon: '‚ö†Ô∏è' });

          if (healthScore > 80) insights.push({ type: 'success', message: 'Excellent health habits! Keep up the great work.', icon: 'üéâ' });
          if (productivityScore > 80) insights.push({ type: 'success', message: 'Outstanding productivity! You\'re crushing your goals.', icon: 'üöÄ' });
          if (moodScore > 80) insights.push({ type: 'success', message: 'Fantastic emotional wellbeing! Maintain these positive habits.', icon: 'üòä' });
          if (consistencyScore > 80) insights.push({ type: 'success', message: 'Remarkable consistency! This is what creates lasting change.', icon: 'üí™' });

          return {
            healthScore,
            productivityScore,
            moodScore,
            consistencyScore,
            goalProgress,
            insights,
            message: insights.length > 0 ? `Dashboard updated with ${insights.length} insights!` : "Your life metrics are being tracked."
          };
        };

        const { healthScore, productivityScore, moodScore, consistencyScore, goalProgress, insights, message } = calculateLifeScores();

        // Overall life score (weighted average)
        const overallScore = Math.round((healthScore * 0.3) + (productivityScore * 0.3) + (moodScore * 0.2) + (consistencyScore * 0.2));

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-6xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-1 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Today</button>
                <button onClick={() => setView('progress')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Progress</button>
                <button onClick={() => setView('workouts')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Affirmations</button>
                <button onClick={() => setView('coach')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Coach</button>
                <button onClick={() => setView('books')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Books</button>
                <button onClick={() => setView('nutrition')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Nutrition</button>
                <button onClick={() => setView('intelligence')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Intelligence</button>
                <button onClick={() => setView('wellness')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Wellness</button>
                <button onClick={() => setView('dashboard')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Dashboard</button>
                <button onClick={() => setView('challenges')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Challenges</button>
                <button onClick={() => setView('coach-ai')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">AI Coach</button>
              </div>

              {/* Overall Life Score */}
              <div className="bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 rounded-xl p-8 mb-6 border border-amber-700 text-center">
                <div className="text-6xl font-bold text-white mb-2">{overallScore}</div>
                <div className="text-xl text-amber-200 mb-4">Overall Life Score</div>
                <div className="text-sm text-amber-300">
                  Based on last {history.length} days of tracking
                </div>
                <div className="mt-4">
                  <div className="text-xs text-amber-400">{message}</div>
                </div>
              </div>

              {/* Life Score Breakdown */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                {/* Health Score */}
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <span className="text-3xl">üí™</span>
                      <div>
                        <h3 className="font-bold text-green-400">Health</h3>
                        <p className="text-xs text-gray-400">Physical wellbeing</p>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className={`text-2xl font-bold ${
                        healthScore >= 80 ? 'text-green-400' :
                        healthScore >= 60 ? 'text-yellow-400' :
                        'text-red-400'
                      }`}>
                        {healthScore}
                      </div>
                      <div className="text-xs text-gray-500">/100</div>
                    </div>
                  </div>
                  <div className="w-full bg-slate-700 rounded-full h-2">
                    <div
                      className={`h-2 rounded-full ${
                        healthScore >= 80 ? 'bg-green-500' :
                        healthScore >= 60 ? 'bg-yellow-500' :
                        'bg-red-500'
                      }`}
                      style={{ width: `${healthScore}%` }}
                    ></div>
                  </div>
                  <div className="mt-3 text-xs text-gray-400">
                    Workouts ‚Ä¢ Nutrition ‚Ä¢ Hydration ‚Ä¢ Energy
                  </div>
                </div>

                {/* Productivity Score */}
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <span className="text-3xl">üöÄ</span>
                      <div>
                        <h3 className="font-bold text-blue-400">Productivity</h3>
                        <p className="text-xs text-gray-400">Task completion</p>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className={`text-2xl font-bold ${
                        productivityScore >= 80 ? 'text-blue-400' :
                        productivityScore >= 60 ? 'text-yellow-400' :
                        'text-red-400'
                      }`}>
                        {productivityScore}
                      </div>
                      <div className="text-xs text-gray-500">/100</div>
                    </div>
                  </div>
                  <div className="w-full bg-slate-700 rounded-full h-2">
                    <div
                      className={`h-2 rounded-full ${
                        productivityScore >= 80 ? 'bg-blue-500' :
                        productivityScore >= 60 ? 'bg-yellow-500' :
                        'bg-red-500'
                      }`}
                      style={{ width: `${productivityScore}%` }}
                    ></div>
                  </div>
                  <div className="mt-3 text-xs text-gray-400">
                    Tasks ‚Ä¢ Deep Work ‚Ä¢ Reading ‚Ä¢ Focus
                  </div>
                </div>

                {/* Mood Score */}
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <span className="text-3xl">üòä</span>
                      <div>
                        <h3 className="font-bold text-purple-400">Mood</h3>
                        <p className="text-xs text-gray-400">Emotional wellbeing</p>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className={`text-2xl font-bold ${
                        moodScore >= 80 ? 'text-purple-400' :
                        moodScore >= 60 ? 'text-yellow-400' :
                        'text-red-400'
                      }`}>
                        {moodScore}
                      </div>
                      <div className="text-xs text-gray-500">/100</div>
                    </div>
                  </div>
                  <div className="w-full bg-slate-700 rounded-full h-2">
                    <div
                      className={`h-2 rounded-full ${
                        moodScore >= 80 ? 'bg-purple-500' :
                        moodScore >= 60 ? 'bg-yellow-500' :
                        'bg-red-500'
                      }`}
                      style={{ width: `${moodScore}%` }}
                    ></div>
                  </div>
                  <div className="mt-3 text-xs text-gray-400">
                    Positive Days ‚Ä¢ Tracking ‚Ä¢ Balance
                  </div>
                </div>

                {/* Consistency Score */}
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-3">
                      <span className="text-3xl">üéØ</span>
                      <div>
                        <h3 className="font-bold text-orange-400">Consistency</h3>
                        <p className="text-xs text-gray-400">Habit formation</p>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className={`text-2xl font-bold ${
                        consistencyScore >= 80 ? 'text-orange-400' :
                        consistencyScore >= 60 ? 'text-yellow-400' :
                        'text-red-400'
                      }`}>
                        {consistencyScore}
                      </div>
                      <div className="text-xs text-gray-500">/100</div>
                    </div>
                  </div>
                  <div className="w-full bg-slate-700 rounded-full h-2">
                    <div
                      className={`h-2 rounded-full ${
                        consistencyScore >= 80 ? 'bg-orange-500' :
                        consistencyScore >= 60 ? 'bg-yellow-500' :
                        'bg-red-500'
                      }`}
                      style={{ width: `${consistencyScore}%` }}
                    ></div>
                  </div>
                  <div className="mt-3 text-xs text-gray-400">
                    Daily Habits ‚Ä¢ Tracking ‚Ä¢ Discipline
                  </div>
                </div>
              </div>

              {/* Goal Progress */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-4 text-amber-400">üéØ Goal Progress (7-Day Average)</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {goalProgress.map((goal, index) => (
                    <div key={index} className="bg-slate-700 rounded-lg p-4">
                      <div className="flex items-center justify-between mb-2">
                        <span className="font-medium text-white">{goal.name}</span>
                        <span className={`text-sm font-bold ${
                          goal.color === 'blue' ? 'text-blue-400' :
                          goal.color === 'cyan' ? 'text-cyan-400' :
                          goal.color === 'green' ? 'text-green-400' :
                          'text-purple-400'
                        }`}>
                          {goal.current}{goal.unit.includes('/') ? '' : ' '}{goal.unit}
                        </span>
                      </div>
                      <div className="w-full bg-slate-600 rounded-full h-2 mb-2">
                        <div
                          className={`h-2 rounded-full ${
                            goal.color === 'blue' ? 'bg-blue-500' :
                            goal.color === 'cyan' ? 'bg-cyan-500' :
                            goal.color === 'green' ? 'bg-green-500' :
                            'bg-purple-500'
                          }`}
                          style={{ width: `${Math.min((goal.current / goal.target) * 100, 100)}%` }}
                        ></div>
                      </div>
                      <div className="text-xs text-gray-400">
                        Target: {goal.target} {goal.unit}
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Insights & Recommendations */}
              {insights.length > 0 && (
                <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-amber-400">üí° Life Insights</h3>
                  <div className="space-y-3">
                    {insights.map((insight, index) => (
                      <div key={index} className={`flex items-start gap-4 p-4 rounded-lg ${
                        insight.type === 'success' ? 'bg-green-900 border border-green-700' :
                        'bg-yellow-900 border border-yellow-700'
                      }`}>
                        <span className="text-2xl">{insight.icon}</span>
                        <p className={`text-sm ${
                          insight.type === 'success' ? 'text-green-200' : 'text-yellow-200'
                        }`}>
                          {insight.message}
                        </p>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Weekly Trends */}
              {history.length >= 7 && (
                <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-amber-400">üìä Weekly Trends</h3>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div className="bg-slate-700 rounded-lg p-4 text-center">
                      <h4 className="font-medium mb-3 text-green-400">Best Performing Day</h4>
                      <p className="text-2xl font-bold text-white">
                        {(() => {
                          const dayAverages = {};
                          history.slice(-7).forEach(day => {
                            const dayName = new Date(day.date).toLocaleDateString('en-US', { weekday: 'short' });
                            if (!dayAverages[dayName]) dayAverages[dayName] = [];
                            dayAverages[dayName].push(day.done ? day.done.length : 0);
                          });

                          const averages = Object.entries(dayAverages).map(([day, tasks]) => ({
                            day,
                            avg: tasks.reduce((a, b) => a + b, 0) / tasks.length
                          }));

                          return averages.sort((a, b) => b.avg - a.avg)[0]?.day || 'N/A';
                        })()}
                      </p>
                      <p className="text-sm text-gray-400">highest productivity</p>
                    </div>

                    <div className="bg-slate-700 rounded-lg p-4 text-center">
                      <h4 className="font-medium mb-3 text-blue-400">Current Streak</h4>
                      <p className="text-2xl font-bold text-white">
                        {(() => {
                          let streak = 0;
                          for (let i = history.length - 1; i >= 0; i--) {
                            if (history[i].done && history[i].done.length > 0) {
                              streak++;
                            } else {
                              break;
                            }
                          }
                          return streak;
                        })()} days
                      </p>
                      <p className="text-sm text-gray-400">consecutive active days</p>
                    </div>

                    <div className="bg-slate-700 rounded-lg p-4 text-center">
                      <h4 className="font-medium mb-3 text-purple-400">Improvement Rate</h4>
                      <p className="text-2xl font-bold text-white">
                        {(() => {
                          if (history.length < 14) return 'N/A';
                          const recentWeek = history.slice(-7).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 7;
                          const previousWeek = history.slice(-14, -7).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 7;
                          const improvement = ((recentWeek - previousWeek) / previousWeek) * 100;
                          return (improvement > 0 ? '+' : '') + Math.round(improvement) + '%';
                        })()}
                      </p>
                      <p className="text-sm text-gray-400">vs last week</p>
                    </div>
                  </div>
                </div>
              )}

              {/* Action Items */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-4 text-amber-400">üéØ Quick Actions</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                  <button
                    onClick={() => setView('today')}
                    className="p-3 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors text-left"
                  >
                    <div className="text-blue-400 font-medium">üìù Log Today</div>
                    <div className="text-xs text-gray-400">Add your daily data</div>
                  </button>
                  <button
                    onClick={() => setView('workouts')}
                    className="p-3 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors text-left"
                  >
                    <div className="text-green-400 font-medium">üí™ Workout</div>
                    <div className="text-xs text-gray-400">Start your session</div>
                  </button>
                  <button
                    onClick={() => setView('nutrition')}
                    className="p-3 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors text-left"
                  >
                    <div className="text-purple-400 font-medium">ü•ó Nutrition</div>
                    <div className="text-xs text-gray-400">Track your meals</div>
                  </button>
                  <button
                    onClick={() => setView('books')}
                    className="p-3 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors text-left"
                  >
                    <div className="text-amber-400 font-medium">üìö Learn</div>
                    <div className="text-xs text-gray-400">Read and apply ideas</div>
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'challenges') {
        const suggestedChallenges = getSuggestedChallenges();

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-6xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-1 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Today</button>
                <button onClick={() => setView('progress')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Progress</button>
                <button onClick={() => setView('workouts')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Affirmations</button>
                <button onClick={() => setView('coach')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Coach</button>
                <button onClick={() => setView('books')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Books</button>
                <button onClick={() => setView('nutrition')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Nutrition</button>
                <button onClick={() => setView('intelligence')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Intelligence</button>
                <button onClick={() => setView('wellness')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Wellness</button>
                <button onClick={() => setView('dashboard')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Dashboard</button>
                <button onClick={() => setView('challenges')} className="px-1 py-2 bg-amber-600 text-white rounded text-xs">Challenges</button>
              </div>

              {/* Challenge Header */}
              <div className="bg-gradient-to-r from-purple-900 via-pink-900 to-red-900 rounded-xl p-6 mb-6 border border-purple-700">
                <div className="flex items-center gap-3 mb-4">
                  <span className="text-4xl">üéØ</span>
                  <div>
                    <h2 className="text-2xl font-bold text-white">Challenge Mode</h2>
                    <p className="text-purple-200">Gamify your growth journey</p>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="bg-purple-800 rounded-lg p-4 text-center">
                    <h3 className="font-medium mb-2 text-purple-200">Active Challenges</h3>
                    <p className="text-3xl font-bold text-white">{challenges.length}</p>
                  </div>
                  <div className="bg-pink-800 rounded-lg p-4 text-center">
                    <h3 className="font-medium mb-2 text-pink-200">Completed</h3>
                    <p className="text-3xl font-bold text-white">{completedChallenges.length}</p>
                  </div>
                  <div className="bg-red-800 rounded-lg p-4 text-center">
                    <h3 className="font-medium mb-2 text-red-200">Badges Earned</h3>
                    <p className="text-3xl font-bold text-white">{badges.length}</p>
                  </div>
                </div>
              </div>

              {/* Active Challenges */}
              {challenges.length > 0 && (
                <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-amber-400">üéØ Active Challenges</h3>
                  <div className="space-y-4">
                    {challenges.map((challenge) => {
                      const progress = challenge.progress.length;
                      const completedDays = challenge.progress.filter(p => p.completed).length;
                      const percentage = challenge.duration > 0 ? Math.round((progress / challenge.duration) * 100) : 0;
                      const completionRate = progress > 0 ? Math.round((completedDays / progress) * 100) : 0;

                      const today = new Date().toISOString().split('T')[0];
                      const todayCompleted = challenge.progress.some(p => p.date === today && p.completed);

                      return (
                        <div key={challenge.id} className="bg-slate-700 rounded-lg p-4">
                          <div className="flex items-start justify-between mb-3">
                            <div className="flex-1">
                              <h4 className="font-bold text-white text-lg">{challenge.title}</h4>
                              <p className="text-gray-300 text-sm mb-2">{challenge.description}</p>
                              <div className="flex items-center gap-4 text-xs text-gray-400">
                                <span>üî• Streak: {challenge.currentStreak}</span>
                                <span>‚≠ê Best: {challenge.bestStreak}</span>
                                <span>üìÖ {progress}/{challenge.duration} days</span>
                              </div>
                            </div>
                            <div className="text-right">
                              <div className="text-2xl font-bold text-amber-400">{completionRate}%</div>
                              <div className="text-xs text-gray-400">success rate</div>
                            </div>
                          </div>

                          {/* Progress Bar */}
                          <div className="w-full bg-slate-600 rounded-full h-3 mb-3">
                            <div
                              className="bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-300"
                              style={{ width: `${percentage}%` }}
                            ></div>
                          </div>

                          {/* Today's Action */}
                          <div className="flex items-center justify-between">
                            <div className="text-sm text-gray-300">
                              {todayCompleted ? (
                                <span className="text-green-400">‚úÖ Completed today!</span>
                              ) : (
                                <span>Ready for today's challenge</span>
                              )}
                            </div>
                            <button
                              onClick={() => updateChallengeProgress(challenge.id, !todayCompleted)}
                              className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                todayCompleted
                                  ? 'bg-green-600 text-white hover:bg-green-700'
                                  : 'bg-amber-600 text-white hover:bg-amber-700'
                              }`}
                            >
                              {todayCompleted ? '‚úÖ Done' : 'Mark Complete'}
                            </button>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}

              {/* Suggested Challenges */}
              <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-bold text-amber-400">üí° Suggested Challenges</h3>
                  <button
                    onClick={() => setShowCreateChallenge(true)}
                    className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                  >
                    ‚ûï Create Custom
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {suggestedChallenges.map((challenge, index) => (
                    <div key={index} className="bg-slate-700 rounded-lg p-4 border border-slate-600">
                      <div className="flex items-start justify-between mb-3">
                        <div className="flex-1">
                          <h4 className="font-bold text-white">{challenge.title}</h4>
                          <p className="text-gray-300 text-sm mb-2">{challenge.description}</p>
                          <div className="flex items-center gap-3 text-xs text-gray-400">
                            <span>‚è±Ô∏è {challenge.duration} days</span>
                            <span>üèÜ {challenge.reward}</span>
                          </div>
                        </div>
                        <span className="text-2xl">{getBadgeIcon(challenge.category)}</span>
                      </div>

                      <button
                        onClick={() => {
                          createChallenge(challenge);
                          setSaveStatus(`üéØ Started "${challenge.title}" challenge!`);
                          setTimeout(() => setSaveStatus(''), 3000);
                        }}
                        className="w-full py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors font-medium"
                      >
                        Start Challenge
                      </button>
                    </div>
                  ))}
                </div>
              </div>

              {/* Create Custom Challenge Modal */}
              {showCreateChallenge && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                  <div className="bg-slate-800 rounded-xl p-6 max-w-md w-full mx-4">
                    <h3 className="text-lg font-bold mb-4 text-amber-400">üéØ Create Custom Challenge</h3>
                    <div className="space-y-4">
                      <input
                        type="text"
                        placeholder="Challenge title"
                        className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                      />
                      <textarea
                        placeholder="Challenge description"
                        className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                        rows="3"
                      />
                      <div className="grid grid-cols-2 gap-4">
                        <input
                          type="number"
                          placeholder="Duration (days)"
                          className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                        />
                        <select className="w-full p-3 bg-slate-700 rounded-lg text-white">
                          <option value="">Category</option>
                          <option value="fitness">Fitness</option>
                          <option value="nutrition">Nutrition</option>
                          <option value="productivity">Productivity</option>
                          <option value="mindfulness">Mindfulness</option>
                          <option value="reading">Reading</option>
                          <option value="discipline">Discipline</option>
                        </select>
                      </div>
                      <input
                        type="text"
                        placeholder="Reward badge name"
                        className="w-full p-3 bg-slate-700 rounded-lg text-white placeholder-gray-400"
                      />
                    </div>
                    <div className="flex gap-2 mt-6">
                      <button
                        onClick={() => {
                          // Create custom challenge logic would go here
                          setShowCreateChallenge(false);
                          setSaveStatus('üéØ Custom challenge created!');
                          setTimeout(() => setSaveStatus(''), 3000);
                        }}
                        className="flex-1 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700"
                      >
                        Create Challenge
                      </button>
                      <button
                        onClick={() => setShowCreateChallenge(false)}
                        className="flex-1 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500"
                      >
                        Cancel
                      </button>
                    </div>
                  </div>
                </div>
              )}

              {/* Completed Challenges & Badges */}
              {(completedChallenges.length > 0 || badges.length > 0) && (
                <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
                  <h3 className="text-lg font-bold mb-4 text-amber-400">üèÜ Achievements</h3>

                  {/* Badges */}
                  {badges.length > 0 && (
                    <div className="mb-6">
                      <h4 className="font-medium mb-3 text-purple-400">Badges Earned</h4>
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                        {badges.map((badge, index) => (
                          <div key={index} className="bg-gradient-to-br from-purple-600 to-pink-600 rounded-lg p-3 text-center">
                            <div className="text-2xl mb-1">{badge.icon}</div>
                            <div className="text-white font-medium text-sm">{badge.name}</div>
                            <div className="text-purple-200 text-xs">{badge.description}</div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Completed Challenges */}
                  {completedChallenges.length > 0 && (
                    <div>
                      <h4 className="font-medium mb-3 text-green-400">Completed Challenges</h4>
                      <div className="space-y-3">
                        {completedChallenges.map((challenge) => (
                          <div key={challenge.id} className="bg-slate-700 rounded-lg p-4 border border-green-600">
                            <div className="flex items-center gap-3">
                              <span className="text-green-400 text-2xl">üèÜ</span>
                              <div className="flex-1">
                                <h5 className="font-bold text-white">{challenge.title}</h5>
                                <p className="text-gray-300 text-sm">{challenge.description}</p>
                                <div className="flex items-center gap-4 mt-2 text-xs text-gray-400">
                                  <span>üìÖ {challenge.duration} days completed</span>
                                  <span>üî• Best streak: {challenge.bestStreak}</span>
                                  <span>‚≠ê Completed: {new Date(challenge.completedAt).toLocaleDateString()}</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              )}

              {/* Challenge Tips */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-4 text-amber-400">üí° Challenge Success Tips</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-3">
                    <div className="flex items-start gap-3">
                      <span className="text-blue-400 mt-1">üéØ</span>
                      <div>
                        <p className="font-medium text-white">Start Small</p>
                        <p className="text-sm text-gray-400">Choose challenges that are challenging but achievable</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <span className="text-green-400 mt-1">üî•</span>
                      <div>
                        <p className="font-medium text-white">Build Streaks</p>
                        <p className="text-sm text-gray-400">Focus on consistency over perfection</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <span className="text-purple-400 mt-1">ü§ù</span>
                      <div>
                        <p className="font-medium text-white">Accountability</p>
                        <p className="text-sm text-gray-400">Share your challenges with friends or online</p>
                      </div>
                    </div>
                  </div>
                  <div className="space-y-3">
                    <div className="flex items-start gap-3">
                      <span className="text-yellow-400 mt-1">üìä</span>
                      <div>
                        <p className="font-medium text-white">Track Progress</p>
                        <p className="text-sm text-gray-400">Use the dashboard to monitor your improvement</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <span className="text-red-400 mt-1">üéâ</span>
                      <div>
                        <p className="font-medium text-white">Celebrate Wins</p>
                        <p className="text-sm text-gray-400">Reward yourself when you complete challenges</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <span className="text-pink-400 mt-1">üîÑ</span>
                      <div>
                        <p className="font-medium text-white">Learn & Adapt</p>
                        <p className="text-sm text-gray-400">Use insights to improve future challenges</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'coach-ai') {
        const coachInsights = generateAICoachInsights();

        return (
          <div className="min-h-screen p-4">
            <div className="max-w-6xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-1 justify-center mb-6 flex-wrap">
                <button onClick={() => setView('today')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Today</button>
                <button onClick={() => setView('progress')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Progress</button>
                <button onClick={() => setView('workouts')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Workouts</button>
                <button onClick={() => setView('affirmations')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Affirmations</button>
                <button onClick={() => setView('coach')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Coach</button>
                <button onClick={() => setView('books')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Books</button>
                <button onClick={() => setView('nutrition')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Nutrition</button>
                <button onClick={() => setView('intelligence')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Intelligence</button>
                <button onClick={() => setView('wellness')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Wellness</button>
                <button onClick={() => setView('dashboard')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Dashboard</button>
                <button onClick={() => setView('challenges')} className="px-1 py-2 bg-slate-700 text-gray-300 rounded text-xs">Challenges</button>
                <button onClick={() => setView('coach-ai')} className="px-1 py-2 bg-amber-600 text-white rounded text-xs">AI Coach</button>
              </div>

              {/* AI Coach Header */}
              <div className="bg-gradient-to-r from-blue-900 via-purple-900 to-indigo-900 rounded-xl p-6 mb-6 border border-blue-700">
                <div className="flex items-center gap-3 mb-4">
                  <span className="text-4xl">üß¨</span>
                  <div>
                    <h2 className="text-2xl font-bold text-white">AI Life Coach</h2>
                    <p className="text-blue-200">Your intelligent personal development partner</p>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div className="bg-blue-800 rounded-lg p-4 text-center">
                    <h3 className="font-medium mb-2 text-blue-200">Data Points</h3>
                    <p className="text-3xl font-bold text-white">{history.length}</p>
                    <p className="text-sm text-blue-300">days analyzed</p>
                  </div>
                  <div className="bg-purple-800 rounded-lg p-4 text-center">
                    <h3 className="font-medium mb-2 text-purple-200">Insights Generated</h3>
                    <p className="text-3xl font-bold text-white">
                      {coachInsights.personalizedSuggestions.length + coachInsights.patternInsights.length}
                    </p>
                    <p className="text-sm text-purple-300">personalized tips</p>
                  </div>
                  <div className="bg-indigo-800 rounded-lg p-4 text-center">
                    <h3 className="font-medium mb-2 text-indigo-200">Coach Mode</h3>
                    <p className="text-lg font-bold text-white capitalize">{coachMode}</p>
                    <p className="text-sm text-indigo-300">current focus</p>
                  </div>
                </div>
              </div>

              {/* Coach Mode Selector */}
              <div className="bg-slate-800 rounded-xl p-4 mb-6 border border-slate-700">
                <div className="flex gap-2 justify-center">
                  {[
                    { key: 'daily', label: 'Daily Check-in', icon: 'üåÖ', desc: 'Today\'s focus & priorities' },
                    { key: 'weekly', label: 'Weekly Review', icon: 'üìä', desc: '7-day pattern analysis' },
                    { key: 'monthly', label: 'Monthly Reflection', icon: 'üåô', desc: '30-day growth insights' }
                  ].map((mode) => (
                    <button
                      key={mode.key}
                      onClick={() => setCoachMode(mode.key)}
                      className={`flex-1 p-4 rounded-lg border transition-all ${
                        coachMode === mode.key
                          ? 'bg-amber-600 border-amber-500 text-white'
                          : 'bg-slate-700 border-slate-600 text-gray-300 hover:bg-slate-600'
                      }`}
                    >
                      <div className="text-2xl mb-2">{mode.icon}</div>
                      <div className="font-medium text-sm">{mode.label}</div>
                      <div className="text-xs opacity-75 mt-1">{mode.desc}</div>
                    </button>
                  ))}
                </div>
              </div>

              {/* Daily Check-in Mode */}
              {coachMode === 'daily' && (
                <div className="space-y-6">
                  {/* Today's Focus */}
                  <div className="bg-slate-800 rounded-xl p-6 border border-amber-700">
                    <div className="flex items-center gap-3 mb-4">
                      <span className="text-3xl">üéØ</span>
                      <div>
                        <h3 className="text-lg font-bold text-amber-400">Today's Focus</h3>
                        <p className="text-sm text-gray-400">Here's what you should prioritize today</p>
                      </div>
                    </div>

                    <div className="bg-amber-900 rounded-lg p-4">
                      <p className="text-white text-lg leading-relaxed">{coachInsights.dailyFocus}</p>
                    </div>

                    <div className="mt-4 flex gap-2">
                      <button className="flex-1 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors">
                        ‚úÖ Applied Today
                      </button>
                      <button className="flex-1 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500">
                        ü§î Need Clarification
                      </button>
                    </div>
                  </div>

                  {/* Priority Actions */}
                  {coachInsights.priorityActions.length > 0 && (
                    <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                      <h3 className="text-lg font-bold mb-4 text-red-400">üö® Priority Actions</h3>
                      <div className="space-y-3">
                        {coachInsights.priorityActions.map((action, index) => (
                          <div key={index} className={`flex items-start gap-4 p-4 rounded-lg ${
                            action.urgency === 'high' ? 'bg-red-900 border border-red-700' :
                            'bg-yellow-900 border border-yellow-700'
                          }`}>
                            <span className="text-2xl mt-1">
                              {action.urgency === 'high' ? 'üî•' : '‚ö°'}
                            </span>
                            <div className="flex-1">
                              <p className="text-white font-medium">{action.action}</p>
                              <p className="text-sm text-gray-300 mt-1">{action.reason}</p>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Personalized Suggestions */}
                  {coachInsights.personalizedSuggestions.length > 0 && (
                    <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                      <h3 className="text-lg font-bold mb-4 text-green-400">üí° Personalized Suggestions</h3>
                      <div className="space-y-3">
                        {coachInsights.personalizedSuggestions.map((suggestion, index) => (
                          <div key={index} className="flex items-start gap-4 p-4 bg-slate-700 rounded-lg">
                            <span className="text-2xl">{suggestion.icon}</span>
                            <div className="flex-1">
                              <h4 className="font-medium text-white">{suggestion.title}</h4>
                              <p className="text-gray-300 text-sm mt-1">{suggestion.suggestion}</p>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              )}

              {/* Weekly Review Mode */}
              {coachMode === 'weekly' && (
                <div className="space-y-6">
                  {/* Weekly Overview */}
                  <div className="bg-slate-800 rounded-xl p-6 border border-blue-700">
                    <div className="flex items-center gap-3 mb-4">
                      <span className="text-3xl">üìä</span>
                      <div>
                        <h3 className="text-lg font-bold text-blue-400">Weekly Review</h3>
                        <p className="text-sm text-gray-400">Your 7-day performance analysis</p>
                      </div>
                    </div>

                    <div className="bg-blue-900 rounded-lg p-4">
                      <p className="text-white leading-relaxed">{coachInsights.weeklyReview}</p>
                    </div>

                    {/* Weekly Stats Grid */}
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                      <div className="bg-slate-700 rounded-lg p-3 text-center">
                        <p className="text-2xl font-bold text-blue-400">
                          {Math.round(history.slice(-7).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 7 * 10) / 10}
                        </p>
                        <p className="text-xs text-gray-400">avg tasks/day</p>
                      </div>
                      <div className="bg-slate-700 rounded-lg p-3 text-center">
                        <p className="text-2xl font-bold text-green-400">
                          {history.slice(-7).filter(d => d.workoutDone).length}
                        </p>
                        <p className="text-xs text-gray-400">workouts</p>
                      </div>
                      <div className="bg-slate-700 rounded-lg p-3 text-center">
                        <p className="text-2xl font-bold text-purple-400">
                          {Math.round(history.slice(-7).filter(d => d.mood).map(d => {
                            const scores = { 'üòä Sharp': 5, 'üôÇ Good': 4, 'üòê Okay': 3, 'üòî Off': 2, 'üò∞ Hard': 1 };
                            return scores[d.mood] || 3;
                          }).reduce((a, b) => a + b, 0) / Math.max(1, history.slice(-7).filter(d => d.mood).length) * 10) / 10}
                        </p>
                        <p className="text-xs text-gray-400">avg mood</p>
                      </div>
                      <div className="bg-slate-700 rounded-lg p-3 text-center">
                        <p className="text-2xl font-bold text-yellow-400">
                          {history.slice(-7).filter(d => d.done && d.done.some(task => task.includes('read'))).length}
                        </p>
                        <p className="text-xs text-gray-400">reading days</p>
                      </div>
                    </div>
                  </div>

                  {/* Pattern Insights */}
                  {coachInsights.patternInsights.length > 0 && (
                    <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                      <h3 className="text-lg font-bold mb-4 text-purple-400">üîç Pattern Insights</h3>
                      <div className="space-y-3">
                        {coachInsights.patternInsights.map((insight, index) => (
                          <div key={index} className="flex items-start gap-4 p-4 bg-slate-700 rounded-lg">
                            <span className="text-2xl">
                              {insight.impact === 'High' ? 'üî•' : insight.impact === 'Medium' ? '‚ö°' : 'üí°'}
                            </span>
                            <div className="flex-1">
                              <h4 className="font-medium text-white">{insight.title}</h4>
                              <p className="text-gray-300 text-sm mt-1">{insight.insight}</p>
                              <span className={`inline-block mt-2 px-2 py-1 rounded text-xs font-medium ${
                                insight.impact === 'High' ? 'bg-red-600 text-white' :
                                insight.impact === 'Medium' ? 'bg-yellow-600 text-white' :
                                'bg-green-600 text-white'
                              }`}>
                                {insight.impact} Impact
                              </span>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* Next Week Planning */}
                  <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                    <h3 className="text-lg font-bold mb-4 text-green-400">üéØ Next Week Focus</h3>
                    <div className="space-y-4">
                      <div className="bg-slate-700 rounded-lg p-4">
                        <h4 className="font-medium mb-2 text-green-400">Maintain Your Strengths</h4>
                        <div className="space-y-2 text-sm text-gray-300">
                          {history.slice(-7).filter(d => d.workoutDone).length >= 4 && (
                            <div>‚úÖ Keep up the workout momentum</div>
                          )}
                          {history.slice(-7).filter(d => d.done && d.done.some(task => task.includes('read'))).length >= 4 && (
                            <div>‚úÖ Continue your reading streak</div>
                          )}
                          {history.slice(-7).filter(d => d.mood).length >= 5 && (
                            <div>‚úÖ Maintain mood tracking consistency</div>
                          )}
                        </div>
                      </div>

                      <div className="bg-slate-700 rounded-lg p-4">
                        <h4 className="font-medium mb-2 text-blue-400">Areas for Growth</h4>
                        <div className="space-y-2 text-sm text-gray-300">
                          {history.slice(-7).filter(d => d.done && d.done.length > 0).length < 5 && (
                            <div>üéØ Increase daily task completion</div>
                          )}
                          {history.slice(-7).filter(d => d.workoutDone).length < 3 && (
                            <div>üéØ Build workout consistency</div>
                          )}
                          {history.slice(-7).filter(d => d.mood).length < 4 && (
                            <div>üéØ Track mood more regularly</div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Monthly Reflection Mode */}
              {coachMode === 'monthly' && (
                <div className="space-y-6">
                  {/* Monthly Overview */}
                  <div className="bg-slate-800 rounded-xl p-6 border border-indigo-700">
                    <div className="flex items-center gap-3 mb-4">
                      <span className="text-3xl">üåô</span>
                      <div>
                        <h3 className="text-lg font-bold text-indigo-400">Monthly Reflection</h3>
                        <p className="text-sm text-gray-400">Deep insights from your 30-day journey</p>
                      </div>
                    </div>

                    {history.length >= 30 ? (
                      <div className="bg-indigo-900 rounded-lg p-4">
                        <p className="text-white leading-relaxed">{coachInsights.monthlyReflection}</p>
                      </div>
                    ) : (
                      <div className="bg-slate-700 rounded-lg p-4 text-center">
                        <p className="text-gray-300">
                          Monthly reflections unlock after 30 days of consistent tracking.
                          You're currently at {history.length} days - keep going!
                        </p>
                      </div>
                    )}

                    {/* Monthly Stats */}
                    {history.length >= 30 && (
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                        <div className="bg-slate-700 rounded-lg p-3 text-center">
                          <p className="text-2xl font-bold text-indigo-400">
                            {Math.round(history.slice(-30).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 30 * 10) / 10}
                          </p>
                          <p className="text-xs text-gray-400">avg tasks/day</p>
                        </div>
                        <div className="bg-slate-700 rounded-lg p-3 text-center">
                          <p className="text-2xl font-bold text-green-400">
                            {Math.round((history.slice(-30).filter(d => d.workoutDone).length / 30) * 100)}%
                          </p>
                          <p className="text-xs text-gray-400">workout rate</p>
                        </div>
                        <div className="bg-slate-700 rounded-lg p-3 text-center">
                          <p className="text-2xl font-bold text-purple-400">
                            {(() => {
                              let currentStreak = 0;
                              let maxStreak = 0;
                              for (const day of history.slice(-30)) {
                                if (day.done && day.done.length > 0) {
                                  currentStreak++;
                                  maxStreak = Math.max(maxStreak, currentStreak);
                                } else {
                                  currentStreak = 0;
                                }
                              }
                              return maxStreak;
                            })()}
                          </p>
                          <p className="text-xs text-gray-400">best streak</p>
                        </div>
                        <div className="bg-slate-700 rounded-lg p-3 text-center">
                          <p className="text-2xl font-bold text-yellow-400">
                            {Math.round((history.slice(-30).filter(d => d.mood).length / 30) * 100)}%
                          </p>
                          <p className="text-xs text-gray-400">mood tracking</p>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Growth Areas */}
                  {history.length >= 30 && (
                    <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                      <h3 className="text-lg font-bold mb-4 text-amber-400">üìà Growth Opportunities</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-slate-700 rounded-lg p-4">
                          <h4 className="font-medium mb-3 text-red-400">Needs Attention</h4>
                          <div className="space-y-2 text-sm text-gray-300">
                            {history.slice(-30).filter(d => d.workoutDone).length / 30 < 0.5 && (
                              <div>‚Ä¢ Physical activity consistency</div>
                            )}
                            {history.slice(-30).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 30 < 10 && (
                              <div>‚Ä¢ Daily productivity volume</div>
                            )}
                            {history.slice(-30).filter(d => d.mood).length / 30 < 0.6 && (
                              <div>‚Ä¢ Emotional awareness tracking</div>
                            )}
                          </div>
                        </div>

                        <div className="bg-slate-700 rounded-lg p-4">
                          <h4 className="font-medium mb-3 text-green-400">Strengths to Build On</h4>
                          <div className="space-y-2 text-sm text-gray-300">
                            {history.slice(-30).filter(d => d.workoutDone).length / 30 >= 0.7 && (
                              <div>‚Ä¢ Excellent physical discipline</div>
                            )}
                            {history.slice(-30).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 30 >= 15 && (
                              <div>‚Ä¢ Strong productivity habits</div>
                            )}
                            {history.slice(-30).filter(d => d.mood).length / 30 >= 0.8 && (
                              <div>‚Ä¢ Good emotional awareness</div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Future Planning */}
                  <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                    <h3 className="text-lg font-bold mb-4 text-blue-400">üîÆ Next Month Goals</h3>
                    <div className="space-y-4">
                      <div className="bg-slate-700 rounded-lg p-4">
                        <h4 className="font-medium mb-2 text-blue-400">Personal Challenge</h4>
                        <p className="text-gray-300 text-sm">
                          Based on your patterns, consider committing to one significant challenge next month:
                        </p>
                        <div className="mt-3 space-y-2">
                          {history.slice(-30).filter(d => d.workoutDone).length / 30 < 0.6 && (
                            <div className="text-sm text-amber-400">‚Ä¢ 20-workout fitness challenge</div>
                          )}
                          {history.slice(-30).reduce((sum, d) => sum + (d.done ? d.done.length : 0), 0) / 30 < 12 && (
                            <div className="text-sm text-amber-400">‚Ä¢ 20-task daily productivity goal</div>
                          )}
                          {history.slice(-30).filter(d => d.done && d.done.some(task => task.includes('read'))).length < 15 && (
                            <div className="text-sm text-amber-400">‚Ä¢ Daily reading habit (20+ days)</div>
                          )}
                        </div>
                      </div>

                      <div className="bg-slate-700 rounded-lg p-4">
                        <h4 className="font-medium mb-2 text-green-400">Systems to Refine</h4>
                        <p className="text-gray-300 text-sm">
                          Consider optimizing these systems for even better results:
                        </p>
                        <div className="mt-3 space-y-2 text-sm text-gray-300">
                          <div>‚Ä¢ Morning routine optimization</div>
                          <div>‚Ä¢ Evening reflection practice</div>
                          <div>‚Ä¢ Weekly planning sessions</div>
                          <div>‚Ä¢ Accountability partnerships</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* Coach Interaction */}
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 className="text-lg font-bold mb-4 text-amber-400">üí¨ Coach Interaction</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <button className="p-4 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors text-left">
                    <div className="text-blue-400 font-medium">üéØ Get Specific Advice</div>
                    <div className="text-sm text-gray-400 mt-1">Ask for detailed guidance on a specific area</div>
                  </button>
                  <button className="p-4 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors text-left">
                    <div className="text-green-400 font-medium">üìä Request Analysis</div>
                    <div className="text-sm text-gray-400 mt-1">Deep dive into a particular metric or pattern</div>
                  </button>
                  <button className="p-4 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors text-left">
                    <div className="text-purple-400 font-medium">üéØ Set New Goal</div>
                    <div className="text-sm text-gray-400 mt-1">Get help defining and planning a new objective</div>
                  </button>
                  <button className="p-4 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors text-left">
                    <div className="text-yellow-400 font-medium">üîÑ Refresh Insights</div>
                    <div className="text-sm text-gray-400 mt-1">Generate fresh analysis with latest data</div>
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (view === 'progress') {
        const rate = history.length > 0 ? Math.round((history.reduce((s, d) => s + d.done.length, 0) / (history.length * 18)) * 100) : 0;
        return (
          <div className="min-h-screen p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-4xl font-bold mb-4 text-center">Vita</h1>
              <div className="flex gap-2 justify-center mb-6">
                <button onClick={() => setView('today')} className="px-6 py-2 bg-slate-700 rounded-lg">Today</button>
                <button onClick={() => setView('progress')} className="px-6 py-2 bg-amber-600 text-white rounded-lg">Progress</button>
                <button onClick={() => setView('workouts')} className="px-6 py-2 bg-slate-700 rounded-lg">Workouts</button>
              </div>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <p className="text-sm mb-2">Completion</p>
                  <p className="text-4xl font-bold">{rate}%</p>
                  <p className="text-xs text-gray-400">avg across all days</p>
                </div>
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <p className="text-sm mb-2">Days</p>
                  <p className="text-4xl font-bold">{history.length}</p>
                  <p className="text-xs text-gray-400">total tracked</p>
                </div>
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <p className="text-sm mb-2">Workouts</p>
                  <p className="text-4xl font-bold">{history.filter(d => d.workoutDone).length}</p>
                  <p className="text-xs text-gray-400">completed</p>
              </div>
              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <p className="text-sm mb-2">This Week</p>
                  <p className="text-4xl font-bold">{history.slice(0, 7).filter(d => d.done.length > 0).length}</p>
                  <p className="text-xs text-gray-400">active days</p>
                </div>
              </div>

              {history.length > 7 && (
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-6">
                  <h2 className="text-xl font-bold mb-4">Monthly Trends</h2>
                  <div className="space-y-2 max-h-48 overflow-y-auto">
                    {(() => {
                      const months = {};
                      history.forEach(day => {
                        const date = new Date(day.date);
                        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                        if (!months[monthKey]) months[monthKey] = { days: 0, tasks: 0, workouts: 0 };
                        months[monthKey].days++;
                        months[monthKey].tasks += day.done.length;
                        if (day.workoutDone) months[monthKey].workouts++;
                      });

                      return Object.entries(months)
                        .sort(([a], [b]) => b.localeCompare(a))
                        .slice(0, 6)
                        .map(([month, stats]) => ({
                          month: new Date(month + '-01').toLocaleDateString('en-US', { month: 'short', year: '2-digit' }),
                          avgTasks: Math.round((stats.tasks / stats.days) || 0),
                          workoutRate: Math.round((stats.workouts / stats.days) * 100) || 0
                        }))
                        .map(stat => (
                          <div key={stat.month} className="flex justify-between items-center bg-slate-700 rounded p-2">
                            <span className="font-medium">{stat.month}</span>
                            <div className="flex gap-4 text-sm">
                              <span>Tasks: <span className="text-amber-400">{stat.avgTasks}/18</span></span>
                              <span>Workouts: <span className="text-green-400">{stat.workoutRate}%</span></span>
                            </div>
                          </div>
                        ));
                    })()}
                  </div>
                </div>
              )}

              <div className="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-bold">
                    {showAllHistory ? `All History (${history.length} days)` : 'Last 7 Days'}
                  </h2>
                  {history.length > 7 && (
                    <button
                      onClick={() => setShowAllHistory(!showAllHistory)}
                      className="px-4 py-2 bg-slate-700 rounded-lg text-sm hover:bg-slate-600 transition-colors"
                    >
                      {showAllHistory ? 'Show Recent' : `Show All (${history.length})`}
                    </button>
                  )}
                </div>
                {(showAllHistory ? history : history.slice(0, 7)).map(d => {
                  const pct = Math.round((d.done.length / 18) * 100);
                  const daysAgo = Math.floor((new Date() - new Date(d.date)) / (1000 * 60 * 60 * 24));
                  const isToday = daysAgo === 0;
                  const isYesterday = daysAgo === 1;

                  return (
                    <div key={d.date} className="bg-slate-700 rounded-lg p-4 mb-3 cursor-pointer hover:bg-slate-600 transition-colors" onClick={() => setViewingDay(d)}>
                      <div className="flex justify-between mb-2">
                        <div className="flex items-center gap-2">
                          <span className="font-medium">
                            {isToday ? 'Today' :
                             isYesterday ? 'Yesterday' :
                             new Date(d.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}
                          </span>
                          {daysAgo > 1 && <span className="text-xs text-gray-500">({daysAgo} days ago)</span>}
                      </div>
                        <div className="flex items-center gap-2">
                          {d.workoutDone && <span className="text-green-400 text-sm">üí™</span>}
                          <span className="text-amber-400 font-bold">{pct}%</span>
                        </div>
                      </div>
                      <div className="w-full bg-slate-600 rounded-full h-2 mb-2">
                        <div className="bg-amber-500 h-2 rounded-full" style={{ width: `${pct}%` }} />
                      </div>
                      <div className="text-xs text-gray-400">
                        {d.done.length}/18 tasks ‚Ä¢ {d.workoutDone ? `Workout: ${d.workoutType || 'Completed'}` : 'No workout'}
                        {d.journal && <span className="ml-2">üìù</span>}
                      </div>
                    </div>
                  );
                })}
                {history.length === 0 && (
                  <div className="text-center py-8 text-gray-500">
                    <p className="text-lg mb-2">No history yet</p>
                    <p className="text-sm">Complete some tasks and they'll appear here!</p>
              </div>
                )}
              </div>

              {viewingDay && (
                <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-bold">
                      {new Date(viewingDay.date).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
                    </h2>
                    <button onClick={() => setViewingDay(null)} className="px-3 py-1 bg-slate-700 rounded text-sm hover:bg-slate-600">‚úï</button>
                  </div>

                  <div className="grid grid-cols-2 gap-4 mb-6">
                    <div className="bg-slate-700 rounded-lg p-4">
                      <p className="text-sm text-gray-400 mb-1">Tasks Completed</p>
                      <p className="text-2xl font-bold text-amber-400">{viewingDay.done.length}/18</p>
                      <p className="text-sm text-gray-300">{Math.round((viewingDay.done.length / 18) * 100)}% complete</p>
                    </div>
                    <div className="bg-slate-700 rounded-lg p-4">
                      <p className="text-sm text-gray-400 mb-1">Workout</p>
                      <p className="text-lg font-bold text-green-400">
                        {viewingDay.workoutDone ? (viewingDay.workoutType ? labels[viewingDay.workoutType] || viewingDay.workoutType : 'Completed') : 'Not completed'}
                      </p>
                      {viewingDay.miles && <p className="text-sm text-gray-300">{viewingDay.miles} miles run</p>}

                      {viewingDay.workoutDone && viewingDay.workoutExercises && viewingDay.workoutExercises.length > 0 && (
                        <div className="mt-3">
                          <p className="text-xs text-gray-400 mb-2">Exercises Completed:</p>
                          <div className="space-y-1">
                            {viewingDay.workoutExercises.map((exercise, idx) => (
                              <div key={idx} className="flex justify-between text-sm">
                                <span className="text-gray-300">{exercise}</span>
                                {viewingDay.weights && viewingDay.weights[exercise] && (
                                  <span className="text-amber-400 font-medium">{viewingDay.weights[exercise]} lbs</span>
                                )}
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                  </div>

                  <div className="mb-6">
                    <h3 className="font-bold mb-3">Completed Tasks</h3>
                    <div className="space-y-2">
                      {tasks.core.map(t => (
                        <div key={t.id} className={`p-2 rounded text-sm ${viewingDay.done.includes(t.id) ? 'bg-green-900 border border-green-600' : 'bg-slate-700 opacity-50'}`}>
                          <span>{viewingDay.done.includes(t.id) ? '‚úÖ' : '‚¨ú'}</span> {t.t}
                        </div>
                      ))}
                      {tasks.lead.map(t => (
                        <div key={t.id} className={`p-2 rounded text-sm ${viewingDay.done.includes(t.id) ? 'bg-amber-900 border border-amber-600' : 'bg-slate-700 opacity-50'}`}>
                          <span>{viewingDay.done.includes(t.id) ? '‚úÖ' : '‚¨ú'}</span> {t.t}
                        </div>
                      ))}
                      {tasks.comm.map(t => (
                        <div key={t.id} className={`p-2 rounded text-sm ${viewingDay.done.includes(t.id) ? 'bg-purple-900 border border-purple-600' : 'bg-slate-700 opacity-50'}`}>
                          <span>{viewingDay.done.includes(t.id) ? '‚úÖ' : '‚¨ú'}</span> {t.t}
                        </div>
                      ))}
                    </div>
                  </div>


                  {viewingDay.journal && (
                    <div className="mb-4">
                      <h3 className="font-bold mb-2">Reflection</h3>
                      <div className="bg-slate-700 rounded p-3 text-sm text-gray-300">
                        {viewingDay.journal}
                      </div>
                    </div>
                  )}

                  {/* SaaS Work Section */}
                  {(viewingDay.saas || viewingDay.deepWork || viewingDay.talks) && (
                    <div className="mb-4">
                      <h3 className="font-bold mb-2">üíº SaaS Work</h3>
                      <div className="bg-slate-700 rounded p-3 text-sm">
                        {viewingDay.saas && (
                          <div className="mb-2">
                            <span className="text-gray-400">What I worked on:</span>
                            <div className="text-gray-300 mt-1">{viewingDay.saas}</div>
                          </div>
                        )}
                        <div className="grid grid-cols-2 gap-4 mt-3">
                          {viewingDay.deepWork && (
                            <div>
                              <span className="text-gray-400">Deep Work Hours:</span>
                              <div className="text-amber-400 font-medium">{viewingDay.deepWork} hrs</div>
                            </div>
                          )}
                          {viewingDay.talks && (
                            <div>
                              <span className="text-gray-400">User Talks:</span>
                              <div className="text-blue-400 font-medium">{viewingDay.talks}</div>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Nutrition Section */}
                  {viewingDay.nutritionData && (
                    <div className="mb-4">
                      <h3 className="font-bold mb-2">ü•ó Nutrition</h3>
                      <div className="bg-slate-700 rounded p-3 text-sm">
                        {Object.keys(viewingDay.nutritionData).length > 0 ? (
                          <div className="space-y-2">
                            {Object.entries(viewingDay.nutritionData).map(([meal, items]) => (
                              <div key={meal} className="border-b border-slate-600 pb-2">
                                <div className="font-medium text-amber-400 capitalize mb-1">{meal}:</div>
                                <div className="text-gray-300 text-xs space-y-1">
                                  {items.map((item, idx) => (
                                    <div key={idx} className="flex justify-between">
                                      <span>{item.name}</span>
                                      <span>{item.calories} cal</span>
                                    </div>
                                  ))}
                                </div>
                              </div>
                            ))}
                          </div>
                        ) : (
                          <div className="text-gray-400">No nutrition data recorded</div>
                        )}
                      </div>
                    </div>
                  )}

                  <div className="grid grid-cols-3 gap-4 text-center">
                    {viewingDay.mood && (
                      <div className="bg-slate-700 rounded p-3">
                        <p className="text-xs text-gray-400 mb-1">Mood</p>
                        <p className="text-lg">{viewingDay.mood}</p>
                      </div>
                    )}
                    {viewingDay.water && (
                      <div className="bg-slate-700 rounded p-3">
                        <p className="text-xs text-gray-400 mb-1">Water</p>
                        <p className="text-lg">{viewingDay.water} glasses</p>
                      </div>
                    )}
                    {viewingDay.deepWork && (
                      <div className="bg-slate-700 rounded p-3">
                        <p className="text-xs text-gray-400 mb-1">Deep Work</p>
                        <p className="text-lg">{viewingDay.deepWork} hrs</p>
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      }

      const total = 18;
      const done = data.done ? data.done.length : 0;

      return (
        <div className="min-h-screen p-4">
          <div className="max-w-4xl mx-auto">
            <div className="flex items-center justify-between mb-2">
              <div className="flex-1">
                <h1 className="text-4xl font-bold mb-1">Vita</h1>
                <p className="text-sm text-gray-400">{new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
              </div>
              <div className="flex items-center gap-2">
                <div className={`px-3 py-1 rounded-full text-sm ${isExisting ? 'bg-green-700 text-white' : 'bg-slate-700 text-gray-200'}`}>
                  {isExisting ? 'Existing' : 'Fresh'}
                </div>
                <button onClick={startNewDay} className="px-3 py-2 bg-slate-700 rounded text-sm">New Day</button>
              </div>
            </div>

            {saveStatus && <p className="text-center text-sm text-green-400 mb-2">{saveStatus}</p>}

            <div className="flex gap-2 justify-center mb-6 flex-wrap">
              <button onClick={() => setView('today')} className="px-3 py-2 bg-amber-600 text-white rounded-lg text-xs">Today</button>
              <button onClick={() => setView('progress')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Progress</button>
              <button onClick={() => setView('workouts')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Workouts</button>
              <button onClick={() => setView('affirmations')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Affirmations</button>
              <button onClick={() => setView('coach')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Coach</button>
              <button onClick={() => setView('books')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Books</button>
              <button onClick={() => setView('nutrition')} className="px-3 py-2 bg-slate-700 text-gray-300 rounded-lg text-xs">Nutrition</button>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <div className="flex justify-between mb-3">
                <span>Progress</span>
                <span className="text-2xl font-bold text-amber-400">{done}/{total}</span>
              </div>
              <div className="w-full bg-slate-700 rounded-full h-3">
                <div className="bg-amber-500 h-3 rounded-full" style={{ width: `${(done/total)*100}%` }} />
              </div>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="text-lg font-bold mb-4 text-center text-amber-400">üíæ Save Today's Progress</h3>
              <p className="text-sm text-gray-300 mb-4 text-center">
                Save a complete snapshot of your day - all tasks, workouts, mood, and progress will be saved and viewable in your Progress history.
              </p>
              <button
                onClick={async () => {
                  // Include nutrition data in the snapshot
                  const currentNutritionData = (() => {
                    try {
                      const savedNutrition = localStorage.getItem('vita-nutrition');
                      if (savedNutrition) {
                        const nutritionData = JSON.parse(savedNutrition);
                        return nutritionData[today] || null;
                      }
                      return null;
                    } catch (e) {
                      console.error('Error loading nutrition for save:', e);
                      return null;
                    }
                  })();

                  const currentData = {
                    ...data,
                    date: today,
                    lastSaved: new Date().toISOString(),
                    nutritionData: currentNutritionData
                  };
                  const cleanData = JSON.parse(JSON.stringify(currentData));
                  setData(cleanData);
                  await save(cleanData);
                  setSaveStatus('Today\'s progress saved! üìÖ');
                  setTimeout(() => setSaveStatus(''), 3000);
                }}
                className="w-full py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition-colors text-lg"
              >
                üíæ Save Today's Progress
              </button>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="mb-4">üòä Mood & Energy</h3>

              <div className="mb-4">
                <h4 className="text-sm font-medium text-gray-400 mb-2">How are you feeling?</h4>
              <div className="flex gap-2 flex-wrap">
                {['üòä Sharp', 'üôÇ Good', 'üòê Okay', 'üòî Off', 'üò∞ Hard'].map(m => (
                    <button key={m} onClick={async () => { const nd = { ...data, mood: m }; const cleanData = JSON.parse(JSON.stringify(nd)); setData(cleanData); await save(cleanData); }} className={`px-4 py-2 rounded-lg ${data.mood === m ? 'bg-amber-500 text-white' : 'bg-slate-700 text-gray-300'}`}>
                    {m}
                  </button>
                ))}
                </div>
              </div>

              <div>
                <h4 className="text-sm font-medium text-gray-400 mb-2">Energy Level</h4>
                <div className="flex gap-2 flex-wrap">
                  {[
                    { emoji: '‚ö°', label: 'High Energy', value: 'high' },
                    { emoji: 'üîã', label: 'Good Energy', value: 'good' },
                    { emoji: 'ü™´', label: 'Low Energy', value: 'low' },
                    { emoji: 'üò¥', label: 'Exhausted', value: 'exhausted' }
                  ].map(e => (
                    <button key={e.value} onClick={async () => { const nd = { ...data, energyLevel: e.value }; const cleanData = JSON.parse(JSON.stringify(nd)); setData(cleanData); await save(cleanData); }} className={`px-4 py-2 rounded-lg ${data.energyLevel === e.value ? 'bg-blue-500 text-white' : 'bg-slate-700 text-gray-300'}`}>
                      {e.emoji} {e.label}
                    </button>
                  ))}
                </div>
              </div>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <div className="flex justify-between items-center mb-3">
                <div className="flex items-center gap-2">üíß<span className="ml-1">Water Intake</span></div>
                <span className="text-xl font-bold text-blue-400">{water} glasses</span>
              </div>
              <div className="flex gap-2">
                <button onClick={() => updateWater(-1)} className="px-6 py-2 bg-slate-700 text-white rounded-lg font-bold">-</button>
                <button onClick={() => updateWater(1)} className="flex-1 py-2 bg-blue-600 text-white rounded-lg font-bold">+ Glass</button>
              </div>
              <p className="text-xs text-gray-400 mt-2">Target: 8 glasses per day (64oz)</p>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <div className="flex items-center gap-2 mb-3">üíª<span>SaaS Work</span></div>
              <textarea value={saas} onChange={e => setSaas(e.target.value)} onBlur={async () => { const nd = { ...data, saas }; const cleanData = JSON.parse(JSON.stringify(nd)); setData(cleanData); await save(cleanData); }} placeholder="What did you work on today?" className="w-full p-3 bg-slate-700 rounded text-white mb-3" rows="3" />
              <div className="grid grid-cols-2 gap-3 mb-3">
                <input type="number" step="0.5" value={deepWork} onChange={e => setDeepWork(e.target.value)} onBlur={async () => { const nd = { ...data, deepWork }; const cleanData = JSON.parse(JSON.stringify(nd)); setData(cleanData); await save(cleanData); }} placeholder="Deep work (hrs)" className="p-3 bg-slate-700 rounded text-white" />
                <input type="number" value={talks} onChange={e => setTalks(e.target.value)} onBlur={async () => { const nd = { ...data, talks }; const cleanData = JSON.parse(JSON.stringify(nd)); setData(cleanData); await save(cleanData); }} placeholder="User talks" className="p-3 bg-slate-700 rounded text-white" />
              </div>
              <button onClick={async () => { const nd = { ...data, saas, deepWork, talks }; const cleanData = JSON.parse(JSON.stringify(nd)); setData(cleanData); await save(cleanData); setSaveStatus('SaaS work saved! ‚úì'); setTimeout(() => setSaveStatus(''), 2000); }} className="w-full py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                Save SaaS Work
              </button>
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="mb-3">Non-Negotiables</h3>
              {tasks.core.map(t => (
                <div key={t.id} onClick={() => toggle(t.id)} className={`p-3 rounded-lg mb-2 cursor-pointer ${data.done.includes(t.id) ? 'bg-green-900 border-2 border-green-500' : 'bg-slate-700'}`}>
                  <div className="flex items-center justify-between">
                    <span className="text-sm">{t.t}</span>
                    {data.done.includes(t.id) && <span>‚úÖ</span>}
                  </div>
                </div>
              ))}
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="mb-3">Leadership (Do 1+)</h3>
              {tasks.lead.map(t => (
                <div key={t.id} onClick={() => toggle(t.id)} className={`p-3 rounded-lg mb-2 cursor-pointer ${data.done.includes(t.id) ? 'bg-amber-900 border-2 border-amber-500' : 'bg-slate-700'}`}>
                  <div className="flex items-center justify-between">
                    <span className="text-sm">{t.t}</span>
                    {data.done.includes(t.id) && <span>‚úÖ</span>}
                  </div>
                </div>
              ))}
            </div>

            <div className="bg-slate-800 rounded-xl p-6 mb-6 border border-slate-700">
              <h3 className="mb-3">Communication</h3>
              {tasks.comm.map(t => (
                <div key={t.id} onClick={() => toggle(t.id)} className={`p-3 rounded-lg mb-2 cursor-pointer ${data.done.includes(t.id) ? 'bg-purple-900 border-2 border-purple-500' : 'bg-slate-700'}`}>
                  <div className="flex items-center justify-between">
                    <span className="text-sm">{t.t}</span>
                    {data.done.includes(t.id) && <span>‚úÖ</span>}
                  </div>
                </div>
              ))}
            </div>


            <div className="bg-slate-800 rounded-xl p-6 border border-slate-700">
              <div className="flex items-center gap-2 mb-3">üìö<span>Reflection</span></div>
              <textarea value={journal} onChange={e => setJournal(e.target.value)} onBlur={async () => { const nd = { ...data, journal }; const cleanData = JSON.parse(JSON.stringify(nd)); setData(cleanData); await save(cleanData); }} placeholder="What did I lead? What did I ship? How did I grow?" className="w-full p-3 bg-slate-700 rounded text-white mb-3" rows="4" />
              <button onClick={async () => { const nd = { ...data, journal }; const cleanData = JSON.parse(JSON.stringify(nd)); setData(cleanData); await save(cleanData); setSaveStatus('Reflection saved! ‚úì'); setTimeout(() => setSaveStatus(''), 2000); }} className="w-full py-2 bg-amber-600 text-white rounded-lg font-semibold hover:bg-amber-700 transition-colors">
                Save Reflection
              </button>
            </div>

          </div>
        </div>
      );
    }

    ReactDOM.render(<VitaApp />, document.getElementById('root'));
  </script>

</body>
</html>
